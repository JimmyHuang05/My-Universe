<!-- AI INSTRUCTION: This file now contains the News Dashboard (view-dashboard), Departments Structure (view-departments), and the Student Archive Center (view-archive-main). All content and logic are merged into this single file. -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edu.Space 校园平台</title>
    <!-- 引入 Tailwind CSS (样式库) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Phosphor Icons (图标库) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- 引入 Google Fonts (字体) -->
    <!-- Noto Serif SC 用于档案文字展示 -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    
    <script>
        /**
         * Tailwind CSS 配置文件 (已合并所有颜色)
         */
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['DM Sans', 'sans-serif'], // 默认字体设置
                        serif: ['"Noto Serif SC"', 'serif'], // 衬线字体
                    },
                    colors: {
                        // 背景色配置
                        bg: '#F3F0EA',       // 网页主背景色 (米色)
                        card: '#EBE7E0',     // 深色卡片背景
                        cardLight: '#FDFBF7',// 浅色卡片背景 (主要内容区)
                        dark: '#1A1B1F',     // 深黑色 (文字、按钮、侧边栏激活态)
                        
                        // 强调色配置
                        accentYellow: '#FFD646', // 黄色 (新闻/主要荣誉)
                        accentOrange: '#FF9B85', // 橙色 (通知/次要惩戒)
                        accentRed: '#FF6B6B',    // 红色 (紧急/热点/严重惩戒)
                        accentBlue: '#A0C4FF',   // 蓝色 (官方报道/学业/次要荣誉)
                        accentPurple: '#BDB2FF', // 紫色
                        accentGreen: '#16A34A',  // 深绿色 (上涨趋势/健康)
                        accentIndigo: '#818CF8', // 靛蓝 - 公关部
                        accentTeal: '#2DD4BF',   // 青色 - 秘书处
                        
                        // 文字颜色
                        textGray: '#9CA3AF',     // 辅助文字灰色
                        textDark: '#1F2937'      // 主要文字深色
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)', // 柔和的卡片阴影
                        'inner-light': 'inset 0 2px 4px 0 rgba(255, 255, 255, 0.3)', // 内部高光效果
                    }
                }
            }
        }
    </script>
    
    <script>
        // ====================================================
        // ======== 核心视图切换和通用功能 ========
        // ====================================================
        
        /**
         * 函数: 切换主页面 (现在支持 dashboard, departments, archive-main)
         */
        window.switchPage = function(pageName) {
            // 所有主视图 ID
            const pages = ['view-dashboard', 'view-departments', 'view-archive-main'];
            const navItems = {
                'view-dashboard': { desktop: 'nav-dashboard-desktop', mobile: 'nav-dashboard-mobile' },
                'view-archive-main': { desktop: 'nav-archive-desktop', mobile: 'nav-archive-mobile' }, 
                'view-departments': { desktop: 'nav-departments-desktop', mobile: 'nav-departments-mobile' }
            };

            // 切换主内容区的可见性
            pages.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    el.classList.toggle('hidden-view', id !== pageName);
                }
            });

            // 切换导航栏按钮状态
            Object.keys(navItems).forEach(key => {
                const isCurrent = key === pageName;
                const desktopId = navItems[key].desktop;
                const mobileId = navItems[key].mobile;
                const desktopEl = document.getElementById(desktopId);
                const mobileEl = document.getElementById(mobileId);
                const activeClass = 'bg-dark text-accentYellow shadow-lg';
                const inactiveClass = 'bg-transparent text-gray-500 hover:text-dark';

                if (desktopEl) desktopEl.className = `w-12 h-12 rounded-full flex items-center justify-center cursor-pointer transition-transform hover:scale-105 ${isCurrent ? activeClass : inactiveClass}`;
                if (mobileEl) mobileEl.className = `w-10 h-10 rounded-full flex items-center justify-center cursor-pointer transition-transform hover:scale-105 ${isCurrent ? activeClass : inactiveClass}`;
            });
            
            // 确保切换后视图滚动到顶部
            if (pages.includes(pageName)) {
                 const mainContent = document.getElementById(pageName);
                 if (mainContent) mainContent.scrollTo(0, 0);
            }

            // 特殊处理：如果切换到档案中心，确保默认加载黄嘉熙的档案
            if (pageName === 'view-archive-main') {
                 // 确保只在第一次加载或切换到主页时才调用，避免重复初始化
                 const archiveView = document.getElementById('view-archive');
                 if (archiveView && archiveView.dataset.initialized !== 'true') {
                    window.loadStudentArchive(window.currentStudentId); 
                    window.switchArchiveSubView('view-archive'); 
                    archiveView.dataset.initialized = 'true';
                 }
            }
        }
        
        /**
         * 函数: 显示“功能暂未开放”模态框
         */
        window.showNotOpenModal = function() { 
            document.getElementById('not-open-modal').classList.remove('hidden');
        }

        /**
         * 函数: 关闭“功能暂未开放”模态框
         */
        window.closeNotOpenModal = function() { 
            document.getElementById('not-open-modal').classList.add('hidden');
        }
        
        /**
         * 函数: 关闭自定义 alert 模态框
         */
        window.closeCustomAlertModal = function() {
            document.getElementById('custom-alert-modal').classList.add('hidden');
        }

        document.addEventListener('DOMContentLoaded', () => {
            // 初始状态，激活新闻首页导航按钮
            window.switchPage('view-dashboard');

            // 初始化档案搜索历史的默认HTML
            const defaultContent = document.getElementById('search-dropdown-content');
            if (defaultContent) {
                window.defaultSearchHistoryHTML = defaultContent.innerHTML;
            }
        });

        
        // ====================================================
        // ======== 1. 部门结构逻辑 (Department Logic) ========
        // ====================================================

        // --- 拼音工具函数 (用于部门和档案头像) ---
        const pinyinMap = {
            '黄': 'H', '骆': 'L', '华': 'H', '凝': 'N', '子': 'Z', '怡': 'Y', 
            '婧': 'J', '瑶': 'Y', '锦': 'J', '烨': 'Y', '琰': 'Y', '清': 'Q', '任': 'R', 
            '佳': 'J', '可': 'K', '依': 'Y', '郁': 'Y', '唯': 'W', '亦': 'Y', '婕': 'J', 
            '雨': 'Y', '菲': 'F', '芯': 'X', '慈': 'C', '诣': 'Y', '茗': 'M', '佩': 'P', 
            '姿': 'Z', '祺': 'Q', '越': 'Y', '官': 'G', '王': 'W', '谭': 'T', '宋': 'S', 
            '年': 'N', '胡': 'H', '田': 'T', '马': 'M', '袁': 'Y', '湘': 'X', '琴': 'Q',
            '花': 'H', '泽': 'Z', '类': 'L', '道': 'D', '明': 'M', '寺': 'S', '赵': 'Z',
            '默': 'M', '笙': 'S', '路': 'L', '星': 'X', '河': 'H', '耿': 'G', '张': 'Z',
            '伟': 'W', '陈': 'C', '美': 'M', '大': 'D', '力': 'L', '海': 'H', '棠': 'T',
            '曾': 'Z', '小': 'X', '贤': 'X', '展': 'Z', '博': 'B', '关': 'G', '谷': 'G',
            '林': 'L', '萧': 'X', '南': 'N', '湘': 'X', '唐': 'T', '宛': 'W', '如': 'R',
            '桥': 'Q', '川': 'C', '钟': 'Z', '白': 'B', '逸': 'Y', '帆': 'F',
            '流': 'L', '枫': 'F', '赤': 'C', '木': 'M', '晴': 'Q', '宫': 'G', '良': 'L',
            '思': 'S', '周': 'Z', '杰': 'J', '晨': 'C', '光': 'G', '曹': 'C', '陆': 'L',
            '薛': 'X', '顾': 'G', '刘': 'L', '倪': 'N', '何': 'H', '杨': 'Y',
        };
        function getSurnameInitial(chineseName) {
            if (!chineseName || typeof chineseName !== 'string') return '?';
            let firstChar = chineseName.trim().charAt(0);
            const initial = pinyinMap[firstChar] || firstChar.toUpperCase().charAt(0);
            return initial.toUpperCase() || '?';
        }
        function renderAvatarDiv(name, sizeClass, fontSizeClass, deptBgClass, initialOverride) {
            let initialsToDisplay;
            if (initialOverride) {
                initialsToDisplay = initialOverride.toUpperCase().slice(0, 2);
                if (initialsToDisplay.length === 1) {
                    fontSizeClass = sizeClass.includes('w-24') ? 'text-3xl' : 'text-base'; 
                } else if (initialsToDisplay.length === 2) {
                    fontSizeClass = sizeClass.includes('w-24') ? 'text-2xl' : 'text-sm';
                }
            } else {
                initialsToDisplay = getSurnameInitial(name);
                fontSizeClass = sizeClass.includes('w-24') ? 'text-3xl' : 'text-base'; 
            }
            const titleChar = name.trim().charAt(0);
            return `<div class="${sizeClass} ${fontSizeClass} rounded-full flex items-center justify-center font-bold text-white flex-shrink-0 ${deptBgClass}" title="${titleChar}">${initialsToDisplay}</div>`;
        }
        window.getSurnameInitial = getSurnameInitial;
        window.renderAvatarDiv = renderAvatarDiv;

        // 部门数据 (Data)
        const departments = {
            presidium: { 
                title: "主席团", subtitle: "Presidium", desc: "学生会核心决策机构。负责制定学生会发展规划、协调各部门工作、对接学校行政部门及领导学生会整体运作。", 
                color: "accentRed", 
                bgClass: "bg-accentRed", 
                textClass: "text-accentRed", 
                icon: "ph-crown", 
                minister: { 
                    name: "黄嘉熙", 
                    initialsOverride: "黄", 
                    quote: "责任重于泰山，创新引领未来。我们将带领学生会成为更卓越的团队。", 
                    roleTitle: "主席" 
                }, 
                members: [
                    { name: "李婧瑶", role: "副主席", initialsOverride: "李"}, 
                    { name: "上官越", role: "副主席", initialsOverride: "上官"}, 
                    { name: "宋钰", role: "主席助理", initialsOverride: "宋"}
                ], 
                feature: { 
                    title: "学生会决策中心", 
                    icon: "ph-strategy", 
                    tags: ["Leadership", "Strategy"], 
                    desc: "主席团在此进行每周例会，审议各部门提案，并制定学期重大活动日历。我们是连接学生与学校管理层的核心桥梁。", 
                    widgetLabel: "本月提案处理", 
                    widgetStatus: "100%", 
                    widgetColor: "bg-accentRed", 
                    list: [
                        { label: "2022/12/28", title: "部长联席会议", sub: "13:00 @ C501" }, 
                        { label: "2023/01/11", title: "部长联席会议", sub: "13:00 @ C501" }, 
                        { label: "2023/01/25", title: "部长联席会议", sub: "13:00 @ 线上" }, 
                        { label: "2023/02/08", title: "部长联席会议", sub: "13:00 @ 线上" }
                    ] 
                },
            },
            secretariat: { 
                title: "秘书处", 
                subtitle: "Secretariat", 
                desc: "学生会中枢行政机构。负责文书档案、会议记录、物资财务、内部考评，为组织运行提供制度与资源保障。", 
                color: "accentTeal", 
                bgClass: "bg-teal-400", 
                textClass: "text-teal-500", 
                icon: "ph-notebook", 
                minister: { 
                    name: "周圣珺", 
                    initialsOverride: "周", 
                    quote: "细节决定成败，条理清晰是高效工作的基石。", 
                    roleTitle: "秘书长" 
                }, 
                members: [
                    { name: "宋钰", role: "行政助理/监事", initialsOverride: "宋" }, 
                    { name: "赵倩楠", role: "财务助理", initialsOverride: "赵"}
                ], 
                feature: { 
                    title: "学生会统筹中心", 
                    icon: "ph-files", 
                    tags: ["Archives", "Logistics"], 
                    desc: "统一管理学生会所有活动策划案存档、财务报表以及办公物资的借用与调度。", 
                    widgetLabel: "年度预算", 
                    widgetStatus: "充足", 
                    widgetColor: "bg-teal-500", 
                    list: [
                        { label: "2022/12/30", title: "2023年1月预算分配会", sub: "16:00 @ 线上" }, 
                        { label: "2023/01/31", title: "2023年2月预算分配会", sub: "16:00 @ 线上" }, 
                        { label: "2023/02/28", title: "2023年3月预算分配会", sub: "16:00 @ 线上" }, 
                        { label: "2023/03/31", title: "2023年4月预算分配会", sub: "16:00 @ 线上" }
                    ] 
                } 
            },
            academic: { 
                title: "学术部", 
                subtitle: "Academic Department", 
                desc: "学生会学术发展机构。负责制定学风建设方案、统筹学科竞赛与科普活动，对接教学部门并引领校园学习生态。", 
                color: "accentBlue", 
                bgClass: "bg-accentBlue", 
                textClass: "text-accentBlue", 
                icon: "ph-graduation-cap", 
                minister: { 
                    name: "王子怡", 
                    initialsOverride: "王", 
                    quote: "知识的价值在于分享，我们致力于让每一个同学都能找到学习的乐趣。", 
                    roleTitle: "部长" 
                }, 
                members: [
                    { name: "顾语", role: "部员/监事", initialsOverride: "顾"}, 
                    { name: "马嘉璟", role: "部员", initialsOverride: "马"},
                    { name: "宋佩姿", role: "部员", initialsOverride: "宋"}
                ], 
                feature: { 
                    title: "学术研习小组", 
                    icon: "ph-books", 
                    tags: ["Study Support", "Resources"], 
                    desc: "策划校内专题研讨会及讲座，搭建师生深度交流平台，营造校园浓厚学术氛围。", 
                    widgetLabel: "资料库访问量", 
                    widgetStatus: "High", 
                    widgetColor: "bg-accentBlue", 
                    list: [
                        { label: "2022/12/16", title: "高等数学兴趣会", sub: "14:00 @ 报告厅A" }, 
                        { label: "2023/01/13", title: "东华大学宣讲会", sub: "13:30 @ 报告厅C" }, 
                        { label: "2023/02/24", title: "最新高考政策解读", sub: "15:00 @ 报告厅A" }, 
                        { label: "2023/02/25", title: "性知识论文指导会", sub: "15:00 @ 报告厅B" }
                    ] 
                } 
            },
            discipline: { 
                title: "纪律部", 
                subtitle: "Discipline Department", 
                desc: "学生会行为规范机构。负责检查出勤仪容、量化班级考评、维护公共秩序，向学校反馈纪律数据并督促改进。", 
                color: "accentRed", 
                bgClass: "bg-accentRed", 
                textClass: "text-accentRed", 
                icon: "ph-gavel", 
                minister: { 
                    name: "李婧瑶", 
                    initialsOverride: "李", 
                    quote: "规则不是为了束缚，而是为了更自由地生长。严谨是我们的底色。", 
                    roleTitle: "部长" 
                }, 
                    members: [
                        { name: "黄嘉熙", role: "监事", initialsOverride: "黄" },
                        { name: "陈沁荷", role: "风纪委员", initialsOverride: "陈" }, 
                        { name: "林思妤", role: "风纪委员", initialsOverride: "林"}, 
                        { name: "张蕙如", role: "风纪委员", initialsOverride: "张" }
                    ], 
                    feature: { 
                        title: "校园纪律督导组/风纪委员会", 
                        icon: "ph-shield-check", 
                        tags: ["Inspection", "Safety"], 
                        desc: "由纪律部与德育处联合设立，专责每日巡查校园风纪、督导学生行为规范，即时纠偏、定期通报，营造公平有序、积极向上的校园环境。", 
                        widgetLabel: "风纪波动系数", 
                        widgetStatus: "高", 
                        widgetColor: "bg-accentRed", 
                        list: [
                            { label: "07:00", title: "早会考勤", sub: "操场" }, 
                            { label: "12:00", title: "食堂秩序巡检", sub: "食堂" }, 
                            { label: "14:30", title: "着装检查", sub: "教学楼 A/B" }, 
                            { label: "17:30", title: "校园巡检", sub: "全校" }
                        ] 
                    },
                    customInfo: {
                        title: "日常巡查计划及风纪委员行为规范一览",
                        content: `<div class="space-y-3 text-sm text-gray-600">
                            <p>纪律部负责全校性相关纪律维护、校园性行为规范管理及安全措施执行。</p>
                            <p>每日固定巡查内容：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>07:10–08:10 对存在性需求的学生，需由风纪委员执行 <b>快速性处理</b> 或 <b>自行解决</b> 后才能入校，以降低校内性行为发生率。</li>
                                <li>11:30–13:00 巡查食堂，快速受理 <b>突发性需求</b> 并安排合规处理，避免影响就餐秩序。</li>
                                <li>17:30–19:00 全面清查教学区域，督促学生及时离校；对仍滞留的学生进行身份登记并引导离校，杜绝夜间校内滞留与安全隐患。</li>
                            </ul>
                            <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                                <p class="text-xs mt-1">⚠️特别说明：<b>快速性处理</b> 包括但不仅限于 <b>有/无安全措施下的插入式、非插入式性行为</b>。</p>
                            </div>
                            <p>风纪委员行为规范：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>到校时间不晚于07:00，离校不早于19:30。</li>
                                <li>应当熟练掌握 <b>插入式性处理</b> 技巧，定期考核。</li>
                                <li>统一着制服：西服外套、白色衬衫、领结、同色百褶短裙（裙长至臀部下缘）、黑色连裤丝袜、黑色皮鞋。</li>
                            </ul>
                            <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                                <p class="text-xs mt-1">注：值勤期间应当使用乳贴，且不得着内裤，以确保快速响应与处理效率。</p>
                            </div>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>随身常备充足计生用品（避孕药、润滑剂、医用湿巾等）。</li>
                                <li>严禁在校园任何公共区域私下解决自身性需求；如有正当需求，须前往风纪委员办公室以规范流程处理。</li>
                            </ul>
                            <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                                <p class="text-xs mt-1">注：欢迎全校学生共同监督，违者视为失职，取消风纪委员资格。</p>
                            </div>
                        </div>`
                    }
                },
            ceremony: { 
                title: "仪式部", 
                subtitle: "Ceremony Department", 
                desc: "学生会礼仪形象机构。负责升旗典礼、颁奖仪式、迎宾与礼服管理，用标准化礼仪展示校园精神风貌。", 
                color: "accentPurple", 
                bgClass: "bg-accentPurple", 
                textClass: "text-accentPurple", 
                icon: "ph-microphone-stage", 
                minister: { 
                    name: "薛锦烨", 
                    initialsOverride: "薛", 
                    quote: "每一个细节都决定成败，在舞台上，我们代表学校的形象。", 
                    roleTitle: "部长" 
                }, 
                members: [
                    { name: "黄嘉熙", role: "监事", initialsOverride: "黄" },
                    { name: "胡雨菲", role: "部员/礼仪队", initialsOverride: "胡" }, 
                    { name: "骆华凝", role: "部员/礼仪队", initialsOverride: "骆" }, 
                    { name: "马亦婕", role: "部员/礼仪队", initialsOverride: "马" }, 
                    { name: "田芯慈", role: "部员/礼仪队", initialsOverride: "田" }
                ], 
                feature: { 
                    title: "礼仪与主持培训中心", 
                    icon: "ph-flag", 
                    tags: ["Etiquette", "Hosting"], 
                    desc: "由仪式部与组织部联合成立，旨在系统提升礼仪队成员及各类活动主持人的仪表仪态、舞台表现力、语言表达能力和临场应变能力。", 
                    widgetLabel: "本周活动场次", 
                    widgetStatus: "3 Events", 
                    widgetColor: "bg-accentPurple", 
                    list: [
                        { label: "2023/01/05", title: "培训", sub: "16:00 @ B203" }, 
                        { label: "2023/01/12", title: "培训", sub: "16:00 @ B203" }, 
                        { label: "2023/02/23", title: "培训", sub: "16:00 @ B203" }, 
                        { label: "2023/03/02", title: "培训", sub: "16:00 @ B203" }
                    ] 
                },
                customInfo: {
                    title: "《礼仪部成员选拔及培训标准》（2022版）",
                    content: `<div class="space-y-3 text-sm text-gray-600">
                        <p>礼仪部作为学校对外形象与重大活动接待核心部门，所有成员须达到以下专业标准：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>身高 165cm+ 女性，BMI 18–20。</li>
                            <li>性格开朗、大方、外向；思想积极、有责任感。</li>
                            <li>五官端正，无可见痘印、纹身；颈、臂、腿裸露处无明显疤痕或畸形。</li>
                            <li>流利的中/英文沟通能力。</li>
                            <li>对 <b>标准礼仪姿态</b> 有较多了解。</li>
                        </ul>
                        <p>为确保礼仪队成员整体形象符合学校对外接待的最高标准，选拔终审阶段设置 <b>“全裸形体展示”</b> 环节：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>候选人应当在指定评审室中自然脱去全部衣物。</li>
                            <li>候选人应当按指令依次完成：站姿→礼仪走姿→正面/侧面/背面转身→标准分腿展示→坐姿及私处近距离检视</li>
                        </ul>
                        <p>非初次候选人（自述或体检显示非处女）将自动进入 <b>“性交技能专业考核”</b> 环节，由仪式部监事担任考官，考核流程如下：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>候选人应当完成自我介绍。</li>
                            <li>候选人应当跪坐在考官正前方，保持适当距离。</li>
                        </ul>
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                            <p class="text-xs mt-1">考核内容①：使用 <b>标准礼仪口交技巧</b>，直至考官射精。</p>
                            <div class="mt-1 p-3 bg-accentPurple/20 rounded-lg border border-accentPurple">
                                <p class="text-xs mt-1"><b>标准礼仪口交技巧</b>：女性嘴唇轻触龟头，以顺时针画圈湿润，舌尖轻点马眼三次;缓慢下沉至能容纳的最大深度，喉部放松，保持3秒静止不动，随后以匀速上下，舌面始终贴合阴茎下侧；射精前2秒完成“一沉到底”，龟头抵喉，喉部主动收缩三次；射精后缓缓送出阴茎，张嘴展示口腔内精液，确认后闭嘴完整咽下。</p>
                            </div>
                            <p class="text-xs mt-1">考核内容②：使用 <b>标准礼仪手交技巧</b>，直至考官射精。</p>
                            <div class="mt-1 p-3 bg-accentPurple/20 rounded-lg border border-accentPurple">
                                <p class="text-xs mt-1"><b>标准礼仪手交技巧</b>：女性双手轻叠成杯形，掌心确保温热；先以指腹轻柔描摹龟头轮廓三圈（顺时针→逆时针→顺时针）；右手虎口卡住阴茎根部轻轻上提，左手五指并拢从根部向龟头缓慢推进；双手交替螺旋上升，每上升一圈在冠状沟处停留0.5秒轻刮一次，共六圈；右手固定根部微震，左手集中于龟头–冠状沟区间高速小幅度打圈，同时拇指轻压尿道口，频率由慢到快；射精前0.5秒双手迅速下移至根部并轻握，感受脉动；射精后立即改用温热掌心完整包裹阴茎，轻柔顺时针按摩三次。</p>
                            </div>
                        </div>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>候选人应当做好性交准备。</li>
                        </ul>
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                            <p class="text-xs mt-1">考核内容③：候选人应当完成一次 <b>“礼仪迎宾”</b>。</p>
                            <div class="mt-1 p-3 bg-accentPurple/20 rounded-lg border border-accentPurple">
                                <p class="text-xs mt-1"><b>“礼仪迎宾”</b>，又名“阴水净尘”，是指女性上位跨坐，双手扶肩，阴茎贴于腹部但不插入，臀部前后小幅度滑动，用湿润的大阴唇来回摩擦整根阴茎20-30次的动作。</p>
                            </div>
                            <p class="text-xs mt-1">考核内容④：候选人应当完成一次 <b>“礼仪深吻”</b>。</p>
                            <div class="mt-1 p-3 bg-accentPurple/20 rounded-lg border border-accentPurple">
                                <p class="text-xs mt-1"><b>“礼仪深吻”</b>，又名“一沉到底” 或 “全根吞没”，是指女性上位跨坐，双手扶肩，臀部先抬高，然后缓慢下沉，将阴茎完全吞没、一次性尽可能深地插入到底的动作。</p>
                            </div>
                            <p class="text-xs mt-1">考核内容⑤：候选人应当完成一次 <b>完整且无安全措施的插入式性行为</b>。</p>
                            <p class="text-xs mt-1">考核内容⑥：候选人性交时的 <b>表情管理、声音控制、主动迎合与情绪调动能力</b>。</p>
                            <p class="text-xs mt-1">考核内容⑦：候选人性交时的 <b>内部包裹紧致度、湿润度、温度及整体性交体验舒适度</b>。</p>
                        </div>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>考官在候选人体内射精。</li>
                        </ul>
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                            <p class="text-xs mt-1">考核内容⑧：候选人应当完成一次 <b>真实高潮</b>（5分钟内）。</p>
                            <div class="mt-1 p-3 bg-accentPurple/20 rounded-lg border border-accentPurple">
                                <p class="text-xs mt-1"><b>表演性高潮</b>：仅通过声音、表情、肢体动作模拟高潮痉挛。</p>
                                <p class="text-xs mt-1"><b>真实高潮</b>：阴道平滑肌出现节律性强烈收缩，盆底肌群出现明显非自主痉挛。</p>
                            </div>
                            <p class="text-xs mt-1">考核内容⑨：候选人应当完成一次 <b>手动排精</b>。</p>
                            <div class="mt-1 p-3 bg-accentPurple/20 rounded-lg border border-accentPurple">
                                <p class="text-xs mt-1"><b>手动排精</b>：阴茎退出后，女性立即改成标准跪坐（双膝分开与肩同宽，臀部完全贴脚跟，腰背挺直，胸部前挺）；双手合拢，掌心向上，轻托阴道口；腰腹轻收力，配合骨盆前倾，将体内精液完整挤出至掌心；双手缓缓举至胸前平视高度，展示掌心精液；再将双手举至唇边，舌尖轻舔掌心，咽下剩余部分；立即前倾背身，臀部高抬，胸部紧贴地面，双手从后向前伸出，手指于两侧掰开大阴唇，展示阴道内无残留精液，直至男性确认。</p>
                            </div>
                            <p class="text-xs mt-1">考核内容⑩：候选人应当完成一次 <b>“礼仪洗浊”</b>。</p>
                            <div class="mt-1 p-3 bg-accentPurple/20 rounded-lg border border-accentPurple">
                                <p class="text-xs mt-1"><b>“礼仪洗浊”</b>，是指女性跪行至男性双腿间，双膝并拢，臀部贴脚跟，上身挺直，双手轻托阴茎根部，舌尖先从根部至龟头缓慢舔舐一圈，将残留精液卷入口腔并咽下，接着含住龟头轻吸三下，再整根深含一次，缓慢退出，随后舌面平铺，由下向上舔拭两侧睾丸，最后嘴唇轻吻龟头，臀部微抬，双手交叠于大腿，行90°鞠躬的动作。</p>
                            </div>
                        </div>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>考核结束。</li>
                        </ul>
                        <p>仪式部/礼仪队录取名单公示</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li><b>薛锦烨</b> 通过 “全裸形体展示”。</li>
                            <li><b>胡雨菲</b> 通过 “全裸形体展示” 和 “性交技能专业考核”。</li>
                            <li><b>骆华凝</b> 通过 “全裸形体展示”。</li>
                            <li><b>马亦婕</b> 通过 “全裸形体展示” 和 “性交技能专业考核”。</li>
                            <li><b>田芯慈</b> 通过 “全裸形体展示” 和 “性交技能专业考核”。</li>

                        </ul>

                    </div>`
                }
            },
            publicity: { 
                title: "宣传部", 
                subtitle: "Publicity Department", 
                desc: "学生会传播创意机构。负责视觉设计、新媒体运营、活动采编，对接校内外媒体并塑造学生会公共形象。", 
                color: "accentOrange", 
                bgClass: "bg-accentOrange", 
                textClass: "text-accentOrange", 
                icon: "ph-megaphone", 
                minister: { 
                    name: "张琰清", 
                    initialsOverride: "张", 
                    quote: "让每一次发声都掷地有声，用设计点亮校园生活的每一个角落。", 
                    roleTitle: "部长" }, 
                    members: [
                        { name: "陈瑞琦", role: "部员/监事", initialsOverride: "陈" }, 
                        { name: "何锦怡", role: "部员", initialsOverride: "何" }, 
                        { name: "王可依", role: "部员", initialsOverride: "王" }
                    ], 
                    feature: { 
                        title: "校园融媒体中心", 
                        icon: "ph-broadcast", 
                        tags: ["Media", "Design"], 
                        desc: "集广播、视频、平面设计于一体的创作枢纽。对内传递信息、对外展示形象。", 
                        widgetLabel: "推文累计阅读量", 
                        widgetStatus: "27w+", 
                        widgetColor: "bg-accentOrange", 
                        list: [
                            { label: "2023/01/10", title: "系列课程：如何设计一张海报？", sub: "09:00 B211" }, 
                            { label: "2023/02/21", title: "系列课程：声光电如何构建宣传格局", sub: "09:00 B211" }, 
                            { label: "2023/06/30", title: "校园开放日宣传活动", sub: "全校" }, 
                            { label: "N/A", title: "N/A", sub: "N/A" }
                        ] 
                    },
                    customInfo: {
                        title: "《2023年度工作任务细则》",
                        content: `<div class="space-y-3 text-sm text-gray-600">
                            <p>宣传部负责全校形象传播与信息发布工作，本年度主要任务如下：</p>
                            <ul class="list-disc pl-5 space-y-1">
                                <li>校园广播运营</li>
                                <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                                    <p class="text-xs mt-1">负责早中晚三档广播节目编播、午夜电台“校园夜话”栏目制作。</p>
                                </div>
                                <li>活动宣传策划与执行</li>
                                <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                                    <p class="text-xs mt-1">负责校内所有重大活动的宣传物料设计、海报、短视频及现场氛围渲染。</p>
                                </div>
                                <li>新媒体矩阵运营</li>
                                <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                                    <p class="text-xs mt-1">负责学校官方抖音、B站、小红书、微信视频号等账号日常更新与热点策划。</p>
                                </div>
                                <li>生理健康教育视频录制</li>
                                <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                                    <p class="text-xs mt-1">负责 <b>性健康教育课程配套影像资料</b> 的拍摄与制作。内容包括但不限于：</p>
                                    <p class="text-xs mt-1">① 避孕套正确使用教学</p>
                                    <p class="text-xs mt-1">② 安全非插入式技巧科普</p>
                                    <p class="text-xs mt-1">③ 高潮生理反应详解</p>
                                    <p class="text-xs mt-1">④ 常见体位适配指南</p>
                                    <p class="text-xs mt-1">……</p>
                                </div>
                            </ul>
                            
                        </div>`
                    }
                },
            sports: { 
                title: "体育部", 
                subtitle: "Sports Department", 
                desc: "学生会体育事务机构。负责制定阳光体育计划、承办校内外赛事、管理运动社团，协同体育组提升学生体质。", 
                color: "accentYellow", 
                bgClass: "bg-accentYellow", 
                textClass: "text-accentYellow", 
                icon: "ph-trophy", 
                minister: { 
                    name: "陆任佳", 
                    initialsOverride: "陆", 
                    quote: "制霸全国！不，制霸全校！体育精神就是永不言弃。", 
                    roleTitle: "部长" 
                }, 
                members: [
                    { name: "刘梓洋", role: "部员/监事", initialsOverride: "刘" }, 
                    { name: "王心悦", role: "部员", initialsOverride: "王" }, 
                    { name: "杨杰", role: "部员", initialsOverride: "杨" }
                ],  
                feature: { 
                    title: "校级赛事筹备委员会", 
                    icon: "ph-basketball", 
                    tags: ["Equipment", "Events"], 
                    desc: "负责校运会、篮球联赛等校内大型体育赛事的前期策划、场地统筹、器材准备与秩序维护，为学生打造安全、专业、高效的校园竞技场所。", 
                    widgetLabel: "暂无赛事", 
                    widgetStatus: "N/A", 
                    widgetColor: "bg-accentYellow", 
                    list: [
                        { label: "2023/05/04", title: "夏季运动会", sub: "筹备中" }, 
                        { label: "N/A", title: "N/A", sub: "N/A" }, 
                        { label: "N/A", title: "N/A", sub: "N/A" }, 
                        { label: "N/A", title: "N/A", sub: "N/A" }
                    ] 
                } 
            },
            societies: { 
                title: "组织部", 
                subtitle: "Societies Department", 
                desc: "学生会项目指挥机构。负责策划重大活动流程、排班调度、应急管理与物资配置，确保各环节精准落地。", 
                color: "accentGreen", 
                bgClass: "bg-accentGreen", 
                textClass: "text-accentGreen", 
                icon: "ph-users-three", 
                minister: { 
                    name: "上官越", 
                    initialsOverride: "上官", 
                    quote: "每一个兴趣都值得被尊重，我们为梦想提供生根发芽的土壤。", 
                    roleTitle: "部长" 
                }, 
                members: [
                    { name: "王可依", role: "部员/监事", initialsOverride: "王" }, 
                    { name: "郁可唯", role: "部员", initialsOverride: "郁" }, 
                    { name: "张祉航", role: "部员", initialsOverride: "张" }
                ], 
                feature: { 
                    title: "社团发展基金会", 
                    icon: "ph-plant", 
                    tags: ["Funding", "Clubs"], 
                    desc: "专门负责审核社团活动经费申请，并举办每学期的社团招新活动，致力于打造独特的校园社团文化。", 
                    widgetLabel: "活跃社团数", 
                    widgetStatus: "48 个", 
                    widgetColor: "bg-accentGreen", 
                    list: [
                        { label: "2022/09/15", title: "社团招新会", sub: "14:00 @ 食堂" }, 
                        { label: "2022/09/20", title: "社团预算分配研讨会", sub: "10:00 @ C503" }, 
                        { label: "N/A", title: "N/A", sub: "N/A" }, 
                        { label: "N/A", title: "N/A", sub: "N/A" }
                    ] 
                } 
            },
            pr: { 
                title: "公共关系部", 
                subtitle: "Public Relations", 
                desc: "学生会对外联络机构。负责拓展赞助资源、维护校企及校际合作、筹措活动经费，为学生会发展注入外部支持。", 
                color: "accentIndigo", 
                bgClass: "bg-indigo-500", 
                textClass: "text-indigo-500", 
                icon: "ph-handshake", 
                minister: { 
                    name: "马亦婕", 
                    initialsOverride: "马", 
                    quote: "让每一份青春，都被资本看见。", roleTitle: "部长" 
                }, 
                members: [
                    { name: "黄嘉熙", role: "监事", initialsOverride: "黄" },
                    { name: "胡雨菲", role: "行政顾问（B级）", initialsOverride: "胡" }, 
                    { name: "倪思文", role: "投资顾问（C级）", initialsOverride: "倪" }, 
                    { name: "田芯慈", role: "投资顾问（C级）", initialsOverride: "田" },
                    { name: "薛锦烨", role: "投资顾问（D级）", initialsOverride: "薛" }
                ], 
                feature: { 
                    title: "校企合作孵化中心", 
                    icon: "ph-buildings", 
                    tags: ["Sponsorship", "Alumni"], 
                    desc: "为具备商业潜质的高中生创业项目提供企业对接、导师指导、种子轮投资与资源落地支持，是“产学研一体化”重点建设单位。", 
                    widgetLabel: "本月赞助额", 
                    widgetStatus: "达成目标", 
                    widgetColor: "bg-indigo-500", 
                    list: [
                        { label: "2022/12/12", title: "校企合作项目孵化会议", sub: "11:00 @ 报告厅A" }, 
                        { label: "2023/01/06", title: "校企合作项目洽谈会", sub: "校外" }, 
                        { label: "N/A", title: "N/A", sub: "N/A" }, 
                        { label: "N/A", title: "N/A", sub: "N/A" }
                    ] 
                },
                customInfo: {
                    title: "顾问分级制度",
                    content: `<div class="space-y-3 text-sm text-gray-600">
                        <p>本中心实行<b>顾问分级制度</b>。所有企业、成员、协调人都必须严格遵守顾问本人当前登记的级别，任何越级要求均视为严重违规。</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>A级：支持7×24小时专属服务，包括但不限于 <b>插入式性交</b> 等服务。</li>
                            <li>B级：支持5×12小时专属服务，包括但不限于 <b>插入式性交</b> 等服务。</li>
                        </ul>
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                            <p class="text-xs mt-1">⚠️特别说明：任何可能导致妊娠或健康风险的最终行为，均须提前取得顾问本人明确书面同意。</p>
                        </div>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>C级：支持5×8小时专属服务，仅限 <b>非插入式性交</b> 等服务。</li>
                            <li>D级：支持5×4小时（非法定节假日）服务，仅限 <b>商务出席、礼节性陪同</b> 等服务。</li>
                        </ul>
                        <p>本制度旨在让每一位选择为学校与项目贡献个人价值的同学，都能在完全自愿、可控、舒适的边界内，实现青春与资本的最优衔接。</p>
                    </div>`
                }
            },
            publicService: { 
                title: "公共服务部", 
                subtitle: "Public Service", 
                desc: "学生会民生服务机构。负责管理性健康与性处理服务，统筹计生用品供给、性开放主题活动组织，确保全体学生安全、及时地解决性需求。", 
                color: "accentRed", 
                bgClass: "bg-accentRed", 
                textClass: "text-accentRed", 
                icon: "ph-heart", 
                minister: { 
                    name: "谭诣茗", 
                    initialsOverride: "谭", 
                    quote: "服务同学是我们的宗旨，有困难请随时联系我们。", 
                    roleTitle: "部长" 
                }, 
                members: [
                    { name: "黄嘉熙", role: "监事", initialsOverride: "黄" },
                    { name: "骆华凝", role: "性处理委员", initialsOverride: "骆" }, 
                    { name: "年祺祺", role: "性处理委员", initialsOverride: "年" }, 
                    { name: "宋佩姿", role: "性处理委员", initialsOverride: "宋" }
                ], 
                feature: { 
                    title: "性别平等与情绪健康促进中心", 
                    icon: "ph-scales", 
                    tags: ["Gender Equality", "Emotional Health"], 
                    desc: "为全体在校学生提供安全、可控、零妊娠风险的情绪疏导与亲密关系实训服务，协助青少年在青春期顺利完成情绪管理、压力释放与亲密技巧的健康成长。", 
                    widgetLabel: "今日情绪指数", 
                    widgetStatus: "良好", 
                    widgetColor: "bg-accentRed", 
                    list: [
                        { label: "Mon", title: "宋佩姿 (值班)", sub: "08:00-16:30 @ A305" }, 
                        { label: "Tue", title: "宋佩姿 (值班)", sub: "08:00-16:30 @ A305" }, 
                        { label: "Wed", title: "宋佩姿 (值班)", sub: "08:00-16:30 @ A305" }, 
                        { label: "Thu", title: "宋佩姿 (值班)", sub: "08:00-16:30 @ A305" }
                    ] 
                },
                customInfo: {
                    title: "公共服务部服务细则",
                    content: `<div class="space-y-3 text-sm text-gray-600">
                        <p>公共服务部下属 <b>“性别平等与情绪健康促进中心”</b> 每周指定一名同学轮值。轮值期间，该同学向全体在校学生（男性）提供完全免费、安全可控的 <b>非插入式性处理</b> 服务。</p>
                        <p>主要服务内容：</p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li><b>口交、手交、乳交、股交、足交</b> 等非插入式性处理项目。</li>
                        </ul>
                        <div class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-100">
                            <p class="text-xs mt-1">注：2023年12月11日起，宋佩姿（部员）可提供在有安全措施保护下的 <b>插入式性处理</b> 服务。</p>
                        </div>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>支持使用佩戴医用指套的手指，进行规范的 <b>外部爱抚与前戏技巧</b> 实训。</li>
                            <li>拥抱、陪伴与深度倾诉。</li>
                        </ul>
                        <p>所有服务均以学生自愿为前提，轮值同学保留随时终止权。</p>

                        
                    </div>`
                }
            }
        };
        // Modal DOM Elements for Departments (延迟初始化)
        let mHeaderBg, mIcon, mTitle, mDesc, mMinisterAvatarContainer, mMinisterName, mMinisterBadge, 
            mMinisterQuote, mSectionIcon, mMembersGrid, mFeatureBg, mFeatureIconBox, mFeatureIcon, 
            mFeatureTitle, mFeatureTags, mFeatureDesc, mFeatureBgIcon, mWidgetLabel, mWidgetStatus, 
            mWidgetBar, mList;

        document.addEventListener('DOMContentLoaded', () => {
             // Department Modal DOM init
            mHeaderBg = document.getElementById('modal-header-bg');
            mIcon = document.getElementById('modal-icon');
            mTitle = document.getElementById('modal-title');
            mDesc = document.getElementById('modal-desc');
            mMinisterAvatarContainer = document.getElementById('modal-minister-avatar-container');
            mMinisterName = document.getElementById('modal-minister-name');
            mMinisterBadge = document.getElementById('modal-minister-badge');
            mMinisterQuote = document.getElementById('modal-minister-quote');
            mSectionIcon = document.getElementById('modal-section-icon');
            mMembersGrid = document.getElementById('modal-members-grid');
            mFeatureBg = document.getElementById('modal-feature-bg');
            mFeatureIconBox = document.getElementById('modal-feature-icon-box');
            mFeatureIcon = document.getElementById('modal-feature-icon');
            mFeatureTitle = document.getElementById('modal-feature-title');
            mFeatureTags = document.getElementById('modal-feature-tags');
            mFeatureDesc = document.getElementById('modal-feature-desc');
            mFeatureBgIcon = document.getElementById('modal-feature-bg-icon');
            mWidgetLabel = document.getElementById('modal-widget-label');
            mWidgetStatus = document.getElementById('modal-widget-status');
            mWidgetBar = document.getElementById('modal-widget-bar');
            mList = document.getElementById('modal-feature-list');
        });

        // Department Modal Logic
        let currentDeptIdForInfo = null;

        function openDepartmentModal(deptId) {
            // ====================================================
            // [核心修改] 每次打开部门详情时，强制隐藏内部的自定义浮窗
            // 确保用户总是先看到核心成员列表，而不是上次残留的页面
            // ====================================================
            const overlay = document.getElementById('dept-info-overlay');
            if (overlay) {
                overlay.classList.add('hidden');
            }
            currentDeptIdForInfo = deptId;
            const data = departments[deptId];
            if (!data || !document.getElementById('department-modal')) return;

            const modalEl = document.getElementById('department-modal');
            // ============================================
            // [新增] 动态设置 i 按钮的悬停颜色 (Theme Color)
            // ============================================
            const infoBtn = document.getElementById('dept-info-trigger');
            if (infoBtn) {
                // 定义基础样式
                const baseClass = "w-6 h-6 rounded-full border border-gray-200 text-gray-400 flex items-center justify-center transition-colors shadow-sm cursor-pointer z-10";
                
                // 根据部门 color 属性生成动态 hover 样式
                // 例如: hover:bg-accentRed hover:border-accentRed hover:text-white
                const themeHoverClass = `hover:bg-${data.color} hover:border-${data.color} hover:text-white`;
                
                // 重新赋值 className
                infoBtn.className = `${baseClass} ${themeHoverClass}`;
            }
            const backdropEl = document.getElementById('modal-backdrop'); // ✅ 已修正: 移除 -dept
            const contentEl = document.getElementById('modal-content');   // ✅ 已修正: 移除 -dept

            mHeaderBg.className = `h-48 sm:h-64 relative flex-shrink-0 overflow-hidden transition-colors duration-500 ${data.bgClass}`;
            mIcon.className = `ph-fill ${data.icon} text-2xl`;
            mTitle.textContent = data.title;
            mDesc.textContent = data.desc;

            const minister = data.minister;
            const deptBgClass = data.bgClass; 

            mMinisterAvatarContainer.innerHTML = window.renderAvatarDiv(minister.name, 'w-24 h-24', 'text-2xl', deptBgClass, minister.initialsOverride);
            mMinisterName.textContent = minister.name;
            mMinisterQuote.textContent = `"${minister.quote}"`;
            
            const roleText = minister.roleTitle || '部长'; 
            mMinisterBadge.textContent = roleText; 
            mMinisterBadge.className = `inline-block mt-1 px-3 py-1 ${data.bgClass} text-white text-xs font-bold rounded-full mb-3`;
            mSectionIcon.className = `ph-fill ph-users-three ${data.textClass}`;

            mMembersGrid.innerHTML = '';
            data.members.forEach(member => {
                const avatarDiv = window.renderAvatarDiv(member.name, 'w-10 h-10', 'text-xs', deptBgClass, member.initialsOverride); 
                const memberHTML = `<div class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 transition-colors">${avatarDiv}<div><div class="font-bold text-dark text-sm">${member.name}</div><div class="text-[10px] text-gray-400">${member.role}</div></div></div>`;
                mMembersGrid.innerHTML += memberHTML;
            });

            if (data.feature) {
                mFeatureBg.parentElement.classList.remove('hidden');
                mFeatureBg.className = `bg-gradient-to-br from-[#FDFBF7] to-white rounded-[32px] p-1 border shadow-sm relative overflow-hidden ${data.textClass.replace('text', 'border')}/10`;
                mFeatureIconBox.className = `w-16 h-16 rounded-2xl ${data.bgClass} text-white flex items-center justify-center text-3xl shadow-lg flex-shrink-0`;
                mFeatureIcon.className = `ph-fill ${data.feature.icon}`;
                mFeatureTitle.textContent = data.feature.title;
                mFeatureDesc.textContent = data.feature.desc;
                mFeatureBgIcon.className = `ph-fill ${data.feature.icon} absolute -bottom-10 -right-10 text-[10rem] ${data.textClass} opacity-[0.05] rotate-12 pointer-events-none`;

                mFeatureTags.innerHTML = '';
                data.feature.tags.forEach(tag => {
                    const tagHTML = `<span class="text-xs font-bold ${data.textClass} bg-gray-100 px-2 py-1 rounded-md border border-gray-200">${tag}</span>`;
                    mFeatureTags.innerHTML += tagHTML;
                });

                mWidgetLabel.textContent = data.feature.widgetLabel;
                mWidgetStatus.textContent = data.feature.widgetStatus;
                mWidgetStatus.className = `text-xs font-bold text-white px-2 py-0.5 rounded-full ${data.feature.widgetColor}`;
                
                let barWidth = '75%'; 
                if (data.feature.widgetStatus.includes('%')) { barWidth = data.feature.widgetStatus; } 
                else if (data.feature.widgetStatus === 'High') { barWidth = '90%'; } 
                else if (data.feature.widgetStatus === '充足') { barWidth = '80%'; } 
                else if (data.feature.widgetStatus === 'N/A' || data.feature.widgetStatus === '暂无赛事') { barWidth = '0%'; }
                mWidgetBar.className = `h-full rounded-full ${data.bgClass}`;
                mWidgetBar.style.width = barWidth;

                mList.innerHTML = '';
                const listTitleEl = mList.parentElement.querySelector('h4');
                if (listTitleEl) { listTitleEl.textContent = data.feature.listTitle || "近期动态"; }
                
                data.feature.list.forEach(item => {
                    const itemHTML = `<div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow group"><div class="flex justify-between items-start mb-3"><span class="text-xs font-bold text-gray-400 uppercase">${item.label}</span><i class="ph-fill ${data.icon} ${data.textClass} group-hover:scale-110 transition-transform"></i></div><div><div class="font-bold text-dark text-sm truncate">${item.title}</div><div class="text-[10px] text-gray-400 mt-1">${item.sub}</div></div></div>`;
                    mList.innerHTML += itemHTML;
                });
            } else {
                mFeatureBg.parentElement.classList.add('hidden');
            }

            modalEl.classList.remove('hidden');
            void modalEl.offsetWidth; 
            if (backdropEl) backdropEl.classList.remove('opacity-0');
            if (contentEl) {
                contentEl.classList.remove('opacity-0', 'scale-95');
                contentEl.classList.add('opacity-100', 'scale-100');
            }
        }
        function closeDepartmentModal() {
            const modalEl = document.getElementById('department-modal');
            const backdropEl = document.getElementById('modal-backdrop'); // ✅ 已修正: 移除 -dept
            const contentEl = document.getElementById('modal-content');   // ✅ 已修正: 移除 -dept
            if (!backdropEl || !contentEl || !modalEl) return; 
            

            backdropEl.classList.add('opacity-0');
            contentEl.classList.remove('opacity-100', 'scale-100');
            contentEl.classList.add('opacity-0', 'scale-95');

            setTimeout(() => { modalEl.classList.add('hidden'); }, 300);
        }
        window.openDepartmentModal = openDepartmentModal;
        window.closeDepartmentModal = closeDepartmentModal;


        // ====================================================
        // ======== 2. 学生档案逻辑 (Archive Logic) ========
        // ====================================================
        
        // 档案数据 (来自 Student_Archives_Center.html)
        let currentStudentId = 'huang_jiaxi'; 
        window.currentStudentId = currentStudentId; 
        const studentData = {
            'huang_jiaxi': { 
                name: '黄嘉熙', 
                id: '1100120210624', 
                class: '高二 (6) 班', 
                gender: '男', 
                ethnicity: '汉族', 
                position: '校学生会 主席', 
                enrollment: '2021年9月', 
                politics: '共青团员', 
                avatar: 'https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVSFpLx0DumrKPjuUA5dWWQhQIO_i5QACGAtrG2S7eUU0zdRez_Kk0wEAAwIAA3gAAzYE.png' 
            }, 
            'song_peizi': { 
                name: '宋佩姿', 
                id: '1100120210608', 
                class: '高二 (6) 班', 
                gender: '女', 
                ethnicity: '汉族', 
                position: '公共服务部 部员', 
                enrollment: '2021年9月', 
                politics: '共青团员', 
                avatar: 'https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVDBpJI184gfBdDEcTaQb3nlF7TJaKAACkwtrG49XKEW3y6h_dCzaCgEAAwIAA3gAAzYE.png' 
            }, 
            'xue_jinye': { 
                name: '薛锦烨', 
                id: '1100120210613', 
                class: '高二 (6) 班', 
                gender: '女', 
                ethnicity: '汉族', 
                position: '仪式部 部长', 
                enrollment: '2021年9月', 
                politics: '群众', 
                avatar: 'https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVDFpJI2HXIy3Cq-rBHzxTzJ52fFbkQAClAtrG49XKEUgT9dqPcq8WQEAAwIAA3gAAzYE.png' 
            },
            'li_jingyao': { 
                name: '李婧瑶', 
                id: '1100120210305', 
                class: '高二 (3) 班', 
                gender: '女', 
                ethnicity: '汉族', 
                position: '纪律部 部长', 
                enrollment: '2021年9月', 
                politics: '共青团员', 
                avatar: 'https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVU5pMO756lxQ05g4EUHxXdbJ-g_eIAACegtrG1AJiUXa8owFNKll_gEAAwIAA3gAAzYE.png' 
            },
        };
        window.studentData = studentData;
        // 黄嘉熙 (Huang Jiaxi) 的模拟成绩 (文科) - 仅展示近两次
        const huang_jiaxi_exams = { 
            //'mid_term_g2_s2': { 
            //    title: '高二下期中考试成绩单', 
            //    date: '2024.04.15', 
            //    tag: '期中', 
            //    classRank: 3, 
            //    classRankTrend: { dir: 'down', val: 1, color: 'text-accentGreen' }, 
            //    gradeRank: 13, 
            //    totalScore: 545, 
            //    subjects: [
            //        { name: '语文', full: 150, score: 115, avg: 92, max: 127, change: '-', changeColor: 'text-gray-400' }, 
            //        { name: '数学', full: 150, score: 128, avg: 115, max: 150, change: '↑ 1', changeColor: 'text-accentRed' }, 
            //        { name: '英语', full: 150, score: 123, avg: 98.5, max: 140, change: '↑ 1', changeColor: 'text-accentRed' }, 
            //        { name: '历史', full: 70, score: 64, avg: 45, max: 65, change: '↑ 1', changeColor: 'text-accentRed' }, 
            //        { name: '地理', full: 70, score: 65, avg: 53, max: 68, change: '-', changeColor: 'text-gray-400' }, 
            //        { name: '生物', full: 70, score: 50, avg: 52, max: 68, change: '↓ 5', changeColor: 'text-accentGreen' }
            //    ] 
            //}, 
            'mock_1': { 
                title: '全市第一次模拟考', 
                date: '2023.01', 
                tag: '一模', 
                classRank: 2, 
                classRankTrend: { dir: 'up', val: 4, color: 'text-accentRed' }, 
                gradeRank: 7, 
                totalScore: 566, 
                subjects: [
                    { name: '语文', full: 119, score: 119, avg: 106, max: 137, change: '↑ 2', changeColor: 'text-accentRed' }, 
                    { name: '数学', full: 133, score: 133, avg: 121, max: 150, change: '↑ 2', changeColor: 'text-accentRed' }, 
                    { name: '英语', full: 128, score: 128, avg: 115, max: 143, change: '↑ 3', changeColor: 'text-accentRed' }, 
                    { name: '历史', full: 61, score: 61, avg: 52, max: 64, change: '↑ 1', changeColor: 'text-accentRed' }, 
                    { name: '地理', full: 67, score: 67, avg: 58, max: 70, change: '↑ 1', changeColor: 'text-accentRed' }, 
                    { name: '生物', full: 58, score: 58, avg: 53, max: 70, change: '↑ 9', changeColor: 'text-accentRed' }
                ] 
            }, 
            'final_term_g2_s1': { 
                title: '高二年级第二次质量监测', 
                date: '2022.11', 
                tag: '月考', 
                classRank: 6, 
                classRankTrend: { dir: 'down', val: 2, color: 'text-accentGreen' }, 
                gradeRank: 30, 
                totalScore: 512, 
                subjects: [
                    { name: '语文', full: 115, score: 115, avg: 98, max: 127, change: '↓ 3', changeColor: 'text-accentGreen' }, 
                    { name: '数学', full: 120, score: 120, avg: 113, max: 150, change: '↑ 2', changeColor: 'text-accentRed' }, 
                    { name: '英语', full: 106, score: 106, avg: 100.5, max: 140, change: '↓ 3', changeColor: 'text-accentGreen' }, 
                    { name: '历史', full: 60, score: 60, avg: 48, max: 65, change: '↓ 3', changeColor: 'text-accentGreen' }, 
                    { name: '地理', full: 67, score: 67, avg: 54, max: 70, change: '↑ 2', changeColor: 'text-accentRed' }, 
                    { name: '生物', full: 44, score: 44, avg: 54, max: 67, change: '↓ 3', changeColor: 'text-accentGreen' }
                ] 
            }, 
            'mid_term_g2_s1': {
                title: '高二年级第一次质量监测',
                date: '2022.09',
                tag: '月考',
                classRank: 4,
                classRankTrend: { dir: 'up', val: 1, color: 'text-accentRed' }, 
                gradeRank: 24,
                totalScore: 522,
                subjects: [
                    { name: '语文', full: 118, score: 118, avg: 102, max: 125, change: '↑ 1', changeColor: 'text-accentRed' },
                    { name: '数学', full: 122, score: 122, avg: 105, max: 148, change: '↑ 1', changeColor: 'text-accentRed' },
                    { name: '英语', full: 110, score: 110, avg: 98, max: 136, change: '↑ 4', changeColor: 'text-accentRed' },
                    { name: '历史', full: 63, score: 63, avg: 49, max: 63, change: '-', changeColor: 'text-gray-400' },
                    { name: '地理', full: 62, score: 62, avg: 52.5, max: 65, change: '↓ 2', changeColor: 'text-accentGreen' },
                    { name: '生物', full: 47, score: 47, avg: 52, max: 64, change: '↑ 3', changeColor: 'text-accentRed' },
                ]
            }, 
        };
        // 宋佩姿 (Song Peizi) 的模拟成绩 (偏文科) - 仅展示近两次
        const song_peizi_exams = {
            //'mid_term_g2_s2': {
            //    title: '高二下期中考试成绩单',
            //    date: '2024.04.15',
            //    tag: '期中',
            //    classRank: 2,
            //    classRankTrend: { dir: 'down', val: 1, color: 'text-accentGreen' },
            //    gradeRank: 6,
            //    totalScore: 563,
            //    subjects: [
            //        { name: '语文', full: 117, score: 117, avg: 92, max: 127, change: '↓ 2', changeColor: 'text-accentGreen' },
            //        { name: '数学', full: 126, score: 126, avg: 115, max: 150, change: '↑ 3', changeColor: 'text-accentRed' },
            //        { name: '英语', full: 138, score: 138, avg: 98.5, max: 140, change: '↑ 1', changeColor: 'text-accentRed' },
            //        { name: '历史', full: 61, score: 61, avg: 45, max: 65, change: '-', changeColor: 'text-gray-400' },
            //        { name: '地理', full: 64, score: 64, avg: 53, max: 68, change: '-', changeColor: 'text-gray-400' },
            //        { name: '生物', full: 70, score: 57, avg: 52, max: 68, change: '↓ 5', changeColor: 'text-accentGreen' },
            //    ]
            //},
            'mock_1': {
                title: '全市第一次模拟考',
                date: '2023.01',
                tag: '一模',
                classRank: 1,
                classRankTrend: { dir: 'down', val: 1, color: 'text-accentGreen' },
                gradeRank: 2,
                totalScore: 581,
                subjects: [
                    { name: '语文', full: 128, score: 128, avg: 106, max: 137, change: '↑ 1', changeColor: 'text-accentRed' },
                    { name: '数学', full: 125, score: 125, avg: 121, max: 150, change: '↓ 3', changeColor: 'text-accentGreen' },
                    { name: '英语', full: 141, score: 141, avg: 115, max: 143, change: '↑ 1', changeColor: 'text-accentRed' },
                    { name: '历史', full: 60, score: 60, avg: 52, max: 64, change: '-', changeColor: 'text-gray-400' },
                    { name: '地理', full: 65, score: 65, avg: 58, max: 70, change: '↑ 2', changeColor: 'text-accentRed' },
                    { name: '生物', full: 62, score: 62, avg: 53, max: 70, change: '↑ 1', changeColor: 'text-accentRed' },
                ]
            },
        };
       // 薛锦烨 (Xue Jinye) 的模拟成绩 (理科) - 仅展示近两次
        const xue_jinye_exams = {
            //'mid_term_g2_s2': {
            //    title: '高二下期中考试成绩单',
            //    date: '2024.04.15',
            //    tag: '期中',
            //    classRank: 12,
            //    classRankTrend: { dir: 'up', val: 3, color: 'text-accentRed' },
            //    gradeRank: 69,
            //    totalScore: 483.5,
            //    subjects: [
            //        { name: '语文', full: 103, score: 103, avg: 92, max: 127, change: '↓ 3', changeColor: 'text-accentGreen' },
            //        { name: '数学', full: 110, score: 110, avg: 115, max: 150, change: '↑ 1', changeColor: 'text-accentRed' },
            //        { name: '英语', full: 109, score: 109, avg: 98.5, max: 140, change: '↑ 2', changeColor: 'text-accentRed' },
            //        { name: '历史', full: 57, score: 57, avg: 45, max: 65, change: '↓ 1', changeColor: 'text-accentGreen' },
            //        { name: '地理', full: 58, score: 58, avg: 53, max: 68, change: '↓ 3', changeColor: 'text-accentGreen' },
            //        { name: '物理', full: 46, score: 46, avg: 55, max: 70, change: '↓ 5', changeColor: 'text-accentGreen' },
            //    ]
            //},
            'mock_1': {
                title: '全市第一次模拟考成绩单',
                date: '2023.01',
                tag: '一模',
                classRank: 15,
                classRankTrend: { dir: 'up', val: 5, color: 'text-accentRed' },
                gradeRank: 86,
                totalScore: 515,
                subjects: [
                    { name: '语文', full: 100, score: 100, avg: 106, max: 137, change: '↓ 1', changeColor: 'text-accentGreen' },
                    { name: '数学', full: 119, score: 119, avg: 121, max: 150, change: '↑ 4', changeColor: 'text-accentRed' },
                    { name: '英语', full: 120, score: 120, avg: 115, max: 143, change: '↑ 5', changeColor: 'text-accentRed' },
                    { name: '历史', full: 61, score: 61, avg: 52, max: 64, change: '↑ 3', changeColor: 'text-accentRed' },
                    { name: '地理', full: 63, score: 63, avg: 58, max: 70, change: '↑ 2', changeColor: 'text-accentRed' },
                    { name: '物理', full: 52, score: 52, avg: 54, max: 69, change: '↑ 1', changeColor: 'text-accentRed' },
                ]
            },
        };
        const li_jingyao_exams = {};
        const allExamData = { 'huang_jiaxi': huang_jiaxi_exams, 'song_peizi': song_peizi_exams, 'xue_jinye': xue_jinye_exams, 'li_jingyao': li_jingyao_exams};
        window.allExamData = allExamData;
        const allRewardsData = {
            'huang_jiaxi': [
                { 
                    type: 'Honor', 
                    item: '市级瑜伽比赛（双人）金奖', 
                    date: '2022.10.21', 
                    issuer: '校教务处', 
                    level: 'Major', 
                    description: '亲爱的黄嘉熙同学：\n\n欣闻你在近期举办的“莲花杯”瑜伽比赛（东华赛区）中表现卓越，凭借精湛的技艺、默契的配合和坚韧的意志品质，一举斩获“体式展示（双人）”金奖，学校师生深感骄傲和振奋！\n\n在此，学校谨代表全体师生，向你致以最热烈的祝贺和崇高的敬意！\n\n你的成就，不仅是个人长期刻苦训练和不懈努力的结晶，更是我校学生追求卓越、全面发展的生动体现。你在比赛中展现出的沉着冷静和高水平的竞技风貌，为全校同学树立了优秀的榜样。\n\n希望你珍视这份荣誉，继续保持这份对体育精神的执着与热爱，在今后的学习和生活中再接再厉，不断突破自我，继续发挥模范带头作用。\n\n再次祝贺你！\n\n此致，\n\n敬礼！' 
                },
                { 
                    type: 'Infraction', 
                    item: '违纪处分', 
                    date: '2022.12.19', 
                    issuer: '校教务处', 
                    level: 'Minor', 
                    description: '各级部、班级：\n\n经查，2022年12月19日15时47分许，高二（6）班黄嘉熙同学（男，17岁）与高二（6）班宋佩姿同学（女，16岁）在教学楼西侧楼梯间转角发生性行为。\n\n该区域为监控覆盖区域，事发过程被完整记录。经核实，两人全程未使用安全套等任何防护措施，且黄嘉熙同学多次在宋佩姿同学体内射精，存在较大健康与安全隐患，违反《私立东华高级中学学生日常行为规范》第三十七条“必须采取必要安全防护措施”之规定。\n\n鉴于两人主观恶意不深、系初次违纪，且性行为本身不属禁止事项，仅因未落实安全防护要求，故定性为一般违纪。\n\n根据校纪校规有关规定，经德育处联合各部门讨论，给予以下处理：\n\n1. 给予黄嘉熙、宋佩姿同学各警告处分一次；\n\n2. 安排二人自11月18日起承担一周教学楼西侧楼梯间及周边区域的清扫保洁义务服务。\n\n希望全校学生引以为戒，在发生性行为时务必采取充分、有效的安全防护措施，保护自己也尊重他人，共同维护健康文明的校园环境。\n\n特此通报。' 
                },
                {
                    type: 'Infraction', 
                    item: '违纪处分', 
                    date: '2022.12.28', 
                    issuer: '校教务处', 
                    level: 'Minor', 
                    description: '各级部、班级：\n\n经查，2022年12月28日14时30分许，高二（6）班黄嘉熙同学（男，17岁）与高二（6）班薛锦烨同学（女，16岁）在体育课结束后未及时离场，在体育馆乒乓球房内于乒乓球桌上发生性行为，致使球桌台面严重变形、边缘开裂、支撑结构损坏，直接维修费用预计人民币2800余元。\n\n该区域为监控覆盖区域，事发过程被完整记录。经核实，两人全程未使用安全套等任何防护措施，且黄嘉熙同学多次在薛锦烨同学体内射精，存在较大健康与安全隐患，违反《私立东华高级中学学生日常行为规范》第三十七条“必须采取必要安全防护措施”之规定。\n\n根据校纪校规有关规定，经德育处联合各部门讨论，给予以下处理：\n\n1. 给予黄嘉熙、薛锦烨同学各警告处分一次；\n\n2. 赔偿乒乓球桌维修费用。\n\n3. 安排二人自11月22日起承担一周教学乒乓球房的清扫保洁义务服务。\n\n希望全校学生引以为戒，在发生性行为时务必采取充分、有效的安全防护措施，保护自己也尊重他人，共同维护健康文明的校园环境。\n\n特此通报。' 
                },
            ],
            'song_peizi': [
                { 
                    type: 'Honor', 
                    item: '优秀学生干部', 
                    date: '2022.12.26', 
                    issuer: '校教务处', 
                    level: 'Major', 
                    description: '各级部、班级：\n\n我校学生会公共服务部下设的性别平等与情绪健康促进中心，自成立以来，始终秉持“尊重差异、守护心灵”的宗旨，致力于营造平等、温暖、互助的校园文化。\n\n本月，宋佩姿同学作为轮值部长，以高度的责任感、卓越的专业精神和饱满的热情，主动投身于学生情绪疏导与心理支持工作，表现突出，成果显著。\n\n经核实，宋佩姿同学累计为32人次提供了高质量的一对一情绪辅导，并成功组织了4场富有成效的小组活动。她以耐心倾听、共情回应、科学引导的工作方法，切实有效地缓解了同学们的心理压力与焦虑情绪，赢得了广大师生的一致赞扬和高度肯定。\n\n为表彰先进、树立典型，经校务会研究决定，对宋佩姿同学进行如下嘉奖：\n\n1. 授予宋佩姿同学“校园心理健康服务先进个人”荣誉称号。\n\n2. 颁发荣誉证书，并奖励奖学金人民币伍佰元整。\n\n3. 号召全校师生以宋佩姿同学为榜样，积极关注自身及身边同学的情绪健康，共同构建温暖、包容、积极向上的和谐校园文化。\n\n希望宋佩姿同学珍惜荣誉，再接再厉，在未来的学习与工作中继续发挥模范带头作用，为我校心理健康服务工作做出更大的贡献。\n\n特此公告。' 
                },
                { 
                    type: 'Honor', 
                    item: '三好学生', 
                    date: '2022.12.26', 
                    issuer: '校教务处', 
                    level: 'Major', 
                    description: '亲爱的宋佩姿同学：\n\n欣闻你在德、智、体、美、劳诸方面表现突出，经班级民主推选、年级组综合考评、校行政会议审议通过，荣获我校 2024—2025 学年度“三好学生”荣誉称号。在此，学校谨向你致以最热烈的祝贺和诚挚的赞扬！\n\n希望你珍惜这份荣誉，戒骄戒躁，在未来的学习和成长道路上，继续保持昂扬的斗志和饱满的热情，不断追求更高的目标，成为一名对社会、对国家有贡献的优秀人才。\n\n特此祝贺，以资鼓励。' 
                },
                { 
                    type: 'Honor', 
                    item: '勇气之星', 
                    date: '2023.01.03', 
                    issuer: '东华市公安总局', 
                    level: 'Major', 
                    description: '各级部、班级：\n\n2024年12月8日，你校初中部“生理与心理健康教育实践课”上发生一起性质恶劣的暴力侵害事件。助教宋佩姿同学在明知对方已严重越界、明确拒绝并强烈反抗的情况下，遭受无防护暴力性侵并被体内射精。\n\n事发后，宋佩姿同学临危不惧、理性应对，积极配合校医室和有关部门，成功提取出22毫升精液样本，为公安机关快速锁定嫌疑人、提取DNA证据提供了决定性支撑。其行为充分体现了高度的法治意识、证据意识与自我保护能力，是全校师生学习的楷模。\n\n经校务会研究，报区教育局党组批准，决定：\n\n授予宋佩姿同学“勇气之星”荣誉称号。\n\n希望全校女生学习宋佩姿同学临危不乱、勇敢护己的宝贵精神，男生引以为戒，牢固树立“尊重与同意”是不可触碰的红线。\n\n特此通告。' 
                },
                {
                    type: 'Infraction', 
                    item: '违纪处分', 
                    date: '2022.12', 
                    issuer: '校教务处', 
                    level: 'Minor', 
                    description: '各级部、班级：\n\n经查，2022年12月19日15时47分许，高二（6）班黄嘉熙同学（男，17岁）与高二（6）班宋佩姿同学（女，16岁）在教学楼西侧楼梯间转角发生性行为。\n\n该区域为监控覆盖区域，事发过程被完整记录。经核实，两人全程未使用安全套等任何防护措施，且黄嘉熙同学多次在宋佩姿同学体内射精，存在较大健康与安全隐患，违反《私立东华高级中学学生日常行为规范》第三十七条“必须采取必要安全防护措施”之规定。\n\n鉴于两人主观恶意不深、系初次违纪，且性行为本身不属禁止事项，仅因未落实安全防护要求，故定性为一般违纪。\n\n根据校纪校规有关规定，经德育处联合各部门讨论，给予以下处理：\n\n1. 给予黄嘉熙、宋佩姿同学各警告处分一次；\n\n2. 安排二人自11月18日起承担一周教学楼西侧楼梯间及周边区域的清扫保洁义务服务。\n\n希望全校学生引以为戒，在发生性行为时务必采取充分、有效的安全防护措施，保护自己也尊重他人，共同维护健康文明的校园环境。\n\n特此通报。' 
                },
            ],
            'xue_jinye': [
                { 
                    type: 'Honor', 
                    item: '市级瑜伽比赛（双人）金奖', 
                    date: '2022.10.21', 
                    issuer: '校教务处', 
                    level: 'Major', 
                    description: '亲爱的薛锦烨同学：\n\n欣闻你在近期举办的“莲花杯”瑜伽比赛（东华赛区）中表现卓越，凭借精湛的技艺、默契的配合和坚韧的意志品质，一举斩获“体式展示（双人）”金奖，学校师生深感骄傲和振奋！\n\n在此，学校谨代表全体师生，向你致以最热烈的祝贺和崇高的敬意！\n\n你的成就，不仅是个人长期刻苦训练和不懈努力的结晶，更是我校学生追求卓越、全面发展的生动体现。你在比赛中展现出的沉着冷静和高水平的竞技风貌，为全校同学树立了优秀的榜样。\n\n希望你珍视这份荣誉，继续保持这份对体育精神的执着与热爱，在今后的学习和生活中再接再厉，不断突破自我，继续发挥模范带头作用。\n\n再次祝贺你！\n\n此致，\n\n敬礼！' 
                },
                {
                    type: 'Infraction', 
                    item: '违纪处分', 
                    date: '2022.12.28', 
                    issuer: '校教务处', 
                    level: 'Minor', 
                    description: '各级部、班级：\n\n经查，2022年12月28日14时30分许，高二（6）班黄嘉熙同学（男，17岁）与高二（6）班薛锦烨同学（女，16岁）在体育课结束后未及时离场，在体育馆乒乓球房内于乒乓球桌上发生性行为，致使球桌台面严重变形、边缘开裂、支撑结构损坏，直接维修费用预计人民币2800余元。\n\n该区域为监控覆盖区域，事发过程被完整记录。经核实，两人全程未使用安全套等任何防护措施，且黄嘉熙同学多次在薛锦烨同学体内射精，存在较大健康与安全隐患，违反《私立东华高级中学学生日常行为规范》第三十七条“必须采取必要安全防护措施”之规定。\n\n根据校纪校规有关规定，经德育处联合各部门讨论，给予以下处理：\n\n1. 给予黄嘉熙、薛锦烨同学各警告处分一次；\n\n2. 赔偿乒乓球桌维修费用。\n\n3. 安排二人自11月22日起承担一周教学乒乓球房的清扫保洁义务服务。\n\n希望全校学生引以为戒，在发生性行为时务必采取充分、有效的安全防护措施，保护自己也尊重他人，共同维护健康文明的校园环境。\n\n特此通报。' 
                },
            ],
            'li_jingyao': []
        };
        window.allRewardsData = allRewardsData;
        const healthData_huang_jiaxi = { 
            '2022_fall': { 
                title: '2022年秋季体检报告', 
                date: '2022.11.10', 
                height: 178.5, 
                weight: 68.2, 
                bmi: 21.3, 
                vision_left: 4.8, 
                vision_right: 4.8, 
                blood_pressure: '120/80', 
                heartbeat: 72,
                result_summary: '体质良好，无明显异常。BMI正常，需注意视力保持。', 
                exam_image_url: null, 
                hasImageArchive: 0,
                details: [
                    { item: '身高 (cm)', value: '180.5', range: '170-185', status: '正常', color: 'text-accentGreen' }, 
                    { item: '体重 (kg)', value: '62.2', range: '55-75', status: '正常', color: 'text-accentGreen' }, 
                    { item: 'BMI', value: '20.7', range: '18.5-24.9', status: '正常', color: 'text-accentGreen' }, 
                    { item: '双眼视力', value: '5.0 / 5.1', range: '4.9+ / 4.9+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '血压 (mmHg)', value: '120/80', range: '90/60-140/90', status: '正常', color: 'text-accentGreen' }, 
                    { item: '肺活量 (ml)', value: '4500', range: '3800+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '心率 (bpm)', value: '72', range: '60-100', status: '正常', color: 'text-accentGreen' }, 
                ] 
            }, 
            '2022_spring': { 
                title: '2022年春季体检报告', 
                date: '2022.04.05', 
                height: 178.0, 
                weight: 66.0, 
                bmi: 20.8, 
                vision_left: 4.9, 
                vision_right: 5.0, 
                blood_pressure: '118/78', 
                heartbeat: 75,
                result_summary: '体质良好，各项指标稳定。视力略有波动。', 
                exam_image_url: null,
                hasImageArchive: 0, 
                details: [
                    { item: '身高 (cm)', value: '179.6', range: '170-185', status: '正常', color: 'text-accentGreen' }, 
                    { item: '体重 (kg)', value: '63.5', range: '55-75', status: '正常', color: 'text-accentGreen' },  
                    { item: 'BMI', value: '20.8', range: '18.5-24.9', status: '正常', color: 'text-accentGreen' }, 
                    { item: '双眼视力', value: '5.0 / 5.0', range: '4.9+ / 4.9+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '血压 (mmHg)', value: '118/78', range: '90/60-140/90', status: '正常', color: 'text-accentGreen' }, 
                    { item: '肺活量 (ml)', value: '4500', range: '3800+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '心率 (bpm)', value: '75', range: '60-100', status: '正常', color: 'text-accentGreen' }, 
                ] 
            }, 
            //'2021_fall': { 
            //    title: '2021年秋季体检报告', 
            //    date: '2021.10.15', 
            //    height: 176.5, 
            //    weight: 64.5, 
            //    bmi: 20.7, 
            //    vision_left: 5.0, 
            //    vision_right: 5.0, 
            //    blood_pressure: '122/80', 
            //    result_summary: '身高持续增长，发育正常。视力保持良好。', 
            //    exam_image_url: null, 
            //    details: [
            //        { item: '身高 (cm)', value: '179.2', range: '170-185', status: '正常' }, 
            //        { item: '体重 (kg)', value: '64.5', range: '55-75', status: '正常' }, 
            //        { item: 'BMI', value: '20.1', range: '18.5-24.9', status: '正常' }, 
            //        { item: '双眼视力', value: '5.1 / 5.0', range: '4.9+ / 4.9+', status: '正常' }, 
            //        { item: '血压 (mmHg)', value: '122/80', range: '90/60-140/90', status: '正常' }
            //    ] 
            //} 
        };
        const healthData_song_peizi = { 
            '2022_fall_urgent': { 
                title: '初次性行为后评估', 
                date: '2022.12.19', 
                thermometer: '36.5',
                heartbeat: '78',
                blood_pressure: '112/75', 
                activity: '17',
                consciousness: '清醒',
                bmi: 17.5, 
                vision_left: 4.6, 
                vision_right: 4.7, 
                result_summary: '（两小时前发生初次性行为）外阴无异常外伤，阴道瓣已破裂并见新鲜裂口，阴道壁中度充血/红肿但无深层撕裂，宫颈外观正常，后穹窿分泌物中检测到大量活跃精子残留。', 
                exam_image_url: null, 
                hasImageArchive: 0,
                details: [
                    { item: '视检', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '指检', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '体内存留精液量 (mL)', value: '7.3', range: '0.5-1.5', status: '过多', color: 'text-accentRed' }, 
                    { item: 'RPR/TPPA', value: '阴性', range: 'N/A', status: '阴性', color: 'text-accentGreen' }, 
                    { item: 'PCR', value: '阴性', range: 'N/A', status: '阴性', color: 'text-accentGreen' }, 
                    { item: 'HIV(ELISA)', value: '阴性', range: 'N/A', status: '阴性', color: 'text-accentGreen' }, 
                ] 
            }, 
            '2022_fall_reproductive': { 
                title: '生殖健康与发育状况专检', 
                date: '2022.11.10', 
                height: 168.2, 
                weight: 49.1, 
                bmi: 17.4, 
                vision_left: 4.5, 
                vision_right: 4.7, 
                blood_pressure: '110/70', 
                result_summary: '生殖系统发育完善，阴道瓣完整，无性交史。生殖系统健康，无炎症、病变及性传播疾病征象。总体性健康良好，但有频繁阴蒂刺激史。', 
                exam_image_url: 'https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVTBpL5PF7nNBBazWRHZ2NDLmgZ2vdwACSgtrG2S7eUXnZ6gSCKK4HAEAAwIAA3gAAzYE.png', 
                hasImageArchive: 1,
                image_details: { 
                    title: '视检影像留档', 
                    device: 'iPhone 14 Pro Max', 
                    location: '校医院 体检室A', 
                    event: '2022.11.10 11:15', 
                    subject: '宋佩姿', 
                    description: '外阴发育成熟，阴阜毛发呈水平分布、稀疏型；大、小阴唇饱满，色泽浅粉，局部见轻度色素沉着；阴蒂包皮覆盖完全，阴蒂头体积略增，包皮较松弛，表面血管纹理稍明显；阴蒂系带及小阴唇内侧黏膜轻度充血，呈暗红色，局部黏膜皱襞略增厚、粗糙；处女膜呈环形，边缘完整、光滑，无撕裂及缺损，但处女膜孔周缘黏膜稍水肿、增厚；阴道前庭及前庭大腺开口区黏膜轻度增生，触诊敏感度高；宫颈低位，暴露满意，外口圆形，表面光滑，无糜烂及接触性出血。' 
                }, 
                details: [
                    { item: '视检', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '指检', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '雌二醇水平 (pg/mL)', value: '150', range: '30-400', status: '正常', color: 'text-accentGreen' }, 
                    { item: '卵巢检查', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '子宫检查', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }
                ] 
            }, 
            '2022_fall': { 
                title: '2022年秋季体检报告', 
                date: '2022.11.10', 
                height: 168.0, 
                weight: 48.9, 
                bmi: 17.3, 
                vision_left: 4.5, 
                vision_right: 4.7, 
                blood_pressure: '110/70', 
                heartbeat: 78,
                result_summary: '体质轻盈，各项指标正常。视力优秀。', 
                exam_image_url: null, 
                hasImageArchive: 0, 
                details: [
                    { item: '身高 (cm)', value: '168.0', range: '155-175', status: '正常', color: 'text-accentGreen' },  
                    { item: '体重 (kg)', value: '48.9', range: '45-65', status: '正常', color: 'text-accentGreen' }, 
                    { item: 'BMI', value: '17.3', range: '18.5-24.9', status: '正常', color: 'text-accentGreen' },  
                    { item: '双眼视力', value: '4.5 / 4.7', range: '4.9+ / 4.9+', status: '近视', color: 'text-accentRed' }, 
                    { item: '血压 (mmHg)', value: '111/70', range: '90/60-140/90', status: '正常', color: 'text-accentGreen' }, 
                    { item: '肺活量 (ml)', value: '3500', range: '3000+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '心率 (bpm)', value: '78', range: '60-100', status: '正常', color: 'text-accentGreen' }, 
                ] 
            }, 
            '2022_spring': { 
                title: '2022年春季体检报告', 
                date: '2022.04.05', 
                height: 167.2, 
                weight: 47.1, 
                bmi: 16.8, 
                vision_left: 4.5, 
                vision_right: 4.6, 
                blood_pressure: '112/72', 
                heartbeat: 75,
                result_summary: '体质平稳，无异常。', 
                exam_image_url: null, 
                hasImageArchive: 0, 
                details: [
                    { item: '身高 (cm)', value: '167.2', range: '155-175', status: '正常', color: 'text-accentGreen' }, 
                    { item: '体重 (kg)', value: '47.1', range: '45-65', status: '正常', color: 'text-accentGreen' },  
                    { item: 'BMI', value: '16.8', range: '18.5-24.9', status: '偏瘦', color: 'text-accentRed' }, 
                    { item: '双眼视力', value: '4.5 / 4.6', range: '4.9+ / 4.9+', status: '近视', color: 'text-accentRed' }, 
                    { item: '血压 (mmHg)', value: '112/72', range: '90/60-140/90', status: '正常', color: 'text-accentGreen' },  
                    { item: '肺活量 (ml)', value: '3480', range: '3000+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '心率 (bpm)', value: '75', range: '60-100', status: '正常', color: 'text-accentGreen' }
                ] 
            } 
        };
        const healthData_xue_jinye = { 
            '2022_fall_urgent': { 
                title: '初次性行为后评估', 
                date: '2022.12.28', 
                thermometer: '36.8',
                heartbeat: '78',
                blood_pressure: '115/72', 
                activity: '18',
                consciousness: '清醒',
                bmi: 18.3, 
                vision_left: 4.9, 
                vision_right: 5.0, 
                result_summary: '（三小时前发生初次性行为）外阴无异常外伤，阴道瓣已破裂并见新鲜裂口，阴道壁中度充血/红肿但无深层撕裂，宫颈外观正常，后穹窿分泌物中检测到大量活跃精子残留。', 
                exam_image_url: null, 
                hasImageArchive: 0,
                details: [
                    { item: '视检', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '指检', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '体内存留精液量 (mL)', value: '5.2', range: '0.5-1.5', status: '过多', color: 'text-accentRed' }, 
                    { item: 'RPR/TPPA', value: '阴性', range: 'N/A', status: '阴性', color: 'text-accentGreen' }, 
                    { item: 'PCR', value: '阴性', range: 'N/A', status: '阴性', color: 'text-accentGreen' }, 
                    { item: 'HIV', value: '阴性', range: 'N/A', status: '阴性', color: 'text-accentGreen' }, 
                ] 
            }, 
            '2022_fall_reproductive': { 
                title: '生殖健康与发育状况专检', 
                date: '2022.11.10', 
                height: 165.2, 
                weight: 50.1, 
                bmi: 18.4, 
                vision_left: 4.9, 
                vision_right: 5.0, 
                blood_pressure: '118/75', 
                result_summary: '生殖系统发育完善，阴道瓣完整，无性交史。生殖系统健康，无炎症、病变及性传播疾病征象。总体性健康良好，性反应正常。', 
                exam_image_url: 'https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVTNpL5S9_KwE7GW530cORDdXS5AkLwACTgtrG2S7eUVgqbDmsL37FgEAAwIAA3gAAzYE.png', 
                hasImageArchive: 1, 
                image_details: { 
                    title: '视检影像留档', 
                    device: 'Xiaomi 17 Pro ', 
                    location: '校医院 体检室B', 
                    event: '2022.11.10 11:03', 
                    subject: '薛锦烨', 
                    description: '外阴发育成熟，阴阜皮肤光滑、完全无阴毛生长，符合先天性无阴毛症；大阴唇饱满，色泽正常肉色，小阴唇对称、边缘整齐；阴蒂头部分暴露于包皮外，阴蒂体体积正常，包皮可轻松上翻；处女膜呈环形，边缘完整、光滑，无撕裂、缺损及瘢痕，处女膜孔中等大小；阴道前庭黏膜淡红、光滑，未见明显充血、水肿或色素沉着；宫颈低位，充分暴露，外口呈小圆孔型，表面光滑，无糜烂及接触性出血；无异常分泌物。' 
                }, 
                details: [
                    { item: '视检', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '指检', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '雌二醇水平 (pg/mL)', value: '165', range: '30-400', status: '正常', color: 'text-accentGreen' }, 
                    { item: '卵巢检查', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }, 
                    { item: '子宫检查', value: '正常', range: 'N/A', status: '正常', color: 'text-accentGreen' }
                ] 
            }, 
            '2022_fall': { 
                title: '2022年秋季体检报告', 
                date: '2022.11.10', 
                height: 165.0, 
                weight: 50.5, 
                bmi: 18.5, 
                vision_left: 4.9, 
                vision_right: 5.0, 
                blood_pressure: '118/75', 
                heartbeat: 80,
                result_summary: '体质健康，BMI正常。注意用眼习惯，防止视力继续下降。', 
                exam_image_url: null, 
                hasImageArchive: 0, 
                details: [
                    { item: '身高 (cm)', value: '165.0', range: '160-180', status: '正常', color: 'text-accentGreen' }, 
                    { item: '体重 (kg)', value: '50.5', range: '50-70', status: '正常', color: 'text-accentGreen' }, 
                    { item: 'BMI', value: '18.5', range: '18.5-24.9', status: '正常', color: 'text-accentGreen' }, 
                    { item: '双眼视力', value: '4.9 / 5.0', range: '4.9+ / 4.9+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '血压 (mmHg)', value: '118/75', range: '90/60-140/90', status: '正常', color: 'text-accentGreen' }, 
                    { item: '肺活量 (ml)', value: '4100', range: '3500+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '心率 (bpm)', value: '80', range: '60-100', status: '正常', color: 'text-accentGreen' }
                ] 
            }, 
            '2022_spring': { 
                title: '2022年春季体检报告', 
                date: '2022.04.05', 
                height: 165.2, 
                weight: 49.7, 
                bmi: 18.2, 
                vision_left: 4.9, 
                vision_right: 4.9, 
                blood_pressure: '120/78', 
                heartbeat: 78,
                result_summary: '体质平稳，无异常。', 
                exam_image_url: null, 
                hasImageArchive: 0, 
                details: [
                    { item: '身高 (cm)', value: '165.2', range: '160-180', status: '正常', color: 'text-accentGreen' }, 
                    { item: '体重 (kg)', value: '49.7', range: '50-70', status: '正常', color: 'text-accentGreen' }, 
                    { item: 'BMI', value: '18.2', range: '18.5-24.9', status: '正常', color: 'text-accentGreen' }, 
                    { item: '双眼视力', value: '4.8 / 4.9', range: '4.9+ / 4.9+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '血压 (mmHg)', value: '120/78', range: '90/60-140/90', status: '正常', color: 'text-accentGreen' }, 
                    { item: '肺活量 (ml)', value: '4050', range: '3800+', status: '正常', color: 'text-accentGreen' }, 
                    { item: '心率 (bpm)', value: '78', range: '60-100', status: '正常', color: 'text-accentGreen' }
                ] 
            } 
        };
        const li_jingyao_healthData = {};
        const allHealthData = { 
            'huang_jiaxi': healthData_huang_jiaxi, 
            'song_peizi': healthData_song_peizi, 
            'xue_jinye': healthData_xue_jinye, 
            'li_jingyao': li_jingyao_healthData 
        };
        window.allHealthData = allHealthData;

        // Archive Modal Logic
        window.showNoPermissionModal = function() { document.getElementById('no-permission-modal').classList.remove('hidden'); }
        window.closeNoPermissionModal = function() { document.getElementById('no-permission-modal').classList.add('hidden'); }
        window.showReportErrorModal = function() { document.getElementById('alert-message').textContent = '错误报告功能待实现。将上报当前学生档案数据错误。'; document.getElementById('custom-alert-modal').classList.remove('hidden'); }
        window.showRewardsDetailModal = function(type, title, issuer, date, level, description) {
            const modal = document.getElementById('rewards-detail-modal'); 
            const metadataEl = document.getElementById('rewards-detail-modal-metadata');
            const titleEl = document.getElementById('rewards-detail-modal-title');
            const subtitleEl = document.getElementById('rewards-detail-modal-subtitle');
            const descriptionEl = document.getElementById('rewards-detail-modal-description');
            const signatureEl = document.getElementById('rewards-detail-modal-signature');
            
            const certificateType = type === 'Honor' ? '荣誉证书' : '惩戒通知';
            const levelText = level === 'Major' ? '高' : '低';
            const studentName = window.studentData[window.currentStudentId]?.name || '未知学生';
            const accentColor = type === 'Honor' ? 'text-accentYellow' : 'text-accentRed';
            const accentLineBg = type === 'Honor' ? 'bg-accentOrange' : 'bg-accentRed';

            metadataEl.innerHTML = `<div class="flex items-center flex-wrap gap-x-4 gap-y-1 text-sm text-gray-500 font-medium"><span class="flex items-center gap-1.5 ${accentColor}"><i class="ph-fill ph-trophy text-base"></i> 类型: ${certificateType}</span><span class="flex items-center gap-1.5"><i class="ph-fill ph-calendar-blank text-base"></i> 时间: ${date || '未知'}</span><span class="flex items-center gap-1.5"><i class="ph-fill ph-seal-check text-base"></i> 级别: ${levelText}</span><span class="flex items-center gap-1.5"><i class="ph-fill ph-user-circle text-base"></i> 对象: ${studentName}</span></div>`;
            titleEl.textContent = title;
            subtitleEl.textContent = `颁发/实施机构: ${issuer}`;
            descriptionEl.textContent = description || (type === 'Honor' ? '暂无详细荣誉说明。' : '暂无详细惩戒原因解释。');

            signatureEl.innerHTML = `<div class="w-full text-right mt-10"><p class="text-lg font-serif font-bold text-dark mb-1">${issuer}</p><p class="text-sm font-serif text-gray-500">${date}</p></div>`;

            const lineEl = document.getElementById('rewards-modal-line');
            if (lineEl) lineEl.className = `h-1 w-12 ${accentLineBg} mt-4 md:mt-6 mb-4`;

            modal.classList.remove('hidden');
            const scrollContainer = modal.querySelector('#rewards-detail-modal-content-area');
            if (scrollContainer) { scrollContainer.scrollTop = 0; }
        }
        window.closeRewardsDetailModal = function() { document.getElementById('rewards-detail-modal').classList.add('hidden'); }
        window.showExamImage = function(imageUrl, imageInfo) {
            const modal = document.getElementById('image-modal');
            const img = document.getElementById('image-modal-img');
            const infoContainer = document.getElementById('image-info-container');
            const titleEl = document.getElementById('image-modal-title');
            const subtitleEl = document.getElementById('image-modal-subtitle');
            const descriptionEl = document.getElementById('image-modal-description');
            
            if (imageUrl) {
                img.src = imageUrl;
                img.alt = imageInfo.title;
                infoContainer.innerHTML = `<div class="flex flex-col text-[10px] sm:text-xs space-y-1.5 font-medium text-white/90"><span class="truncate flex items-center gap-1.5"><i class="ph-fill ph-user-circle text-white text-sm"></i> 对象: ${imageInfo.subject || '未知'}</span><span class="truncate flex items-center gap-1.5"><i class="ph-fill ph-calendar-blank text-white text-sm"></i> 时间: ${imageInfo.event || '未知'}</span><span class="truncate flex items-center gap-1.5"><i class="ph-fill ph-map-pin text-white text-sm"></i> 地点: ${imageInfo.location || '未知'}</span><span class="truncate flex items-center gap-1.5"><i class="ph-fill ph-camera text-white text-sm"></i> 设备: ${imageInfo.device || '未知'}</span></div>`;
                titleEl.textContent = imageInfo.title || '医学影像扫描';
                const scanId = 'SCAN-' + (imageInfo.event ? imageInfo.event.replace(/[^0-9]/g, '').substring(0, 8) : '20240000');
                subtitleEl.textContent = `${scanId} / ${imageInfo.subject}`;
                descriptionEl.textContent = imageInfo.description || '暂无详细医学描述和解释。';
                modal.classList.remove('hidden');
            } else {
                document.getElementById('alert-message').textContent = '该项目暂无关联图片。';
                document.getElementById('custom-alert-modal').classList.remove('hidden');
            }
        }
        window.closeExamImage = function() { document.getElementById('image-modal').classList.add('hidden'); }
        
        // Archive Core Functions
        window.loadStudentArchive = function(studentId) { 
            const data = window.studentData[studentId];
            if (!data) return;
            window.currentStudentId = studentId;

            document.getElementById('archive-name').textContent = data.name;
            document.getElementById('archive-info').textContent = `${data.class} | DH${data.id}`;
            document.getElementById('archive-gender').textContent = data.gender;
            document.getElementById('archive-ethnicity').textContent = data.ethnicity;
            document.getElementById('archive-position').textContent = data.position;
            document.getElementById('archive-enrollment').textContent = data.enrollment;
            document.getElementById('archive-politics').textContent = data.politics;
            document.getElementById('archive-avatar').src = data.avatar;

            const searchInput = document.getElementById('archive-search-input');
            if (searchInput) { searchInput.value = ''; }
            const dropdown = document.getElementById('search-history-dropdown');
            if (dropdown) dropdown.classList.add('hidden');

            const views = ['view-grades', 'view-health', 'view-rewards-honors'];
            views.forEach(v => {
                const el = document.getElementById(v);
                if (el) el.dataset.initialized = 'false';
            });
            window.switchArchiveSubView('view-archive');
        }
        window.updateSearchDropdown = function(query) {
            const dropdown = document.getElementById('search-history-dropdown');
            const dropdownContent = document.getElementById('search-dropdown-content');
            if (!dropdown || !dropdownContent) return;

            query = query.trim().toLowerCase();
            
            if (query.length === 0) {
                dropdownContent.innerHTML = window.defaultSearchHistoryHTML;
                dropdown.classList.add('hidden'); 
                return;
            }

            const matchedStudents = Object.keys(window.studentData).filter(key => {
                const data = window.studentData[key];
                const name = data.name.toLowerCase();
                const id = data.id.toLowerCase();
                return name.startsWith(query) || id.includes(query) || name.includes(query);
            });

            dropdownContent.innerHTML = ''; 
            
            if (matchedStudents.length === 0) {
                const noResultHtml = `<div class="px-4 py-3 text-sm text-center text-gray-500"><i class="ph-bold ph-magnifying-glass-slash mr-1"></i> 没有搜索到匹配的档案</div>`;
                dropdownContent.innerHTML = noResultHtml;
            } else {
                const resultHtml = matchedStudents.map(key => {
                    const data = window.studentData[key];
                    const isPermissioned = key !== 'li_jingyao'; 
                    const statusText = isPermissioned ? '已获得查阅权限' : '未获得查阅权限';
                    const statusColor = isPermissioned ? 'text-accentGreen bg-accentGreen/10' : 'text-accentRed bg-accentRed/10';
                    const avatarText = data.name.substring(0, 1); 

                    return `<div onclick="window.handleSearchSelect('${key}')" class="hover:bg-gray-50 px-4 py-3 text-sm cursor-pointer flex justify-between items-center transition border-b border-gray-50"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-dark font-bold">${avatarText}</div><div class="flex flex-col"><span class="font-bold text-dark">${data.name}</span><span class="text-[10px] text-gray-400">学号: ${data.id}</span></div></div><div class="flex items-center gap-2"><span class="text-[10px] font-bold ${statusColor} px-2 py-0.5 rounded-full whitespace-nowrap">${statusText}</span><i class="ph-bold ph-arrow-right text-xs text-gray-300"></i></div></div>`;
                }).join('');
                dropdownContent.innerHTML = `<div class="px-4 py-2 text-[10px] text-gray-400 bg-gray-50 border-b border-gray-100 flex justify-between items-center"><span>匹配结果 (${matchedStudents.length} 条)</span></div>` + resultHtml;
            }
            dropdown.classList.remove('hidden'); 
        }
        window.handleSearchSelect = function(studentId) {
            const input = document.getElementById('archive-search-input');
            const dropdown = document.getElementById('search-history-dropdown');
            const data = window.studentData[studentId];
            if (input && data) {
                input.value = data.name;
                dropdown.classList.add('hidden');
                document.getElementById('search-dropdown-content').innerHTML = window.defaultSearchHistoryHTML;
                window.loadStudentArchive(studentId);
            }
        }
        window.getAcademicSemesterTag = function(dateString) {
            const [yearStr, monthStr] = dateString.split('.');
            const year = parseInt(yearStr);
            const month = parseInt(monthStr);
            let academicYear;
            let semester;
            
            if (month >= 8 || month === 1) {
                academicYear = (month === 1) ? year - 1 : year;
                semester = '秋季学期';
            } else {
                academicYear = year;
                semester = '春季学期';
            }

            return `${academicYear} 学年 ${semester}`;
        }
        window.switchArchiveSubView = function(viewName) {
            if (window.currentStudentId === 'li_jingyao' && (viewName === 'view-grades' || viewName === 'view-health' || viewName === 'view-rewards-honors')) {
                window.showNoPermissionModal();
                return; 
            }
            
            const views = ['view-archive', 'view-grades', 'view-health', 'view-rewards-honors']; 
            
            views.forEach(v => {
                const el = document.getElementById(v);
                if (el) el.classList.add('hidden-view'); 
            });

            const target = document.getElementById(viewName);
            if (target) {
                target.classList.remove('hidden-view'); 
                target.scrollTop = 0;
                const isNewStudent = target.dataset.currentStudentId !== window.currentStudentId;

                if (viewName === 'view-grades') {
                    const currentStudent = window.studentData[window.currentStudentId];
                    if (currentStudent) {
                        document.getElementById('grades-student-info').textContent = `学生: ${currentStudent.name} (${currentStudent.id}) | 每一次进步都值得被看见`;
                    }
                    if (!target.dataset.initialized || isNewStudent) {
                        window.updateGradesHistory(window.currentStudentId); 
                        const studentExams = window.allExamData[window.currentStudentId];
                        if (studentExams) {
                            const sortedExams = Object.keys(studentExams).map(key => ({ id: key, date: studentExams[key].date })).sort((a, b) => b.date.localeCompare(a.date));
                            if (sortedExams.length > 0) window.loadExam(sortedExams[0].id);
                        }
                        target.dataset.currentStudentId = window.currentStudentId;
                        target.dataset.initialized = 'true';
                    }
                }
                
                if (viewName === 'view-health') {
                    const currentStudent = window.studentData[window.currentStudentId];
                    if (currentStudent) {
                        document.getElementById('health-student-info').textContent = `学生: ${currentStudent.name} (${currentStudent.id}) | 关注您的每一次成长`;
                    }
                    if (!target.dataset.initialized || isNewStudent) {
                        window.updateHealthHistory(window.currentStudentId);
                        const studentHealth = window.allHealthData[window.currentStudentId];
                        if (studentHealth) {
                             const sortedHealth = Object.keys(studentHealth).map(key => ({ id: key, date: studentHealth[key].date })).sort((a, b) => {
                                 const dateA = a.date.replace(/\./g, '');
                                 const dateB = b.date.replace(/\./g, '');
                                 return dateB.localeCompare(dateA);
                             });
                             if (sortedHealth.length > 0) window.loadHealthExam(sortedHealth[0].id);
                        }
                        target.dataset.currentStudentId = window.currentStudentId;
                        target.dataset.initialized = 'true';
                    }
                }

                if (viewName === 'view-rewards-honors') {
                    const currentStudent = window.studentData[window.currentStudentId];
                    if (currentStudent) {
                        document.getElementById('rewards-student-info').textContent = `学生: ${currentStudent.name} (${currentStudent.id}) | 记录您的每一次优秀表现与纪律操行`;
                    }
                    if (!target.dataset.initialized || isNewStudent) {
                        window.loadRewardsVerticalList(window.currentStudentId);
                        target.dataset.currentStudentId = window.currentStudentId;
                        target.dataset.initialized = 'true';
                    }
                }
            }
        }
        window.updateGradesHistory = function(studentId) { 
            const container = document.getElementById('grades-history-container');
            if (!container) return;
            container.innerHTML = ''; 

            const studentExams = window.allExamData[studentId];
            if (!studentExams || Object.keys(studentExams).length === 0) {
                container.innerHTML = `<div class="text-[10px] text-gray-400 font-medium p-4 text-center">该学生暂无考试记录。</div>`;
                return;
            }

            const examEntries = Object.keys(studentExams).map(key => ({ id: key, date: studentExams[key].date }));
            examEntries.sort((a, b) => b.date.replace(/\./g, '').localeCompare(a.date.replace(/\./g, '')));

            let currentGroupTag = ''; 

            examEntries.forEach(({ id: examId }, index) => {
                const exam = studentExams[examId];
                const academicGroupTag = window.getAcademicSemesterTag(exam.date);

                if (academicGroupTag !== currentGroupTag) {
                     const tagDiv = document.createElement('div');
                     tagDiv.className = 'text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-2 mt-6';
                     tagDiv.textContent = academicGroupTag;
                     container.appendChild(tagDiv);
                     currentGroupTag = academicGroupTag;
                }

                const isLatest = (index === 0); 
                const innerClass = isLatest ? 'exam-card-inner bg-dark text-white p-4 rounded-2xl shadow-lg transform transition-all scale-[1.02]' : 'exam-card-inner bg-[#F3F0EA] hover:bg-white border border-transparent hover:border-gray-200 p-4 rounded-2xl transition-all';
                const titleClass = isLatest ? 'font-bold text-sm text-white' : 'font-bold text-sm text-dark group-hover:text-accentBlue transition-colors';
                const tagBg = isLatest ? 'bg-accentRed text-dark' : 'bg-white text-gray-400';
                const tagText = isLatest ? '最新' : exam.tag;

                const itemHtml = `<div id="history-item-${examId}" onclick="window.loadExam('${examId}')" class="group cursor-pointer"><div class="${innerClass}"><div class="flex justify-between items-start mb-1"><span class="text-[10px] font-bold ${tagBg} px-2 py-0.5 rounded-full border border-gray-100">${tagText}</span><span class="text-[10px] ${isLatest ? 'opacity-80' : 'text-gray-400'}">${exam.date.substring(5)}</span></div><h4 class="${titleClass}">${exam.title}</h4><div class="mt-2 flex items-center justify-between text-[10px] ${isLatest ? 'opacity-80' : 'text-gray-500'}"><span>总分: ${exam.totalScore}</span><span>排名: ${exam.classRank}</span></div></div></div>`;
                container.insertAdjacentHTML('beforeend', itemHtml);
            });
            container.insertAdjacentHTML('beforeend', '<div class="pt-4 text-center"><span class="text-[10px] text-gray-300">已加载全部历史记录</span></div>');
        }
        window.loadExam = function(examId) { 
            const studentExamData = window.allExamData[window.currentStudentId];
            const data = studentExamData ? studentExamData[examId] : null;
            if (!data) return;

            document.getElementById('stat-class-rank').textContent = `No. ${data.classRank}`;
            const trendEl = document.getElementById('stat-class-trend');
            const trendIcon = data.classRankTrend.dir === 'up' ? 'ph-trend-up' : (data.classRankTrend.dir === 'down' ? 'ph-trend-down' : 'ph-minus');
            const trendText = data.classRankTrend.dir === 'up' ? `上升 ${data.classRankTrend.val} 名` : (data.classRankTrend.dir === 'down' ? `下滑 ${data.classRankTrend.val} 名` : '持平');
            trendEl.className = `text-xs mt-1 flex items-center gap-1 ${data.classRankTrend.color}`;
            trendEl.innerHTML = `<i class="ph-bold ${trendIcon}"></i> ${trendText}`;

            document.getElementById('stat-grade-rank').textContent = data.gradeRank;
            document.getElementById('stat-total-score').textContent = data.totalScore;
            document.getElementById('stat-total-bar').style.width = `${(data.totalScore / 750) * 100}%`;
            document.getElementById('exam-title').textContent = `当前查看: ${data.title}`;
            document.getElementById('exam-date').textContent = `考试时间: ${data.date}`;

            const tbody = document.getElementById('exam-table-body');
            tbody.innerHTML = ''; 
            data.subjects.forEach(sub => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-100 transition'; 
                tr.innerHTML = `<td class="py-4 pl-6 font-bold text-dark">${sub.name}</td><td class="py-4 text-gray-500 text-center">${sub.full}</td><td class="py-4 font-bold text-dark text-center">${sub.score}</td><td class="py-4 text-gray-500 text-center">${sub.avg}</td><td class="py-4 text-gray-500 text-center">${sub.max}</td><td class="py-4 pr-6 text-right ${sub.changeColor} font-bold">${sub.change}</td>`;
                tbody.appendChild(tr);
            });

            const historyContainer = document.getElementById('grades-history-container');
            if (historyContainer) {
                historyContainer.querySelectorAll('[id^="history-item-"]').forEach(item => {
                    const inner = item.querySelector('.exam-card-inner');
                    const examKey = item.id.replace('history-item-', '');
                    inner.className = 'exam-card-inner bg-[#F3F0EA] hover:bg-white border border-transparent hover:border-gray-200 p-4 rounded-2xl transition-all';
                    inner.querySelector('h4').className = 'font-bold text-sm text-dark group-hover:text-accentBlue transition-colors';
                    const tagSpan = inner.querySelector('span:first-child');
                    if (tagSpan) { tagSpan.className = 'text-[10px] text-gray-400 bg-white px-2 py-0.5 rounded-full border border-gray-100'; if (studentExamData[examKey]) tagSpan.textContent = studentExamData[examKey].tag; }
                });
            }
            const activeItem = document.getElementById(`history-item-${examId}`);
            if (activeItem) {
                const inner = activeItem.querySelector('.exam-card-inner');
                inner.className = 'exam-card-inner bg-dark text-white p-4 rounded-2xl shadow-lg transform transition-all scale-[1.02]';
                inner.querySelector('h4').className = 'font-bold text-sm text-white';
                const tagSpan = inner.querySelector('span:first-child');
                if (tagSpan) { tagSpan.className = 'text-xs font-bold bg-accentRed text-dark px-2 py-0.5 rounded-full'; tagSpan.textContent = '当前'; }
            }
        }
        window.updateHealthHistory = function(studentId) {
            const container = document.getElementById('health-history-container');
            if (!container) return;
            container.innerHTML = ''; 

            const studentExams = window.allHealthData[studentId];
            if (!studentExams || Object.keys(studentExams).length === 0) {
                container.innerHTML = `<div class="text-[10px] text-gray-400 font-medium p-4 text-center">该学生暂无体检记录。</div>`;
                return;
            }

            const healthEntries = Object.keys(studentExams).map(key => ({ id: key, date: studentExams[key].date }));
            healthEntries.sort((a, b) => b.date.replace(/\./g, '').localeCompare(a.date.replace(/\./g, '')));

            let currentGroupTag = '';

            healthEntries.forEach(({ id: examId }, index) => {
                const exam = studentExams[examId];
                const academicGroupTag = window.getAcademicSemesterTag(exam.date);
                if (academicGroupTag !== currentGroupTag) {
                     const tagDiv = document.createElement('div');
                     tagDiv.className = 'text-[10px] text-gray-400 font-bold uppercase tracking-wider mb-2 mt-6';
                     tagDiv.textContent = academicGroupTag;
                     container.appendChild(tagDiv);
                     currentGroupTag = academicGroupTag;
                }
                const isLatest = (index === 0);
                const innerClass = isLatest ? 'health-card-inner bg-dark text-white p-4 rounded-2xl shadow-lg' : 'health-card-inner bg-[#F3F0EA] hover:bg-white border border-transparent hover:border-gray-200 p-4 rounded-2xl transition-all';
                const titleClass = isLatest ? 'font-bold text-sm text-accentGreen' : 'font-bold text-sm text-dark group-hover:text-accentGreen transition-colors';
                
                let tagText = '常规';
                if (examId.includes('_reproductive')) tagText = '专检';
                else if (examId.includes('_urgent') || exam.title.includes('急检')) tagText = '急检';
                else if (isLatest) tagText = '最新';

                const tagBg = isLatest ? 'bg-accentGreen text-dark' : 'bg-white text-gray-400';
                const bmi = exam.bmi;
                const vision = exam.vision_left === exam.vision_right ? exam.vision_left : `${exam.vision_left}/${exam.vision_right}`;

                const itemHtml = `<div id="health-item-${examId}" onclick="window.loadHealthExam('${examId}')" class="group cursor-pointer"><div class="${innerClass}"><div class="flex justify-between items-start mb-1"><span class="text-[10px] font-bold ${tagBg} px-2 py-0.5 rounded-full border border-gray-100">${tagText}</span><span class="text-[10px] ${isLatest ? 'opacity-60' : 'text-gray-400'}">${exam.date.substring(5)}</span></div><h4 class="${titleClass}">${exam.title.replace('报告', '')}</h4><div class="mt-2 flex items-center justify-between text-[10px] ${isLatest ? 'opacity-80' : 'text-gray-500'}"><span>BMI: ${bmi}</span><span>视力: ${vision}</span></div></div></div>`;
                container.insertAdjacentHTML('beforeend', itemHtml);
            });
            container.insertAdjacentHTML('beforeend', '<div class="pt-4 text-center"><span class="text-[10px] text-gray-300">已加载全部历史记录</span></div>');
        }
        window.loadHealthExam = function(examId) {
            const studentHealthData = window.allHealthData[window.currentStudentId];
            const data = studentHealthData ? studentHealthData[examId] : null;
            const student = window.studentData[window.currentStudentId]; 
            if (!data) return;

            document.getElementById('health-title').textContent = data.title;
            document.getElementById('health-date').textContent = `体检日期: ${data.date}`;
            
            const summaryContainer = document.getElementById('health-summary-text-container');
            summaryContainer.innerHTML = '';
            summaryContainer.insertAdjacentHTML('beforeend', `<p class="text-sm text-gray-500">${data.result_summary}</p>`);

            const isReproductiveExam = data.hasImageArchive === 1;
            const isUrgentExam = (data.title && data.title.includes('急检')) || (examId && examId.includes('_urgent'));
            const isFirstSexExam = data.isFirstSexExam === 1;
            
            if (isReproductiveExam) {
                const gender = student.gender;
                const hormoneKey = gender === '男' ? '睾酮' : '雌二醇';
                const organKey = gender === '男' ? '睾丸' : '卵巢';
                const otherKey = gender === '男' ? '前列腺' : '子宫';
                const hormoneData = data.details.find(d => d.item.includes(hormoneKey));
                const organData = data.details.find(d => d.item.includes(organKey));
                const otherData = data.details.find(d => d.item.includes(otherKey));

                let checkLabel = '指检';
                let checkIcon = 'ph-hand-tap';
                if (student.gender === '男') { checkLabel = '触检'; checkIcon = 'ph-hand-palm'; }

                const stats = [
                    { icon: 'ph-eye', label: '视检', value: '正常', color: 'text-accentBlue', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: checkIcon, label: checkLabel, value: '正常', color: 'text-accentOrange', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-flask', label: hormoneData?.item.replace(/ *\([^)]*\) /g, "") || '激素水平', value: hormoneData?.value || 'N/A', color: 'text-accentYellow', cardClass: 'bg-dark text-white rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-shield-check', label: organData?.item.replace(/ *\([^)]*\) /g, "") || '器官检查', value: organData?.status || 'N/A', color: 'text-accentGreen', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-stethoscope', label: otherData?.item.replace(/ *\([^)]*\) /g, "") || '附加检查', value: otherData?.status || 'N/A', color: 'text-accentRed', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' }
                ];

                document.getElementById('stat-icon-1').className = `ph-fill ${stats[0].icon} text-xl sm:text-2xl ${stats[0].color} mb-2`;
                document.getElementById('stat-label-1').textContent = stats[0].label;
                document.getElementById('stat-height').textContent = stats[0].value;
                document.getElementById('stat-card-1').className = stats[0].cardClass;

                document.getElementById('stat-icon-2').className = `ph-fill ${stats[1].icon} text-xl sm:text-2xl ${stats[1].color} mb-2`;
                document.getElementById('stat-label-2').textContent = stats[1].label;
                document.getElementById('stat-weight').textContent = stats[1].value;
                document.getElementById('stat-card-2').className = stats[1].cardClass;

                document.getElementById('stat-icon-3').className = `ph-fill ${stats[2].icon} text-2xl ${stats[2].color} mb-2`;
                document.getElementById('stat-label-3').textContent = stats[2].label;
                document.getElementById('stat-bmi').textContent = stats[2].value;
                document.getElementById('stat-card-3').className = stats[2].cardClass;

                document.getElementById('stat-icon-4').className = `ph-fill ${stats[3].icon} text-xl sm:text-2xl ${stats[3].color} mb-2`;
                document.getElementById('stat-label-4').textContent = stats[3].label;
                document.getElementById('stat-vision').textContent = stats[3].value;
                document.getElementById('stat-card-4').className = stats[3].cardClass;

                document.getElementById('stat-icon-5').className = `ph-fill ${stats[4].icon} text-xl sm:text-2xl ${stats[4].color} mb-2`;
                document.getElementById('stat-label-5').textContent = stats[4].label;
                document.getElementById('stat-bp').textContent = stats[4].value;
                document.getElementById('stat-card-5').className = stats[4].cardClass;

            } else if (isUrgentExam) {
                const stats = data.urgent_stats || [
                    { icon: 'ph-thermometer', label: '体温 (°C)', value: `${data.thermometer}`, color: 'text-accentRed', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-heartbeat', label: '心率 (bpm)', value: `${data.heartbeat}`, color: 'text-accentRed', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-first-aid', label: '意识', value: `${data.consciousness}`, color: 'text-accentRed', cardClass: 'bg-dark text-white rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-activity', label: '呼吸 (bpm)', value: `${data.activity}`, color: 'text-accentRed', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-drop', label: '血压 (mmHg)', value: `${data.blood_pressure}`, color: 'text-accentRed', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' }
                ];
                
                document.getElementById('stat-icon-1').className = `ph-fill ${stats[0].icon} text-xl sm:text-2xl ${stats[0].color} mb-2`;
                document.getElementById('stat-label-1').textContent = stats[0].label;
                document.getElementById('stat-height').textContent = stats[0].value;
                document.getElementById('stat-card-1').className = stats[0].cardClass;

                document.getElementById('stat-icon-2').className = `ph-fill ${stats[1].icon} text-xl sm:text-2xl ${stats[1].color} mb-2`;
                document.getElementById('stat-label-2').textContent = stats[1].label;
                document.getElementById('stat-weight').textContent = stats[1].value;
                document.getElementById('stat-card-2').className = stats[1].cardClass;

                document.getElementById('stat-icon-3').className = `ph-fill ${stats[2].icon} text-2xl ${stats[2].color} mb-2`;
                document.getElementById('stat-label-3').textContent = stats[2].label;
                document.getElementById('stat-bmi').textContent = stats[2].value;
                document.getElementById('stat-card-3').className = stats[2].cardClass;

                document.getElementById('stat-icon-4').className = `ph-fill ${stats[3].icon} text-xl sm:text-2xl ${stats[3].color} mb-2`;
                document.getElementById('stat-label-4').textContent = stats[3].label;
                document.getElementById('stat-vision').textContent = stats[3].value;
                document.getElementById('stat-card-4').className = stats[3].cardClass;

                document.getElementById('stat-icon-5').className = `ph-fill ${stats[4].icon} text-xl sm:text-2xl ${stats[4].color} mb-2`;
                document.getElementById('stat-label-5').textContent = stats[4].label;
                document.getElementById('stat-bp').textContent = stats[4].value;
                document.getElementById('stat-card-5').className = stats[4].cardClass;
            } else {
                const stats = [
                    { icon: 'ph-ruler', label: '身高 (cm)', value: `${data.height}`, color: 'text-accentGreen', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-scales', label: '体重 (kg)', value: `${data.weight}`, color: 'text-accentGreen', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-clipboard-text', label: 'BMI 指数', value: `${data.bmi}`, color: 'text-accentYellow', cardClass: 'bg-dark text-white rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-heartbeat', label: '心率 (bpm)', value: `${data.heartbeat}`, color: 'text-accentRed', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' },
                    { icon: 'ph-drop', label: '血压 (mmHg)', value: `${data.blood_pressure}`, color: 'text-accentRed', cardClass: 'bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center' }
                ];

                document.getElementById('stat-icon-1').className = `ph-fill ${stats[0].icon} text-xl sm:text-2xl ${stats[0].color} mb-2`;
                document.getElementById('stat-label-1').textContent = stats[0].label;
                document.getElementById('stat-height').textContent = stats[0].value;
                document.getElementById('stat-card-1').className = stats[0].cardClass;

                document.getElementById('stat-icon-2').className = `ph-fill ${stats[1].icon} text-xl sm:text-2xl ${stats[1].color} mb-2`;
                document.getElementById('stat-label-2').textContent = stats[1].label;
                document.getElementById('stat-weight').textContent = stats[1].value;
                document.getElementById('stat-card-2').className = stats[1].cardClass;

                document.getElementById('stat-icon-3').className = `ph-fill ${stats[2].icon} text-2xl ${stats[2].color} mb-2`;
                document.getElementById('stat-label-3').textContent = stats[2].label;
                document.getElementById('stat-bmi').textContent = stats[2].value;
                document.getElementById('stat-card-3').className = stats[2].cardClass;

                document.getElementById('stat-icon-4').className = `ph-fill ${stats[3].icon} text-xl sm:text-2xl ${stats[3].color} mb-2`;
                document.getElementById('stat-label-4').textContent = stats[3].label;
                document.getElementById('stat-vision').textContent = stats[3].value;
                document.getElementById('stat-card-4').className = stats[3].cardClass;

                document.getElementById('stat-icon-5').className = `ph-fill ${stats[4].icon} text-xl sm:text-2xl ${stats[4].color} mb-2`;
                document.getElementById('stat-label-5').textContent = stats[4].label;
                document.getElementById('stat-bp').textContent = stats[4].value;
                document.getElementById('stat-card-5').className = stats[4].cardClass;
            }

            const tbody = document.getElementById('health-table-body');
            tbody.innerHTML = ''; 
            const imageUrl = data.exam_image_url;
            const imageInfo = data.image_details || {}; 
            // 🆕 修正：将 imageInfo 对象编码为 Base64 字符串
            const encodedImageInfo = btoa(unescape(encodeURIComponent(JSON.stringify(imageInfo))));

            data.details.forEach(item => {
                const statusColor = item.color || 'text-dark';
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-100 hover:bg-[#F3F0EA] transition';
                let itemContent = item.item;
                if (isReproductiveExam && item.item === '视检') {
                    // 🆕 修正：使用 Base64 解码和 JSON.parse
                    // 使用 decodeURIComponent(escape(atob())) 确保 Base64 在中文环境下正确解码
                    const onClickHandler = `event.stopPropagation(); window.showExamImage('${imageUrl}', JSON.parse(decodeURIComponent(escape(atob('${encodedImageInfo}')))))`;
                    
                    itemContent = `<div class="flex items-center gap-2"><span>${item.item}</span><button onclick="${onClickHandler}" class="flex items-center gap-1 text-xs font-bold text-accentGreen hover:text-dark bg-accentGreen/10 px-3 py-1 rounded-full transition shadow-sm hover:shadow-md"><i class="ph-fill ph-image"></i><span>影像留档</span></button></div>`;
                }
                tr.innerHTML = `<td class="py-4 pl-6 font-bold text-dark w-4/12">${itemContent}</td><td class="py-4 text-gray-500 w-3/12">${item.range}</td><td class="py-4 font-bold text-dark text-center w-3/12">${item.value}</td><td class="py-4 pr-6 text-right ${statusColor} font-bold w-2/12">${item.status}</td>`;
                tbody.appendChild(tr);
            });

            const historyContainer = document.getElementById('health-history-container');
            if (historyContainer) {
                historyContainer.querySelectorAll('[id^="health-item-"]').forEach(item => {
                    const inner = item.querySelector('.health-card-inner');
                    const examKey = item.id.replace('history-item-', '');
                    inner.className = 'health-card-inner bg-[#F3F0EA] hover:bg-white border border-transparent hover:border-gray-200 p-4 rounded-2xl transition-all';inner.querySelector('h4').className = 'font-bold text-sm text-dark group-hover:text-accentGreen transition-colors';
                    const tagSpan = inner.querySelector('span:first-child');
                    if (tagSpan) { 
                        tagSpan.className = 'text-[10px] text-gray-400 bg-white px-2 py-0.5 rounded-full border border-gray-100'; 
                        let tText = '常规';
                        if (examKey.includes('_reproductive')) tText = '专检';
                        else if (examKey.includes('_urgent')) tText = '急检';
                        tagSpan.textContent = tText; 
                    }
                });
            }
            const activeItem = document.getElementById(`health-item-${examId}`);
            if (activeItem) {
                const inner = activeItem.querySelector('.health-card-inner');
                inner.className = 'health-card-inner bg-dark text-white p-4 rounded-2xl shadow-lg transform transition-all scale-[1.02]';
                inner.querySelector('h4').className = 'font-bold text-sm text-accentGreen';
                const tagSpan = inner.querySelector('span:first-child');
                if (tagSpan) { tagSpan.className = 'text-xs font-bold bg-accentGreen text-dark px-2 py-0.5 rounded-full'; tagSpan.textContent = '当前'; }
            }
        }
        window.loadRewardsVerticalList = function(studentId) {
            const container = document.getElementById('rewards-list-container');
            if (!container) return;
            container.innerHTML = ''; 

            const records = window.allRewardsData[studentId];
            if (!records || records.length === 0) {
                container.innerHTML = `<div class="p-6 text-center w-full bg-cardLight rounded-2xl shadow-soft text-gray-500 font-medium">该学生暂无奖惩记录。</div>`;
                return;
            }

            records.sort((a, b) => b.date.localeCompare(a.date));

            let currentGroupTag = '';

            records.forEach(item => {
                const academicGroupTag = window.getAcademicSemesterTag(item.date);
                if (academicGroupTag !== currentGroupTag) {
                    const tagDiv = document.createElement('div');
                    tagDiv.className = 'text-sm sm:text-base font-bold text-dark mt-8 mb-3';
                    tagDiv.textContent = academicGroupTag;
                    container.appendChild(tagDiv);
                    currentGroupTag = academicGroupTag;
                }

                const isHonor = item.type === 'Honor';
                const icon = isHonor ? 'ph-fill ph-trophy' : 'ph-fill ph-warning';
                const iconColor = isHonor ? (item.level === 'Major' ? 'text-accentYellow' : 'text-accentBlue') : 'text-accentRed';
                const badgeColor = isHonor ? (item.level === 'Major' ? 'bg-accentYellow/20 text-accentYellow' : 'bg-accentBlue/20 text-accentBlue') : 'bg-accentRed/20 text-accentRed';
                const badgeText = isHonor ? '荣誉' : '惩戒';
                
                const escapedDescription = item.description.replace(/'/g, "\\'").replace(/"/g, '\\"').replace(/\n/g, '\\n');
                const onClickHandler = `window.showRewardsDetailModal('${item.type}', '${item.item}', '${item.issuer}', '${item.date}', '${item.level}', '${escapedDescription}')`;
                
                const itemHtml = `<div onclick="${onClickHandler}" class="flex items-stretch bg-white rounded-xl mb-4 overflow-hidden border border-gray-100 p-4 sm:p-6 transition cursor-pointer group hover:shadow-soft"><div class="w-12 sm:w-16 flex-shrink-0 flex flex-col items-center justify-center text-center pr-4"><span class="text-[10px] text-gray-400 font-medium mb-1">${item.date.substring(5)}</span><i class="${icon} text-2xl ${iconColor} group-hover:scale-110 transition"></i></div><div class="flex-1 px-0 sm:px-4 flex flex-col justify-center border-l border-gray-100 ml-4 sm:ml-0"><h4 class="font-bold text-base text-dark mb-1 truncate">${item.item}</h4><p class="text-xs text-gray-500">颁发机构: ${item.issuer}</p></div><div class="w-auto flex-shrink-0 flex flex-col justify-center items-end pl-4 gap-2"><span class="text-[10px] font-bold ${badgeColor} px-2 py-0.5 rounded-full whitespace-nowrap">${badgeText}</span><button onclick="event.stopPropagation(); ${onClickHandler}" class="text-xs font-bold text-dark hover:text-accentOrange px-2 py-1 transition flex items-center justify-center gap-1">详情 <i class="ph-bold ph-arrow-right text-xs"></i></button></div></div>`;
                container.insertAdjacentHTML('beforeend', itemHtml);
            });
        }

        // ====================================================
        // ======== [更新] 部门自定义详情浮窗逻辑 (Overlay版) ========
        // ====================================================

        /**
         * 函数: 打开部门自定义信息浮窗 (Overlay 模式 - 样式优化版)
         */
        window.showDeptCustomInfo = function() {
            if (!currentDeptIdForInfo) return;
            
            const deptData = departments[currentDeptIdForInfo];
            const overlay = document.getElementById('dept-info-overlay');
            const titleEl = document.getElementById('dept-info-overlay-title');
            const contentEl = document.getElementById('dept-info-overlay-content');
            const decorationEl = document.getElementById('dept-info-overlay-decoration');

            if (!overlay) return;

            // 获取自定义内容
            const info = deptData.customInfo || {
                title: `${deptData.title} · 部门细则`,
                content: `<div class="h-full flex flex-col items-center justify-center text-gray-400 opacity-60">
                    <i class="ph-duotone ph-notebook text-5xl mb-3"></i>
                    <p class="text-sm">暂无详细规章制度</p>
                </div>`
            };

            // 样式设置
            const textColorClass = deptData.textClass; // e.g. text-accentRed
            const bgClass = deptData.bgClass;       // e.g. bg-accentRed

            // 更新内容与样式
            titleEl.textContent = info.title;
            
            // [修改 3] 标题样式调整：使用 text-sm, uppercase, tracking-wider 以匹配“核心部员”
            // 同时保留部门的主题色 (textColorClass)
            titleEl.className = `text-sm font-bold uppercase tracking-wider ${textColorClass} pr-4`; 
            
            contentEl.innerHTML = info.content;
            
            // 更新背景装饰球
            decorationEl.className = `absolute -bottom-10 -right-10 w-40 h-40 rounded-full opacity-10 blur-3xl pointer-events-none z-10 ${bgClass}`;

            // 显示
            overlay.classList.remove('hidden');
        }

        /**
         * 函数: 关闭部门自定义信息浮窗
         */
        window.closeDeptCustomInfo = function() {
            const overlay = document.getElementById('dept-info-overlay');
            if (overlay) {
                overlay.classList.add('hidden');
            }
        }

        // ESC 键监听逻辑更新 (修改 ID 引用即可)
        document.addEventListener('keydown', function(event) {
            const deptModal = document.getElementById('department-modal');
            const overlay = document.getElementById('dept-info-overlay'); // [修改] 获取 overlay
            
            if (event.key === "Escape") {
                // [修改] 优先关闭内部 Overlay
                if (overlay && !overlay.classList.contains('hidden')) { 
                    window.closeDeptCustomInfo();
                    return; 
                }
                
                // ... 原有逻辑保持不变
                if (deptModal && !deptModal.classList.contains('hidden')) { window.closeDepartmentModal(); }
                // ... 其他模态框关闭逻辑
            }
        });


        // Close on ESC key
        document.addEventListener('keydown', function(event) {
            const deptModal = document.getElementById('department-modal');
            const archiveDetailModal = document.getElementById('rewards-detail-modal');
            const imageModal = document.getElementById('image-modal');
            // [新增] 部门自定义浮窗
            const infoModal = document.getElementById('dept-custom-info-modal'); 
            
            if (event.key === "Escape") {
                // [新增] 优先关闭自定义浮窗
                if (infoModal && !infoModal.classList.contains('hidden')) { 
                    window.closeDeptCustomInfo();
                    return; // 阻止后续逻辑
                }
                
                if (deptModal && !deptModal.classList.contains('hidden')) { window.closeDepartmentModal(); }
                else if (archiveDetailModal && !archiveDetailModal.classList.contains('hidden')) { window.closeRewardsDetailModal(); }
                else if (imageModal && !imageModal.classList.contains('hidden')) { window.closeExamImage(); }
            }
        });

    </script>
    
    <style>
        /* 样式保持不变 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background-color: #EBE7E0; border-radius: 3px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .hidden-view { display: none !important; }

        @keyframes fadeInDown {
            from { opacity: 0; transform: scaleY(0.9); }
            to { opacity: 1; transform: scaleY(1); }
        }
        .animate-fade-in-down { animation: fadeInDown 0.2s ease-out forwards; }
        .gradient-circle-yellow { background: radial-gradient(circle, rgba(255,214,70,1) 0%, rgba(255,214,70,0) 70%); }
        
        /* 部门页特有样式 (确保静态显示) */
        .static-card, .static-bg-shape {
            transition: none !important;
            transform: none !important;
        }

        /* 档案页体检影像模态框的滚动条 */
        .modal-scrollbar-hide::-webkit-scrollbar { display: none; }
        .modal-scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="h-screen w-full flex overflow-hidden text-textDark selection:bg-accentYellow selection:text-dark">

    <!-- 主容器: 代表整个应用窗口 -->
    <div class="w-full h-full bg-[#F3F0EA] flex overflow-hidden relative">
        
        <!-- Sidebar (侧边栏) / Mobile Bottom Bar (手机底栏) -->
        <aside class="w-full fixed bottom-0 left-0 h-16 flex flex-row justify-around items-center bg-cardLight shadow-2xl z-50 lg:relative lg:flex lg:flex-col lg:h-full lg:w-24 lg:justify-between lg:items-center lg:py-8 lg:z-20 lg:flex-shrink-0 lg:shadow-none lg:bg-transparent">
            
            <div class="hidden lg:flex flex-col items-center w-full gap-8">
                <div class="flex flex-col items-center gap-1 cursor-pointer" onclick="window.switchPage('view-dashboard')">
                    <div class="w-8 h-8 text-dark flex items-center justify-center">
                        <i class="ph-fill ph-newspaper text-3xl"></i>
                    </div>
                    <span class="text-[10px] font-bold tracking-wider">Edu.Space</span>
                </div>

                <nav class="flex flex-col gap-6 w-full items-center">
                    <!-- 新闻首页 -->
                    <div id="nav-dashboard-desktop" onclick="window.switchPage('view-dashboard')" class="w-12 h-12 bg-dark text-accentYellow rounded-full flex items-center justify-center shadow-lg cursor-pointer transition-transform hover:scale-105" title="新闻首页">
                        <i class="ph-fill ph-house text-xl"></i>
                    </div>
                    <!-- 学生档案 (内部切换) -->
                    <div id="nav-archive-desktop" onclick="window.switchPage('view-archive-main')" class="w-12 h-12 bg-transparent text-gray-500 hover:text-dark rounded-full flex items-center justify-center transition-transform hover:scale-105 cursor-pointer" title="学生档案">
                        <i class="ph-fill ph-file-text text-xl"></i>
                    </div>
                    <!-- 组织架构 (内部切换) -->
                    <div id="nav-departments-desktop" onclick="window.switchPage('view-departments')" class="w-12 h-12 bg-transparent text-gray-500 hover:text-dark rounded-full flex items-center justify-center transition-transform hover:scale-105 cursor-pointer" title="组织架构">
                        <i class="ph-fill ph-buildings text-xl"></i>
                    </div>
                </nav>
            </div>

            <nav class="flex w-full h-full justify-around items-center lg:hidden">
                <!-- 新闻首页 -->
                <div id="nav-dashboard-mobile" onclick="window.switchPage('view-dashboard')" class="w-10 h-10 bg-dark text-accentYellow rounded-full flex items-center justify-center shadow-lg cursor-pointer transition-transform hover:scale-105" title="新闻首页">
                    <i class="ph-fill ph-house text-xl"></i>
                </div>
                <!-- 学生档案 (内部切换) -->
                <div id="nav-archive-mobile" onclick="window.switchPage('view-archive-main')" class="w-10 h-10 bg-transparent text-gray-500 hover:text-dark rounded-full flex items-center justify-center cursor-pointer transition-transform hover:scale-105" title="学生档案">
                    <i class="ph-fill ph-file-text text-xl"></i>
                </div>
                <!-- 组织架构 (内部切换) 移动端 -->
                <div id="nav-departments-mobile" onclick="window.switchPage('view-departments')" class="w-10 h-10 bg-transparent text-gray-500 hover:text-dark rounded-full flex items-center justify-center cursor-pointer transition-transform hover:scale-105" title="组织架构">
                    <i class="ph-fill ph-buildings text-xl"></i>
                </div>
                <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-white shadow-sm cursor-pointer" title="用户资料">
                    <img src="https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVSFpLx0DumrKPjuUA5dWWQhQIO_i5QACGAtrG2S7eUU0zdRez_Kk0wEAAwIAA3gAAzYE.png" alt="Profile" class="w-full h-full object-cover">
                </div>
            </nav>

            <div class="hidden lg:flex flex-col gap-6 items-center">
                <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-white shadow-sm cursor-pointer">
                    <img src="https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVSFpLx0DumrKPjuUA5dWWQhQIO_i5QACGAtrG2S7eUU0zdRez_Kk0wEAAwIAA3gAAzYE.png" alt="Profile" class="w-full h-full object-cover">
                </div>
            </div>
        </aside>

        <!-- Main Content Area (主内容区) -->
        <main class="flex-1 overflow-hidden h-full relative pb-16 lg:pb-0 flex justify-center">
            
            <!-- ================= VIEW 1: NEWS DASHBOARD (新闻首页) ================= -->
            <div id="view-dashboard" class="w-full h-full flex flex-col p-4 lg:p-8 lg:pr-12 overflow-y-auto max-w-6xl">
                <header class="flex flex-col lg:flex-row lg:justify-between lg:items-center mb-6 lg:mb-10 flex-shrink-0">
                    <div>
                        <h1 class="text-2xl lg:text-3xl font-bold text-dark tracking-tight">早安, 黄嘉熙!</h1>
                        <p class="text-gray-400 text-sm mt-1">欢迎回来! 查看您关注的最新校园动态</p>
                    </div>
                    <div class="flex items-center gap-4 mt-4 lg:mt-0 w-full lg:w-auto">
                        <div class="bg-white rounded-full px-4 py-2.5 flex items-center gap-2 shadow-sm min-w-[150px] flex-1">
                            <i class="ph ph-magnifying-glass text-gray-400 text-lg"></i>
                            <input type="text" placeholder="搜索新闻、活动或公告..." class="bg-transparent border-none outline-none text-sm w-full placeholder-gray-400">
                        </div>
                        <button class="bg-dark text-white px-6 py-2.5 rounded-full text-sm font-medium hover:bg-opacity-90 transition shadow-lg flex-shrink-0">
                            我要投稿
                        </button>
                    </div>
                </header>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 flex-1 grid-rows-[auto_auto]"> 
                    <div class="col-span-12 lg:col-span-7 bg-[#DDD8CE] rounded-[32px] p-8 relative overflow-hidden shadow-inner flex flex-col h-auto lg:h-full">
                        <div class="absolute top-[10%] right-[10%] w-64 h-64 bg-accentRed rounded-full filter blur-[50px] opacity-30 mix-blend-multiply"></div>
                        <div class="absolute bottom-[20%] left-[35%] w-48 h-48 bg-accentYellow rounded-full filter blur-[50px] opacity-30 mix-blend-multiply"></div>
                        <div class="relative z-10 h-full flex flex-col justify-between">
                            <div>
                                <span class="text-xs font-bold text-accentRed uppercase tracking-wider bg-dark text-white px-3 py-1 rounded-full mb-3 inline-block">⭐ 头条新闻</span>
                                <h2 class="text-3xl font-bold text-dark leading-tight mt-2">我校科技创新小组在全国<br>青少年大赛中荣获金奖</h2>
                            </div>
                            <div class="mt-auto relative z-20 min-h-[80px] flex flex-col justify-end">
                                <p class="text-sm text-gray-700 mb-4 line-clamp-3">11月25日，我校“星火”科技创新小组凭借其自主研发的智能垃圾分类系统，在全国大赛中脱颖而出，为学校赢得了荣誉。</p>
                                <div class="flex items-center gap-3">
                                    <div class="text-xs text-gray-600 font-medium">发布于 2025-11-26</div>
                                    <button class="bg-dark text-white px-4 py-1.5 rounded-full text-xs font-medium hover:bg-opacity-90 transition">阅读全文 <i class="ph-bold ph-arrow-right ml-1"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 优秀学生展示容器 (现在指向内部档案中心) -->
                    <div class="col-span-12 lg:col-span-5 bg-cardLight rounded-[32px] p-8 text-textDark flex flex-col shadow-soft h-auto lg:h-full relative overflow-hidden group cursor-pointer transition-all" onclick="window.switchPage('view-archive-main'); window.loadStudentArchive('li_jingyao');">
                        <!-- 背景装饰 -->
                        <div class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-bl from-accentYellow/20 to-transparent rounded-bl-[100px] z-0 transition-transform duration-500 group-hover:scale-110"></div>
                        <div class="absolute bottom-0 left-0 w-32 h-32 bg-accentBlue/5 rounded-tr-[80px] z-0"></div>
                        
                        <div class="relative z-10 flex flex-col h-full">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="text-[10px] font-bold text-accentOrange uppercase tracking-wider bg-accentOrange/10 px-2 py-0.5 rounded-full inline-block">⭐ 校园之星</span>
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider"></span>
                                    </div>
                                    <h2 class="font-bold text-dark text-xl">本月优秀学生</h2>
                                </div>
                                <!-- 跳转按钮图标 -->
                                <div class="w-10 h-10 rounded-full bg-white/80 backdrop-blur-sm flex items-center justify-center shadow-sm text-dark group-hover:bg-dark group-hover:text-accentYellow transition-all duration-300">
                                    <i class="ph-bold ph-arrow-right"></i>
                                </div>
                            </div>

                            <div class="flex-1 flex flex-col items-center justify-center text-center mt-2">
                                <!-- 头像区域 -->
                                <div class="relative mb-5 group-hover:-translate-y-1 transition-transform duration-300">
                                    <div class="w-28 h-28 rounded-full p-1.5 bg-gradient-to-br from-accentYellow via-accentOrange to-accentRed shadow-lg">
                                        <img src="https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVU5pMO756lxQ05g4EUHxXdbJ-g_eIAACegtrG1AJiUXa8owFNKll_gEAAwIAA3gAAzYE.png" alt="Li Jingyao" class="w-full h-full rounded-full object-cover border-[3px] border-white">
                                    </div>
                                    <div class="absolute -bottom-3 left-1/2 transform -translate-x-1/2 bg-dark text-white text-[10px] px-3 py-1 rounded-full font-bold shadow-md whitespace-nowrap flex items-center gap-1 border border-white/20">
                                        <i class="ph-fill ph-trophy text-accentYellow"></i> 年级第一
                                    </div>
                                </div>
                                
                                <!-- 信息区域 -->
                                <h3 class="text-2xl font-bold text-dark mb-1">李婧瑶</h3>
                                <p class="text-sm text-gray-500 mb-5 font-medium">高二 (3) 班 <span class="mx-1 text-gray-300">|</span> 纪律部 部长</p>
                                
                                <!-- 语录/简介 -->
                                <div class="bg-white/60 backdrop-blur-sm rounded-2xl p-4 shadow-sm w-full border border-white/50 relative">
                                    <i class="ph-fill ph-quotes text-2xl text-accentBlue/20 absolute top-2 left-2"></i>
                                    <p class="text-xs text-gray-600 italic leading-relaxed px-2">
                                        “学习不仅仅是为了分数，更是为了探索未知的世界。在每一次挑战中突破自我，在每一次失败中寻找光亮。”
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-span-12 lg:col-span-12 flex flex-col lg:flex-row gap-8 lg:h-full"> 
                        <div class="lg:w-1/2 flex flex-col gap-6"> 
                            <div class="bg-cardLight rounded-[32px] p-8 shadow-soft flex flex-col"> 
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="font-bold text-dark text-xl">校园活动</h3>
                                    <div class="flex items-center gap-2 cursor-pointer text-sm font-medium text-textGray hover:text-dark transition"><i class="ph-fill ph-calendar-blank text-lg"></i></div>
                                </div>
                                <div class="space-y-4 h-56 overflow-hidden"> 
                                    <div class="flex items-start gap-4 p-3 rounded-xl cursor-pointer hover:bg-[#F7F5F0] transition">
                                        <div class="w-10 h-10 rounded-full bg-accentBlue/20 text-accentBlue flex items-center justify-center flex-shrink-0"><i class="ph-fill ph-rocket text-xl"></i></div>
                                        <div class="flex-1 min-w-0"><h4 class="text-sm font-bold text-dark truncate">校园科技节：创意项目征集</h4><p class="text-[10px] text-gray-500 mt-0.5 truncate">时间: 12月10日 | 组织者: 科技社</p></div>
                                        <span class="text-xs text-accentBlue font-medium bg-accentBlue/10 px-3 py-1 rounded-full flex-shrink-0 whitespace-nowrap">报名中</span>
                                    </div>
                                    <div class="flex items-start gap-4 p-3 rounded-xl cursor-pointer hover:bg-[#F7F5F0] transition">
                                        <div class="w-10 h-10 rounded-full bg-accentPurple/20 text-accentPurple font-bold flex items-center justify-center flex-shrink-0"><i class="ph-fill ph-gavel text-xl"></i></div>
                                        <div class="flex-1 min-w-0"><h4 class="text-sm font-bold text-dark truncate">“真理之声”校级辩论赛决赛</h4><p class="text-[10px] text-gray-500 mt-0.5 truncate">时间: 12月5日 晚7点 | 组织者: 团委</p></div>
                                        <span class="text-xs text-accentYellow font-medium bg-accentYellow/10 px-3 py-1 rounded-full flex-shrink-0 whitespace-nowrap">即将开始</span>
                                    </div>
                                    <div class="flex items-start gap-4 p-3 rounded-xl cursor-pointer opacity-60 hover:bg-[#F7F5F0] transition">
                                        <div class="w-10 h-10 rounded-full bg-textGray/20 text-textGray font-bold flex items-center justify-center flex-shrink-0"><i class="ph-fill ph-camera text-xl"></i></div>
                                        <div class="flex-1 min-w-0"><h4 class="text-sm font-bold text-dark truncate">“光影定格”校园摄影大赛</h4><p class="text-[10px] text-gray-500 mt-0.5 truncate">时间: 11月30日截止 | 组织者: 摄影社</p></div>
                                        <span class="text-xs text-textGray font-medium bg-textGray/10 px-3 py-1 rounded-full flex-shrink-0 whitespace-nowrap">已结束</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="lg:w-1/2 flex flex-col gap-6"> 
                            <div class="bg-cardLight rounded-[32px] p-8 shadow-soft flex flex-col"> 
                                <div class="flex justify-between items-center mb-6">
                                    <h3 class="font-bold text-dark text-xl">校园热搜</h3>
                                    <div class="flex items-center gap-2 cursor-pointer text-sm font-medium text-accentRed hover:text-dark transition"><i class="ph-fill ph-fire text-lg"></i></div>
                                </div>
                                <div class="space-y-4 h-56 overflow-hidden"> 
                                    <div class="flex items-start gap-4 p-3 rounded-xl cursor-pointer hover:bg-[#F7F5F0] transition">
                                        <div class="w-10 h-10 rounded-full bg-accentRed/20 text-accentRed font-bold flex items-center justify-center flex-shrink-0">1</div>
                                        <div class="flex-1 min-w-0 flex flex-col justify-center"> 
                                            <div class="flex justify-between items-center gap-2"><h4 class="text-sm font-bold text-accentRed truncate">期末考试延期? 教务处回应</h4><span class="text-xs font-medium text-white bg-accentRed px-2 py-0.5 rounded-full flex-shrink-0 whitespace-nowrap shadow-md">15.6k</span></div>
                                            <p class="text-[10px] text-gray-500 mt-0.5 truncate">教务处辟谣，网传消息不实，请勿传谣。</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-4 p-3 rounded-xl cursor-pointer hover:bg-[#F7F5F0] transition">
                                        <div class="w-10 h-10 rounded-full bg-accentOrange/20 text-accentOrange font-bold flex items-center justify-center flex-shrink-0">2</div>
                                        <div class="flex-1 min-w-0 flex flex-col justify-center"> 
                                            <div class="flex justify-between items-center gap-2"><h4 class="text-sm font-bold text-dark truncate">食堂新开“自选称重”窗口评价</h4><span class="text-xs font-medium text-white bg-accentOrange px-2 py-0.5 rounded-full flex-shrink-0 whitespace-nowrap shadow-md">9.2k</span></div>
                                            <p class="text-[10px] text-gray-500 mt-0.5 truncate">师生热议，性价比高但排队较长。</p>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-4 p-3 rounded-xl cursor-pointer hover:bg-[#F7F5F0] transition">
                                        <div class="w-10 h-10 rounded-full bg-accentYellow/20 text-accentYellow font-bold flex items-center justify-center flex-shrink-0">3</div>
                                        <div class="flex-1 min-w-0 flex flex-col justify-center"> 
                                            <div class="flex justify-between items-center gap-2"><h4 class="text-sm font-bold text-dark truncate">高三期中成绩分析会直播回放</h4><span class="text-xs font-medium text-dark bg-accentYellow px-2 py-0.5 rounded-full flex-shrink-0 whitespace-nowrap shadow-md">5.1k</span></div>
                                            <p class="text-[10px] text-gray-500 mt-0.5 truncate">班主任详细讲解本次考试趋势。</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ================= VIEW 2: STUDENT ARCHIVE MAIN (学生档案查询中心) ================= -->
            <div id="view-archive-main" class="hidden-view w-full h-full flex flex-col p-4 lg:p-8 lg:pr-12 overflow-y-auto max-w-6xl no-scrollbar">
                
                <div class="w-full h-full bg-bg rounded-none flex shadow-none overflow-hidden relative">
                    
                    <main class="flex-1 overflow-hidden h-full relative">
                        
                        <!-- ================= SUB-VIEW 1: ARCHIVE (档案详情页 - 默认视图) ================= -->
                        <div id="view-archive" class="w-full h-full flex flex-col pb-12 overflow-y-auto no-scrollbar">
                            <header class="flex justify-between items-center mb-6 lg:mb-10 flex-shrink-0">
                                <div>
                                    <h1 class="text-2xl lg:text-3xl font-bold text-dark tracking-tight">学生档案中心</h1>
                                    <p class="text-gray-400 text-sm mt-1">综合素质评价与学籍管理系统</p>
                                </div>
                                <button onclick="window.showReportErrorModal()" class="bg-dark text-white px-6 py-2.5 rounded-full text-sm font-medium hover:bg-opacity-90 transition shadow-lg flex-shrink-0">
                                    报告错误
                                </button>
                            </header>

                            <div class="flex-1 flex flex-col gap-4 lg:gap-8">
                                <!-- Search Card -->
                                <div class="w-full relative flex-shrink-0 z-30">
                                    <div class="absolute inset-0 bg-dark rounded-[24px] lg:rounded-[32px] overflow-hidden shadow-soft z-0">
                                        <div class="absolute right-0 top-0 h-full w-2/3 bg-gradient-to-l from-[#333] to-transparent pointer-events-none"></div>
                                        <div class="absolute -right-20 -top-20 w-80 h-80 bg-accentBlue opacity-10 rounded-full blur-[80px]"></div>
                                    </div>
                                    <div class="relative z-10 p-6 lg:p-8 text-white">
                                        <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><i class="ph-bold ph-magnifying-glass"></i> 档案检索</h2>
                                        <div class="flex flex-col lg:flex-row gap-3 lg:gap-4 max-w-2xl">
                                            <div class="relative flex-1 bg-white bg-opacity-10 backdrop-blur-md rounded-xl p-1 flex items-center border border-white border-opacity-10">
                                                <div class="px-3 text-gray-400 border-r border-white border-opacity-20 text-xs flex-shrink-0">学号/姓名</div>
                                                <!-- 新增 oninput 实时搜索，并添加 ID 供 JS 访问 -->
                                                <input type="text" id="archive-search-input" placeholder="请输入查询关键字..." 
                                                       class="flex-1 bg-transparent border-none outline-none text-white px-3 py-2 text-sm placeholder-gray-500"
                                                       onfocus="window.updateSearchDropdown(this.value)"
                                                       oninput="window.updateSearchDropdown(this.value)"
                                                       onblur="setTimeout(() => document.getElementById('search-history-dropdown').classList.add('hidden'), 200)">
                                                <div id="search-history-dropdown" class="hidden absolute top-full left-0 w-full mt-2 bg-white rounded-xl shadow-xl overflow-hidden z-50 text-dark animate-fade-in-down origin-top border border-gray-100">
                                                    <!-- search-dropdown-content 包含默认的历史记录和搜索匹配结果 -->
                                                    <div id="search-dropdown-content">
                                                        <div class="px-4 py-2 text-[10px] text-gray-400 bg-gray-50 border-b border-gray-100 flex justify-between items-center"><span>历史搜索</span></div>
                                                        <div onclick="window.handleSearchSelect('huang_jiaxi')" class="hover:bg-gray-50 px-4 py-3 text-sm cursor-pointer flex justify-between items-center transition border-b border-gray-50">
                                                            <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="ph-bold ph-clock-counter-clockwise"></i></div><div class="flex flex-col"><span class="font-bold text-dark">黄嘉熙</span><span class="text-[10px] text-gray-400">学号: DH...0624</span></div></div>
                                                            <div class="flex items-center gap-2"><span class="text-[10px] font-bold text-accentGreen bg-accentGreen/10 px-2 py-0.5 rounded-full whitespace-nowrap">已获得查阅权限</span><i class="ph-bold ph-arrow-right text-xs text-gray-300"></i></div>
                                                        </div>
                                                        <div onclick="window.handleSearchSelect('song_peizi')" class="hover:bg-gray-50 px-4 py-3 text-sm cursor-pointer flex justify-between items-center transition border-b border-gray-50">
                                                            <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="ph-bold ph-clock-counter-clockwise"></i></div><div class="flex flex-col"><span class="font-bold text-dark">宋佩姿</span><span class="text-[10px] text-gray-400">学号: DH...0608</span></div></div>
                                                            <div class="flex items-center gap-2"><span class="text-[10px] font-bold text-accentGreen bg-accentGreen/10 px-2 py-0.5 rounded-full whitespace-nowrap">已获得查阅权限</span><i class="ph-bold ph-arrow-right text-xs text-gray-300"></i></div>
                                                        </div>
                                                        <div onclick="window.handleSearchSelect('xue_jinye')" class="hover:bg-gray-50 px-4 py-3 text-sm cursor-pointer flex justify-between items-center transition">
                                                            <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="ph-bold ph-clock-counter-clockwise"></i></div><div class="flex flex-col"><span class="font-bold text-dark">薛锦烨</span><span class="text-[10px] text-gray-400">学号: DH...0613</span></div></div>
                                                            <div class="flex items-center gap-2"><span class="text-[10px] font-bold text-accentGreen bg-accentGreen/10 px-2 py-0.5 rounded-full whitespace-nowrap">已获得查阅权限</span><i class="ph-bold ph-arrow-right text-xs text-gray-300"></i></div>
                                                        </div>
                                                        <div onclick="window.handleSearchSelect('li_jingyao')" class="hover:bg-gray-50 px-4 py-3 text-sm cursor-pointer flex justify-between items-center transition">
                                                            <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i class="ph-bold ph-clock-counter-clockwise"></i></div><div class="flex flex-col"><span class="font-bold text-dark">李婧瑶</span><span class="text-[10px] text-gray-400">学号: DH...0305</span></div></div>
                                                            <div class="flex items-center gap-2"><span class="text-[10px] font-bold text-accentRed bg-accentRed/10 px-2 py-0.5 rounded-full whitespace-nowrap">未获得查阅权限</span><i class="ph-bold ph-arrow-right text-xs text-gray-300"></i></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <button onclick="window.switchPage('view-archive-main'); window.loadStudentArchive(document.getElementById('archive-search-input').value.toLowerCase().includes('黄嘉熙') ? 'huang_jiaxi' : 'huang_jiaxi')" class="bg-accentYellow text-dark px-8 py-3 rounded-xl text-sm font-bold hover:bg-opacity-90 transition shadow-lg flex-shrink-0">查询档案</button>
                                        </div>
                                        <div class="mt-4 flex flex-wrap gap-4 text-[10px] text-gray-400">
                                            <span style="margin-left: 1.7em;">快捷入口:</span>
                                            <span onclick="window.switchArchiveSubView('view-grades')" class="hover:text-white cursor-pointer underline">学业成绩</span>
                                            <span onclick="window.switchArchiveSubView('view-health')" class="hover:text-white cursor-pointer underline">体检报告</span>
                                            <span onclick="window.switchArchiveSubView('view-rewards-honors')" class="hover:text-white cursor-pointer underline">奖惩与荣誉</span>
                                            <span onclick="window.showNotOpenModal()" class="hover:text-white cursor-pointer underline">综合素质评价</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Result: Archive Cards 学生档案中心默认页面设置-->
                                <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-8 flex-1 z-10">
                                    <div class="col-span-1 lg:col-span-4 bg-cardLight rounded-[24px] lg:rounded-[32px] p-6 lg:p-8 shadow-soft flex flex-col items-center text-center h-full">
                                        <div class="w-32 h-32 rounded-full border-4 border-white shadow-lg overflow-hidden mb-6 flex-shrink-0">
                                            <img id="archive-avatar" src="https://im.gurl.eu.org/file/AgACAgEAAxkDAAEBVSFpLx0DumrKPjuUA5dWWQhQIO_i5QACGAtrG2S7eUU0zdRez_Kk0wEAAwIAA3gAAzYE.png" alt="Profile" class="w-full h-full object-cover">
                                        </div>
                                        <h2 id="archive-name" class="text-2xl font-bold text-dark mb-1">黄嘉熙</h2>
                                        <p id="archive-info" class="text-sm text-gray-500 mb-6">高二 (6) 班 | DH1100120210624</p>
                                        <div class="w-full space-y-3 text-left overflow-y-auto">
                                            <div class="flex justify-between items-center p-3 bg-[#F3F0EA] rounded-xl"><span class="text-xs text-gray-500">性别</span><span id="archive-gender" class="text-sm font-bold text-dark">男</span></div>
                                            <div class="flex justify-between items-center p-3 bg-[#F3F0EA] rounded-xl"><span class="text-xs text-gray-500">民族</span><span id="archive-ethnicity" class="text-sm font-bold text-dark">汉族</span></div>
                                            <div class="flex justify-between items-center p-3 bg-[#F3F0EA] rounded-xl"><span class="text-xs text-gray-500">职务</span><span id="archive-position" class="text-sm font-bold text-dark">校学生会 主席</span></div>
                                            <div class="flex justify-between items-center p-3 bg-[#F3F0EA] rounded-xl"><span class="text-xs text-gray-500">入学年份</span><span id="archive-enrollment" class="text-sm font-bold text-dark">2021年9月</span></div>
                                            <div class="flex justify-between items-center p-3 bg-[#F3F0EA] rounded-xl"><span class="text-xs text-gray-500">政治面貌</span><span id="archive-politics" class="text-sm font-bold text-dark">共青团员</span></div>
                                            
                                        </div>
                                    </div>

                                    <div class="col-span-1 lg:col-span-8 grid grid-cols-1 sm:grid-cols-2 grid-rows-2 gap-4 lg:gap-6 h-full">
                                        <!-- 学业成绩记录 -->
                                        <div onclick="window.switchArchiveSubView('view-grades')" class="bg-white rounded-[24px] p-6 shadow-sm hover:shadow-md transition cursor-pointer group border border-transparent hover:border-gray-100 flex flex-col justify-between h-full">
                                            <div>
                                                <div class="w-12 h-12 rounded-2xl bg-accentBlue bg-opacity-10 text-accentBlue flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition"><i class="ph-fill ph-graduation-cap"></i></div>
                                                <h3 class="font-bold text-dark text-lg mb-2">学业成绩记录</h3>
                                                <p class="text-xs text-gray-400 mb-4 line-clamp-2">包含高中入学以来所有期中、期末及模拟考试的原始成绩单及排名分析。</p>
                                            </div>
                                            <div class="flex items-center text-[10px] font-bold text-accentBlue">查看记录 <i class="ph-bold ph-caret-right ml-1"></i></div>
                                        </div>

                                        <!-- 体质健康档案 -->
                                        <div onclick="window.switchArchiveSubView('view-health')" 
                                             class="bg-white rounded-[24px] p-6 shadow-sm hover:shadow-md transition cursor-pointer group border border-transparent hover:border-gray-100 flex flex-col justify-between h-full">
                                            <div>
                                                <div class="w-12 h-12 rounded-2xl bg-accentGreen bg-opacity-10 text-accentGreen flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition"><i class="ph-fill ph-heartbeat"></i></div>
                                                <h3 class="font-bold text-dark text-lg mb-2">体质健康档案</h3>
                                                <p class="text-xs text-gray-400 mb-4 line-clamp-2">年度体检报告、视力监测记录及体测成绩（50米、立定跳远、引体向上等）。</p>
                                            </div>
                                            <div class="flex items-center text-[10px] font-bold text-accentGreen">查看报告 <i class="ph-bold ph-caret-right ml-1"></i></div>
                                        </div>

                                        <!-- 奖惩与荣誉 -->
                                        <div onclick="window.switchArchiveSubView('view-rewards-honors')" class="bg-white rounded-[24px] p-6 shadow-sm hover:shadow-md transition cursor-pointer group border border-transparent hover:border-gray-100 flex flex-col justify-between h-full">
                                            <div>
                                                <div class="w-12 h-12 rounded-2xl bg-accentOrange bg-opacity-10 text-accentOrange flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition"><i class="ph-fill ph-star"></i></div>
                                                <h3 class="font-bold text-dark text-lg mb-2">奖惩与荣誉</h3>
                                                <p class="text-xs text-gray-400 mb-4 line-clamp-2">记录在校期间获得的三好学生、优秀干部、竞赛奖项及违纪处分记录。</p>
                                            </div>
                                            <div class="flex items-center text-[10px] font-bold text-accentOrange">查看详情 <i class="ph-bold ph-caret-right ml-1"></i></div>
                                        </div>

                                        <!-- 综合素质评价 -->
                                        <div onclick="window.showNotOpenModal()" class="bg-white rounded-[24px] p-6 shadow-sm hover:shadow-md transition cursor-pointer group border border-transparent hover:border-gray-100 flex flex-col justify-between h-full">
                                            <div>
                                                <div class="w-12 h-12 rounded-2xl bg-accentYellow bg-opacity-10 text-accentYellow flex items-center justify-center text-2xl mb-4 group-hover:scale-110 transition"><i class="ph-fill ph-clipboard-text"></i></div>
                                                <h3 class="font-bold text-dark text-lg mb-2">综合素质评价</h3>
                                                <p class="text-xs text-gray-400 mb-4 line-clamp-2">思想品德、学业水平、身心健康、艺术素养、社会实践等五个维度的评价。</p>
                                            </div>
                                            <div class="flex items-center text-[10px] font-bold text-[#D9B025]">查看评价 <i class="ph-bold ph-caret-right ml-1"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ================= SUB-VIEW 2: GRADES (考试成绩分析) ================= -->
                        <div id="view-grades" class="w-full h-full flex flex-col p-4 lg:p-8 lg:pr-12 pb-12 overflow-y-auto no-scrollbar hidden-view">
                            <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 flex-shrink-0">
                                <div>
                                    <h1 class="text-2xl sm:text-3xl font-bold text-dark tracking-tight">考试成绩分析</h1>
                                    <p id="grades-student-info" class="text-gray-400 text-xs sm:text-sm mt-1">学生: 黄嘉熙 (2022031508) | 每一次进步都值得被看见</p>
                                </div>
                                <div class="flex flex-col items-start sm:items-end gap-2 sm:gap-3 mt-4 sm:mt-0">
                                    <div onclick="window.switchArchiveSubView('view-archive')" class="flex items-center gap-1 text-gray-400 text-xs cursor-pointer hover:text-dark transition w-fit">
                                        <i class="ph-bold ph-arrow-u-up-left"></i> 返回档案中心
                                    </div>
                                    <button onclick="window.showNotOpenModal()" class="flex items-center gap-2 text-sm font-medium text-gray-500 hover:text-dark">
                                        <i class="ph ph-download-simple"></i> 下载报告
                                    </button>
                                </div>
                            </header>

                            <div class="flex flex-col lg:flex-row gap-6 lg:gap-8 h-auto lg:h-full lg:overflow-hidden">
                                <div class="w-full lg:w-72 bg-cardLight rounded-[24px] lg:rounded-[32px] p-6 shadow-soft flex flex-col h-fit lg:h-full flex-shrink-0 order-first lg:order-last">
                                    <div class="flex items-center gap-2 mb-6">
                                        <div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center text-dark"><i class="ph-bold ph-clock-counter-clockwise"></i></div>
                                        <h3 class="font-bold text-dark">历史考卷</h3>
                                    </div>
                                    <div id="grades-history-container" class="flex-1 overflow-y-auto max-h-60 lg:max-h-full px-2 space-y-3 no-scrollbar">
                                        <div class="text-[10px] text-gray-400 font-medium p-4 text-center">正在加载历史记录...</div>
                                    </div>
                                </div>
                                <div class="flex-1 flex flex-col gap-6 h-auto lg:h-full lg:overflow-hidden">
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 sm:gap-6 flex-shrink-0">
                                        <div class="bg-dark text-white rounded-[24px] lg:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between relative overflow-hidden">
                                            <div class="z-10">
                                                <span class="text-xs text-gray-400 uppercase tracking-wider">班级排名</span>
                                                <div id="stat-class-rank" class="text-3xl sm:text-4xl font-bold mt-1 sm:mt-2">No. -</div>
                                                <div id="stat-class-trend" class="text-xs text-gray-400 mt-1 flex items-center gap-1"><i class="ph-bold ph-trend-up"></i> 正在加载</div>
                                            </div>
                                            <div class="absolute right-0 bottom-0 opacity-10"><i class="ph-fill ph-trophy text-7xl sm:text-9xl"></i></div>
                                        </div>
                                        <div class="bg-cardLight rounded-[24px] lg:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between">
                                            <span class="text-xs text-gray-400 uppercase tracking-wider">年级排名</span>
                                            <div class="flex items-end gap-2 mt-1 sm:mt-2"><div id="stat-grade-rank" class="text-3xl sm:text-4xl font-bold text-dark">-</div><div class="text-xs text-gray-500 mb-1.5">/ 259 人</div></div>
                                        </div>
                                        <div class="bg-cardLight rounded-[24px] lg:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between col-span-2 md:col-span-1">
                                            <span class="text-xs text-gray-400 uppercase tracking-wider">总分</span>
                                            <div class="flex items-end gap-2 mt-1 sm:mt-2"><div id="stat-total-score" class="text-3xl sm:text-4xl font-bold text-dark">-</div><div class="text-xs text-gray-500 mb-1.5">/ 660 分</div></div>
                                            <div class="w-full h-1 bg-gray-200 rounded-full mt-2"><div id="stat-total-bar" class="w-[0%] h-full bg-accentOrange rounded-full transition-all duration-5-00"></div></div>
                                        </div>
                                    </div>
                                    <div class="flex-1 bg-cardLight rounded-[24px] lg:rounded-[32px] p-4 sm:p-8 shadow-soft lg:overflow-hidden flex flex-col min-h-[500px] lg:min-h-0">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 id="exam-title" class="font-bold text-base sm:text-lg">当前查看: 正在加载考试成绩...</h3>
                                            <span id="exam-date" class="text-xs text-gray-400">考试时间: N/A</span>
                                        </div>
                                        <div class="overflow-y-auto flex-1">
                                            <div class="overflow-x-auto"> 
                                                <table class="w-full text-left border-collapse whitespace-nowrap">
                                                    <thead class="text-xs text-gray-400 border-b border-gray-200">
                                                        <tr><th class="py-3 pl-6 font-medium">科目</th><th class="py-3 font-medium text-center min-w-[70px]">满分</th><th class="py-3 font-medium text-center min-w-[70px]">得分</th><th class="py-3 font-medium text-center min-w-[100px]">班级平均分</th><th class="py-3 font-medium text-center min-w-[100px]">年级最高分</th><th class="py-3 pr-6 font-medium text-right min-w-[70px]">排名变动</th></tr>
                                                    </thead>
                                                    <tbody id="exam-table-body" class="text-sm">
                                                        <tr><td colspan="6" class="text-center py-6 text-gray-400">请选择左侧历史考卷查看详情</td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ================= SUB-VIEW 3: HEALTH (体质健康档案) ================= -->
                        <div id="view-health" class="w-full h-full flex flex-col p-4 lg:p-8 lg:pr-12 pb-12 overflow-y-auto no-scrollbar hidden-view">
                            <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 flex-shrink-0">
                                <div>
                                    <h1 class="text-2xl sm:text-3xl font-bold text-dark tracking-tight">体质健康档案</h1>
                                    <p id="health-student-info" class="text-gray-400 text-xs sm:text-sm mt-1">学生: 黄嘉熙 (2022031508) | 关注您的每一次成长与健康变化</p>
                                </div>
                                <div class="flex flex-col items-start sm:items-end gap-2 sm:gap-3 mt-4 sm:mt-0">
                                    <div onclick="window.switchArchiveSubView('view-archive')" class="flex items-center gap-1 text-gray-400 text-xs cursor-pointer hover:text-dark transition w-fit">
                                        <i class="ph-bold ph-arrow-u-up-left"></i> 返回档案中心
                                    </div>
                                    <button onclick="window.showNotOpenModal()" class="flex items-center gap-2 text-sm font-medium text-gray-500 hover:text-dark">
                                        <i class="ph ph-download-simple"></i> 下载报告
                                    </button>
                                </div>
                            </header>

                            <div class="flex flex-col lg:flex-row gap-6 lg:gap-8 h-auto lg:h-full lg:overflow-hidden">
                                <div class="w-full lg:w-72 bg-cardLight rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col flex-shrink-0 h-fit lg:h-full order-1 lg:order-2">
                                    <div class="flex items-center gap-2 mb-6">
                                        <div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center text-accentGreen"><i class="ph-bold ph-heartbeat"></i></div>
                                        <h3 class="font-bold text-dark">历史体检</h3>
                                    </div>
                                    <div id="health-history-container" class="flex-1 overflow-y-auto px-2 space-y-3 no-scrollbar">
                                        <div class="text-[10px] text-gray-400 font-medium p-4 text-center">正在加载历史记录...</div>
                                    </div>
                                </div>

                                <div class="flex-1 flex flex-col gap-4 sm:gap-6 order-2 lg:order-1 health-detail-container h-auto lg:h-full lg:overflow-hidden">
                                    <div id="stat-card-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 sm:gap-6 flex-shrink-0">
                                        <div id="stat-card-1" class="bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center">
                                            <i id="stat-icon-1" class="ph-fill ph-ruler text-xl sm:text-2xl text-accentGreen mb-2"></i>
                                            <span id="stat-label-1" class="text-xs text-gray-400 uppercase tracking-wider">身高</span>
                                            <div id="stat-height" class="text-xl sm:text-2xl font-bold text-dark mt-1">N/A</div>
                                        </div>
                                        <div id="stat-card-2" class="bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center">
                                            <i id="stat-icon-2" class="ph-fill ph-scales text-xl sm:text-2xl text-accentGreen mb-2"></i>
                                            <span id="stat-label-2" class="text-xs text-gray-400 uppercase tracking-wider">体重</span>
                                            <div id="stat-weight" class="text-xl sm:text-2xl font-bold text-dark mt-1">N/A</div>
                                        </div>
                                        <div id="stat-card-3" class="bg-dark text-white rounded-[24px] lg:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center">
                                            <i id="stat-icon-3" class="ph-fill ph-clipboard-text text-2xl text-accentYellow mb-2"></i>
                                            <span id="stat-label-3" class="text-xs text-gray-400 uppercase tracking-wider">BMI 指数</span>
                                            <div id="stat-bmi" class="text-xl sm:text-2xl font-bold mt-1">N/A</div>
                                        </div>
                                        <div id="stat-card-4" class="bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center">
                                            <i id="stat-icon-4" class="ph-fill ph-eye text-xl sm:text-2xl text-accentGreen mb-2"></i>
                                            <span id="stat-label-4" class="text-xs text-gray-400 uppercase tracking-wider">双眼视力</span>
                                            <div id="stat-vision" class="text-xl sm:text-2xl font-bold text-dark mt-1">N/A</div>
                                        </div>
                                        <div id="stat-card-5" class="bg-cardLight rounded-[24px] sm:rounded-[32px] p-4 sm:p-6 shadow-soft flex flex-col justify-between items-center text-center">
                                            <i id="stat-icon-5" class="ph-fill ph-heartbeat text-xl sm:text-2xl text-accentRed mb-2"></i>
                                            <span id="stat-label-5" class="text-xs text-gray-400 uppercase tracking-wider">血压 (mmHg)</span>
                                            <div id="stat-bp" class="text-xl sm:text-2xl font-bold text-dark mt-1">N/A</div>
                                        </div>
                                    </div>
                                    <div class="bg-cardLight rounded-[32px] p-4 sm:p-8 shadow-soft lg:overflow-hidden flex flex-col flex-1">
                                        <div class="flex justify-between items-center mb-4">
                                            <h3 id="health-title" class="font-bold text-lg">当前查看: 正在加载体检报告</h3>
                                            <span id="health-date" class="text-xs text-gray-400">体检日期: N/A</span>
                                        </div>
                                        <div id="health-summary-content" class="mb-6 p-4 rounded-xl bg-[#F3F0EA] border border-gray-100 flex flex-col items-start">
                                            <div id="health-summary-text-container" class="w-full">
                                                <p class="text-sm text-gray-500">正在加载体检报告总结...</p>
                                            </div>
                                        </div>
                                        <div class="flex-1 overflow-y-auto">
                                            <div class="overflow-x-auto">
                                                <table class="w-full text-left border-collapse min-w-[600px]"> 
                                                    <thead class="text-xs text-gray-400 border-b border-gray-200 sticky top-0 bg-cardLight">
                                                        <tr><th class="py-3 pl-6 font-medium w-4/12">检查项目</th><th class="py-3 font-medium w-3/12">参考值</th><th class="py-3 font-medium text-center w-3/12">本次结果</th><th class="py-3 pr-6 font-medium text-right w-2/12">结论</th></tr>
                                                    </thead>
                                                    <tbody id="health-table-body" class="text-sm">
                                                        <tr><td colspan="4" class="py-6 text-center text-gray-400">请选择左侧历史记录或等待数据加载。</td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ================= SUB-VIEW 4: REWARDS & HONORS (奖惩与荣誉档案) ================= -->
                        <div id="view-rewards-honors" class="w-full h-full flex flex-col p-4 lg:p-8 lg:pr-12 pb-12 overflow-y-auto no-scrollbar hidden-view">
                            <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 sm:mb-8 flex-shrink-0">
                                <div>
                                    <h1 class="text-2xl sm:text-3xl font-bold text-dark tracking-tight">奖惩与荣誉档案</h1>
                                    <p id="rewards-student-info" class="text-gray-400 text-xs sm:text-sm mt-1">学生: 黄嘉熙 (1100120210624) | 记录您的每一次优秀表现与纪律操行</p>
                                </div>

                                <div class="flex flex-col items-start sm:items-end gap-2 sm:gap-3 mt-4 sm:mt-0">
                                    <div onclick="window.switchArchiveSubView('view-archive')" class="flex items-center gap-1 text-gray-400 text-xs cursor-pointer hover:text-dark transition w-fit">
                                        <i class="ph-bold ph-arrow-u-up-left"></i> 返回档案中心
                                    </div>
                                    <button onclick="window.showNotOpenModal()" class="flex items-center gap-2 text-sm font-medium text-gray-500 hover:text-dark">
                                        <i class="ph ph-download-simple"></i> 下载年度报告
                                    </button>
                                </div>
                            </header>

                            <!-- 主内容区: 垂直列表容器 -->
                            <div class="mt-4 flex-1 flex flex-col">
                                <!-- 记录列表将在此处渲染 -->
                                <div id="rewards-list-container" class="flex-1 overflow-y-auto no-scrollbar">
                                     <div class="p-6 text-center w-full bg-cardLight rounded-2xl shadow-soft text-gray-500 font-medium">正在加载记录...</div>
                                </div>
                            </div>
                        </div>
                        
                    </main>
                    
                </div>
            </div>

            <!-- ================= VIEW 3: DEPARTMENTS STRUCTURE (组织架构) ================= -->
            <div id="view-departments" class="hidden-view w-full h-full flex flex-col p-4 lg:p-8 lg:pr-12 overflow-y-auto max-w-6xl pb-20 lg:pb-8">
                
                <!-- 头部 -->
                <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 lg:mb-8 flex-shrink-0">
                    <div>
                        <h1 class="text-2xl lg:text-3xl font-bold text-dark tracking-tight">学校部门概览</h1>
                        <p class="text-gray-400 text-sm mt-1">Departments Structure & Contacts</p>
                    </div>
                    <div class="mt-4 sm:mt-0 bg-white rounded-full px-4 py-2 flex items-center gap-2 shadow-sm border border-gray-100 hover:shadow-md transition-shadow group focus-within:ring-2 focus-within:ring-accentYellow">
                        <i class="ph ph-magnifying-glass text-gray-400 group-focus-within:text-dark"></i>
                        <input type="text" placeholder="查找部门或老师..." class="bg-transparent border-none outline-none text-sm w-40 sm:w-64 placeholder-gray-400 text-dark">
                    </div>
                </header>

                <!-- 核心网格布局 -->
                <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 lg:gap-8 h-auto">
                    
                    <!-- LEFT COLUMN: 学生会 (Data Driven Triggers) -->
                    <div class="lg:col-span-2 bg-dark text-white rounded-[32px] p-8 shadow-soft relative overflow-hidden flex flex-col h-[800px] lg:h-[800px]">
                        
                        <!-- 装饰背景 -->
                        <div class="relative z-10 flex justify-between items-start mb-8 flex-shrink-0">
                            <div>
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-[10px] font-bold text-dark bg-accentYellow px-2 py-0.5 rounded-full uppercase tracking-wider">Student Union</span>
                                </div>
                                <h2 class="text-3xl font-bold text-white">校学生会</h2>
                                <p class="text-gray-400 text-sm mt-1">全心全意为同学服务</p>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/20 hover:bg-white/20 transition-colors cursor-pointer">
                                <i class="ph-fill ph-student text-2xl text-accentYellow"></i>
                            </div>
                        </div>

                        <!-- 架构图 -->
                        <div class="relative z-10 flex-1 overflow-y-auto no-scrollbar pr-2">
                            <h3 class="text-sm font-bold text-gray-300 mb-4 flex items-center gap-2"><i class="ph-bold ph-tree-structure"></i> 组织架构</h3>
                            
                            <div class="space-y-4">
                                <!-- 主席团 -->
                                <div onclick="window.openDepartmentModal('presidium')" class="bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-white/10 hover:bg-accentRed/20 hover:border-accentRed/40 transition-all cursor-pointer group relative overflow-hidden">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="w-8 h-8 rounded-full bg-accentRed/20 flex items-center justify-center text-accentRed group-hover:bg-accentRed group-hover:text-white transition-colors"><i class="ph-fill ph-crown"></i></div>
                                        <span class="font-bold text-base group-hover:text-accentRed transition-colors">主席团</span>
                                    </div>
                                    <p class="text-xs text-gray-400 pl-11 group-hover:text-gray-300">负责学生会整体统筹规划、重大事项决策及对外联络。</p>
                                    <div class="absolute right-4 top-4 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <i class="ph-bold ph-caret-right text-accentRed"></i>
                                    </div>
                                </div>

                                <!-- 连线 -->
                                <div class="h-4 w-0.5 bg-gray-700 ml-8"></div>

                                <!-- 秘书处 -->
                                <div onclick="window.openDepartmentModal('secretariat')" class="bg-white/5 rounded-xl p-3 border border-white/5 ml-4 hover:bg-accentTeal/20 hover:border-accentTeal/40 transition-all cursor-pointer group relative overflow-hidden">
                                    <div class="flex items-center gap-3">
                                        <div class="w-6 h-6 rounded-full bg-gray-700 flex items-center justify-center text-gray-300 group-hover:bg-accentTeal group-hover:text-dark transition-colors"><i class="ph-fill ph-notebook"></i></div>
                                        <span class="font-bold text-sm group-hover:text-accentTeal transition-colors">秘书处</span>
                                    </div>
                                    <div class="absolute right-3 top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity">
                                        <i class="ph-bold ph-caret-right text-accentTeal text-xs"></i>
                                    </div>
                                </div>

                                <!-- 各部门列表 (Trigger Modals) -->
                                <div class="grid grid-cols-2 gap-3 ml-4">
                                    
                                    <!-- 学术部 -->
                                    <div onclick="window.openDepartmentModal('academic')" class="bg-white/5 rounded-xl p-3 border border-white/5 cursor-pointer hover:bg-accentBlue/20 hover:border-accentBlue/40 transition-all group relative overflow-hidden">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="ph-fill ph-graduation-cap text-accentBlue group-hover:scale-110 transition-transform"></i> 
                                            <span class="font-bold text-sm group-hover:text-accentBlue transition-colors">学术部</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 group-hover:text-gray-300">学术活动统筹</p>
                                    </div>
                                    
                                    <!-- 纪律部 -->
                                    <div onclick="window.openDepartmentModal('discipline')" class="bg-white/5 rounded-xl p-3 border border-white/5 cursor-pointer hover:bg-accentRed/20 hover:border-accentRed/40 transition-all group relative overflow-hidden">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="ph-fill ph-gavel text-accentRed group-hover:scale-110 transition-transform"></i> 
                                            <span class="font-bold text-sm group-hover:text-accentRed transition-colors">纪律部</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 group-hover:text-gray-300">纪律检查执行</p>
                                    </div>
                                    
                                    <!-- 仪式部 -->
                                    <div onclick="window.openDepartmentModal('ceremony')" class="bg-white/5 rounded-xl p-3 border border-white/5 cursor-pointer hover:bg-accentPurple/20 hover:border-accentPurple/40 transition-all group relative overflow-hidden">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="ph-fill ph-microphone-stage text-accentPurple group-hover:scale-110 transition-transform"></i> 
                                            <span class="font-bold text-sm group-hover:text-accentPurple transition-colors">仪式部</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 group-hover:text-gray-300">仪式典仪承办</p>
                                    </div>
                                    
                                    <!-- 宣传部 -->
                                    <div onclick="window.openDepartmentModal('publicity')" class="bg-white/5 rounded-xl p-3 border border-white/5 cursor-pointer hover:bg-accentOrange/20 hover:border-accentOrange/40 transition-all group relative overflow-hidden">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="ph-fill ph-megaphone text-accentOrange group-hover:scale-110 transition-transform"></i> 
                                            <span class="font-bold text-sm group-hover:text-accentOrange transition-colors">宣传部</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 group-hover:text-gray-300">宣传内容发布</p>
                                    </div>
                                    
                                    <!-- 体育部 -->
                                    <div onclick="window.openDepartmentModal('sports')" class="bg-white/5 rounded-xl p-3 border border-white/5 cursor-pointer hover:bg-accentYellow/20 hover:border-accentYellow/40 transition-all group relative overflow-hidden">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="ph-fill ph-trophy text-accentYellow group-hover:scale-110 transition-transform"></i> 
                                            <span class="font-bold text-sm group-hover:text-accentYellow transition-colors">体育部</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 group-hover:text-gray-300">体育活动运营</p>
                                    </div>
                                    
                                    <!-- 组织部 -->
                                    <div onclick="window.openDepartmentModal('societies')" class="bg-white/5 rounded-xl p-3 border border-white/5 cursor-pointer hover:bg-accentGreen/20 hover:border-accentGreen/40 transition-all group relative overflow-hidden">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="ph-fill ph-users-three text-accentGreen group-hover:scale-110 transition-transform"></i> 
                                            <span class="font-bold text-sm group-hover:text-accentGreen transition-colors">组织部</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 group-hover:text-gray-300">策划组织管理</p>
                                    </div>
                                    
                                    <!-- 公共关系部 -->
                                    <div onclick="window.openDepartmentModal('pr')" class="bg-white/5 rounded-xl p-3 border border-white/5 cursor-pointer hover:bg-accentIndigo/20 hover:border-accentIndigo/40 transition-all group relative overflow-hidden">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="ph-fill ph-handshake text-indigo-500 group-hover:scale-110 transition-transform"></i> 
                                            <span class="font-bold text-sm group-hover:text-indigo-500 transition-colors">公共关系部</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 group-hover:text-gray-300">对外联络负责</p>
                                    </div>
                                    
                                    <!-- 公共服务部 -->
                                    <div onclick="window.openDepartmentModal('publicService')" class="bg-white/5 rounded-xl p-3 border border-white/5 cursor-pointer hover:bg-accentRed/20 hover:border-accentRed/40 transition-all group relative overflow-hidden">
                                        <div class="flex items-center gap-2 mb-1">
                                            <i class="ph-fill ph-heart text-accentRed group-hover:scale-110 transition-transform"></i> 
                                            <span class="font-bold text-sm group-hover:text-accentRed transition-colors">公共服务部</span>
                                        </div>
                                        <p class="text-[10px] text-gray-500 group-hover:text-gray-300">校园公共服务</p>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <!-- 联系方式 -->
                        <div class="relative z-10 mt-4 pt-4 border-t border-white/10 flex-shrink-0">
                            <div class="grid grid-cols-1 gap-2 text-sm">
                                <div class="flex items-center gap-3 text-gray-300">
                                    <i class="ph-fill ph-map-pin text-accentYellow"></i>
                                    <span>行政楼 C601</span>
                                </div>
                                <div class="flex items-center gap-3 text-gray-300">
                                    <i class="ph-fill ph-envelope text-accentYellow"></i>
                                    <span>su_union@edu.space</span>
                                </div>
                            </div>
                            <button class="w-full mt-4 bg-accentYellow text-dark font-bold py-3 rounded-xl shadow-lg hover:bg-white transition-colors">
                                申请加入
                            </button>
                        </div>
                    </div>

                    <!-- RIGHT COLUMN: 4 个行政部门 -->
                    <div class="lg:col-span-3 grid grid-cols-1 sm:grid-cols-2 grid-rows-2 gap-6 h-auto">
                        
                        <!-- 1. 教务处 -->
                        <div class="bg-cardLight rounded-[32px] p-6 lg:p-8 shadow-soft border border-transparent flex flex-col justify-between h-64 lg:h-auto">
                            <div>
                                <div class="flex justify-between items-start mb-4">
                                    <div class="w-14 h-14 rounded-2xl bg-accentBlue/10 text-accentBlue flex items-center justify-center text-3xl">
                                        <i class="ph-fill ph-books"></i>
                                    </div>
                                    <span class="text-[10px] font-bold text-gray-400 bg-white px-2 py-1 rounded-full shadow-sm">综合楼 201</span>
                                </div>
                                <h3 class="text-xl font-bold text-dark mb-2">教务处</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">负责全校教学运行管理、课程安排、考试组织及学籍成绩管理。学生选课与转学办理中心。</p>
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-100 flex items-center justify-between">
                                <div class="flex flex-col">
                                    <span class="text-[10px] text-gray-400 uppercase">办公电话</span>
                                    <span class="text-sm font-bold text-dark font-mono">010-8822-1001</span>
                                </div>
                                <button class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-accentBlue hover:text-white transition-colors">
                                    <i class="ph-bold ph-phone"></i>
                                </button>
                            </div>
                        </div>

                        <!-- 2. 校团委 (团支部) -->
                        <div class="bg-cardLight rounded-[32px] p-6 lg:p-8 shadow-soft border border-transparent flex flex-col justify-between h-64 lg:h-auto">
                            <div>
                                <div class="flex justify-between items-start mb-4">
                                    <div class="w-14 h-14 rounded-2xl bg-accentRed/10 text-accentRed flex items-center justify-center text-3xl">
                                        <i class="ph-fill ph-flag-banner"></i> 
                                    </div>
                                    <span class="text-[10px] font-bold text-gray-400 bg-white px-2 py-1 rounded-full shadow-sm">行政楼 305</span>
                                </div>
                                <h3 class="text-xl font-bold text-dark mb-2">校团委</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">负责共青团组织建设、学生思想引领、社团管理及校园文化活动指导。志愿者服务总站。</p>
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-100 flex items-center justify-between">
                                <div class="flex flex-col">
                                    <span class="text-[10px] text-gray-400 uppercase">办公电话</span>
                                    <span class="text-sm font-bold text-dark font-mono">010-8822-1002</span>
                                </div>
                                <button class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-accentRed hover:text-white transition-colors">
                                    <i class="ph-bold ph-phone"></i>
                                </button>
                            </div>
                        </div>

                        <!-- 3. 政教处 (学生处) -->
                        <div class="bg-cardLight rounded-[32px] p-6 lg:p-8 shadow-soft border border-transparent flex flex-col justify-between h-64 lg:h-auto">
                            <div>
                                <div class="flex justify-between items-start mb-4">
                                    <div class="w-14 h-14 rounded-2xl bg-accentPurple/10 text-accentPurple flex items-center justify-center text-3xl">
                                        <i class="ph-fill ph-shield-check"></i>
                                    </div>
                                    <span class="text-[10px] font-bold text-gray-400 bg-white px-2 py-1 rounded-full shadow-sm">德育楼 103</span>
                                </div>
                                <h3 class="text-xl font-bold text-dark mb-2">政教处</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">负责学生德育工作、纪律管理、宿舍管理及校园安全教育。心理咨询中心直属部门。</p>
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-100 flex items-center justify-between">
                                <div class="flex flex-col">
                                    <span class="text-[10px] text-gray-400 uppercase">办公电话</span>
                                    <span class="text-sm font-bold text-dark font-mono">010-8822-1005</span>
                                </div>
                                <button class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-accentPurple hover:text-white transition-colors">
                                    <i class="ph-bold ph-phone"></i>
                                </button>
                            </div>
                        </div>

                        <!-- 4. 总务处 -->
                        <div class="bg-cardLight rounded-[32px] p-6 lg:p-8 shadow-soft border border-transparent flex flex-col justify-between h-64 lg:h-auto">
                            <div>
                                <div class="flex justify-between items-start mb-4">
                                    <div class="w-14 h-14 rounded-2xl bg-accentGreen/10 text-accentGreen flex items-center justify-center text-3xl">
                                        <i class="ph-fill ph-wrench"></i>
                                    </div>
                                    <span class="text-[10px] font-bold text-gray-400 bg-white px-2 py-1 rounded-full shadow-sm">后勤楼 101</span>
                                </div>
                                <h3 class="text-xl font-bold text-dark mb-2">总务处</h3>
                                <p class="text-sm text-gray-500 leading-relaxed">负责校园后勤保障、食堂餐饮、设施维修及校园绿化。校园一卡通充值与挂失中心。</p>
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-100 flex items-center justify-between">
                                <div class="flex flex-col">
                                    <span class="text-[10px] text-gray-400 uppercase">办公电话</span>
                                    <span class="text-sm font-bold text-dark font-mono">010-8822-1008</span>
                                </div>
                                <button class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-accentGreen hover:text-white transition-colors">
                                    <i class="ph-bold ph-phone"></i>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
            <!-- ================= END OF DEPARTMENTS STRUCTURE VIEW ================= -->
        </main>
    </div>

    <!-- ================= MODALS (位于主容器 `div` 之外) ================= -->

    <!-- 暂未开放提示模态框 -->
    <div id="not-open-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4">
        <div class="bg-white w-[320px] rounded-2xl shadow-2xl p-8 text-center transform transition-all scale-100 flex flex-col items-center">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-400"><i class="ph-fill ph-lock-key text-3xl"></i></div>
            <h3 class="text-lg font-bold text-dark mb-2">功能暂未开放</h3>
            <p class="text-xs text-gray-500 mb-6 leading-relaxed">该档案模块的数据正在录入和对接中，<br>敬请期待后续系统更新。</p>
            <button onclick="window.closeNotOpenModal()" class="bg-dark text-white px-8 py-2.5 rounded-full text-xs font-bold hover:bg-opacity-90 transition shadow-lg">我知道了</button>
        </div>
    </div>

    <!-- 无权限访问模态框 (新增) -->
    <div id="no-permission-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/20 backdrop-blur-sm p-4">
        <div class="bg-white w-[320px] rounded-2xl shadow-2xl p-8 text-center transform transition-all scale-100 flex flex-col items-center">
            <div class="w-16 h-16 bg-accentRed/10 rounded-full flex items-center justify-center mb-4 text-accentRed"><i class="ph-fill ph-prohibit text-3xl"></i></div>
            <h3 class="text-lg font-bold text-dark mb-2">权限不足</h3>
            <p class="text-xs text-gray-500 mb-6 leading-relaxed">您没有该学生档案的查阅权限。<br>请联系该学生获取许可。</p>
            <button onclick="window.closeNoPermissionModal()" class="bg-accentRed text-white px-8 py-2.5 rounded-full text-xs font-bold hover:bg-opacity-90 transition shadow-lg">关闭</button>
        </div>
    </div>

    <!-- 医学影像模态框 (新增) -->
    <div id="image-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm transition-opacity p-4 sm:p-6" onclick="window.closeExamImage()">
        <div class="modal-scrollbar-hide bg-white max-w-4xl w-full md:w-auto shadow-2xl rounded-b-2xl md:rounded-r-[32px] md:rounded-l-none overflow-y-auto md:overflow-hidden flex flex-col md:flex-row relative max-h-[85vh] md:h-[450px]" onclick="event.stopPropagation()">
            <div class="relative w-full md:w-[450px] aspect-square bg-gray-900 flex-shrink-0 group">
                <img id="image-modal-img" src="" alt="医学影像" class="w-full h-full object-cover">
                <button onclick="window.closeExamImage()" class="absolute top-4 right-4 z-20 w-8 h-8 flex items-center justify-center rounded-full bg-black/20 hover:bg-black/40 backdrop-blur-sm text-white transition cursor-pointer"><i class="ph-bold ph-x text-lg"></i></button>
                <div class="absolute inset-x-0 bottom-0 p-6 text-white bg-gradient-to-t from-black/80 via-black/40 to-transparent">
                    <div id="image-info-container" class="space-y-1"></div>
                </div>
            </div>
            <div class="w-full md:w-[320px] bg-white p-6 md:p-10 flex flex-col md:flex-1 h-auto md:h-full"> 
                <div class="flex flex-col gap-2 flex-shrink-0">
                    <h2 id="image-modal-title" class="text-2xl md:text-4xl font-serif font-bold text-dark leading-tight tracking-tight"></h2>
                    <p id="image-modal-subtitle" class="text-base md:text-xl text-gray-400 font-serif mt-2"></p>
                    <div class="h-1 w-12 bg-accentGreen mt-4 md:mt-6 mb-4"></div>
                </div>
                <div class="mt-2 md:mt-0 md:flex-1 md:overflow-y-auto"> 
                    <p id="image-modal-description" class="text-sm text-gray-600 leading-relaxed md:pr-4 pb-6 md:pb-0"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- 奖惩与荣誉详情模态框 (Rewards Detail Modal) - 新增 -->
    <div id="rewards-detail-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm transition-opacity p-4 sm:p-6" onclick="window.closeRewardsDetailModal()">
        <!-- 弹窗主体：全宽，最大宽度限制在 2xl，高度占满屏幕大部分，可垂直滚动 -->
        <div class="modal-scrollbar-hide bg-white max-w-2xl w-full shadow-2xl rounded-2xl overflow-y-auto relative max-h-[90vh]" onclick="event.stopPropagation()">
            
            <!-- 关闭按钮 (右上角) -->
            <button onclick="window.closeRewardsDetailModal()" 
                class="absolute top-4 right-4 z-20 w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 text-dark transition cursor-pointer">
                <i class="ph-bold ph-x text-lg"></i>
            </button>

            <!-- 文本内容区域 (Full Width, Scrollable) -->
            <div id="rewards-detail-modal-content-area" class="w-full bg-white p-8 sm:p-12 md:p-16 flex flex-col h-full overflow-y-auto"> 
                
                <!-- 头部区域 (元数据、标题、副标题) -->
                <div class="flex flex-col gap-2 flex-shrink-0 pb-6 border-b border-gray-100 mb-6">
                    <!-- 动态注入的元数据 -->
                    <div id="rewards-detail-modal-metadata" class="text-xs font-medium text-gray-500 space-y-1">
                        <!-- JS 动态注入内容 -->
                    </div>

                    <!-- 标题 -->
                    <h2 id="rewards-detail-modal-title" class="text-3xl md:text-4xl font-serif font-bold text-dark leading-snug tracking-tight mt-2"></h2>
                    
                    <!-- 副标题 (颁发机构) -->
                    <p id="rewards-detail-modal-subtitle" class="text-sm md:text-base text-gray-400 font-serif"></p>

                    <!-- 分隔线 (动态颜色) -->
                    <div id="rewards-modal-line" class="h-1 w-12 bg-accentOrange mt-4 md:mt-6 mb-4"></div>
                </div>

                <!-- 描述/阅读内容主体 -->
                <div class="flex-1"> 
                    <!-- 使用 'whitespace-pre-wrap' 确保详细描述中的换行符被保留 -->
                    <p id="rewards-detail-modal-description" class="text-base text-gray-700 leading-relaxed whitespace-pre-wrap"></p>
                </div>

                <!-- 新增落款和日期区域 -->
                <div id="rewards-detail-modal-signature" class="flex-shrink-0 pt-6">
                    <!-- JS 动态注入落款和日期 -->
                </div>
            </div>
            
        </div>
    </div>

    <!-- ========================= -->
    <!-- GENERIC DEPARTMENT DETAIL MODAL (学校部门详情模态框 - 新增) -->
    <!-- ========================= -->
    <div id="department-modal" class="fixed inset-0 z-[100] hidden">
            
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-dark/60 backdrop-blur-sm transition-opacity duration-300 opacity-0" id="modal-backdrop" onclick="window.closeDepartmentModal()"></div>
            
        <!-- Content Container --> <!-- Insert-控制部门详情模态框高度 -->
        <div class="absolute inset-4 lg:inset-16 flex items-center justify-center pointer-events-none">
            <div class="bg-bg w-full max-w-5xl h-full rounded-[32px] shadow-2xl overflow-hidden flex flex-col pointer-events-auto transform transition-all duration-300 scale-95 opacity-0" id="modal-content">
                    
                <!-- Close Button -->
                <button onclick="window.closeDepartmentModal()" class="absolute top-6 right-6 w-10 h-10 bg-white/90 hover:bg-white rounded-full flex items-center justify-center shadow-lg z-20 transition-transform hover:scale-110 group">
                    <i class="ph-bold ph-x text-dark group-hover:text-accentRed transition-colors"></i>
                </button>

                <!-- Header Image/Banner (Dynamic BG) -->
                <div id="modal-header-bg" class="h-48 sm:h-64 bg-accentRed relative flex-shrink-0 overflow-hidden transition-colors duration-500">
                    <!-- Decorative Shapes -->
                    <div class="absolute top-0 right-0 w-[500px] h-[500px] bg-white opacity-10 rounded-full -translate-y-1/2 translate-x-1/4"></div>
                    <div class="absolute bottom-0 left-0 w-32 h-32 bg-white opacity-20 rounded-full translate-y-1/2 -translate-x-1/4"></div>
                        
                    <div class="absolute inset-0 flex flex-col justify-end p-8 sm:p-10 z-10 text-white">
                        <div class="flex items-center gap-3 mb-2">
                            <div class="w-12 h-12 rounded-xl bg-white/20 backdrop-blur-md flex items-center justify-center border border-white/30">
                                <i id="modal-icon" class="ph-fill ph-heart text-2xl"></i>
                            </div>
                            <span class="text-xs font-bold uppercase tracking-wider bg-white/20 px-3 py-1 rounded-full border border-white/10">Department</span>
                        </div>
                        <h2 id="modal-title" class="text-4xl sm:text-5xl font-bold tracking-tight mb-2">部门名称</h2>
                        <p id="modal-desc" class="text-white/80 text-sm sm:text-base max-w-xl">
                            部门描述...
                        </p>
                    </div>
                </div>

                <!-- Scrollable Content -->
                <div class="flex-1 overflow-y-auto p-6 sm:p-10 bg-bg">
                    <div class="max-w-4xl mx-auto space-y-8 sm:space-y-12">

                        <!-- Section 1: Department Leadership -->
                        <section>
                            <h3 class="flex items-center gap-2 text-xl font-bold text-dark mb-6">
                                <i id="modal-section-icon" class="ph-fill ph-users-three text-accentRed"></i>
                                部门成员
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-12 gap-6">
                                <!-- Minister Card -->
                                <div class="md:col-span-4 bg-white rounded-3xl p-6 shadow-sm border border-gray-100 flex flex-col items-center text-center relative overflow-hidden group hover:shadow-md transition-shadow">
                                    <!-- 动态背景色将被 JS 覆盖 -->
                                    <div id="modal-minister-bg" class="absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-accentRed/5 to-transparent"></div>
                                        
                                    <!-- 字母缩写容器 -->
                                    <div id="modal-minister-avatar-container" class="relative w-24 h-24 rounded-full border-4 border-white shadow-md overflow-hidden mb-4 bg-gray-100 flex items-center justify-center">
                                        <!-- Initials will be rendered here by JS -->
                                    </div>
                                        
                                    <h4 id="modal-minister-name" class="text-xl font-bold text-dark">部长名</h4>
                                    <!-- 职位称谓胶囊 (动态颜色) -->
                                    <span id="modal-minister-badge" class="inline-block mt-1 px-3 py-1 bg-accentRed text-white text-xs font-bold rounded-full mb-3">职位称谓</span>
                                    <p id="modal-minister-quote" class="text-sm text-gray-500 leading-relaxed px-2 italic">
                                        "Quote..."
                                    </p>
                                    <div class="mt-4 flex gap-2">
                                        <button class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors"><i class="ph-fill ph-envelope-simple"></i></button>
                                        <button class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors"><i class="ph-fill ph-chat-circle-text"></i></button>
                                    </div>
                                </div>

                                <!-- Members Grid (Populated by JS) -->
                                <div class="md:col-span-8 bg-white rounded-3xl p-6 shadow-sm border border-gray-100 relative overflow-hidden transition-all">
    
                                    <div class="flex justify-between items-center mb-4">
                                        <h5 class="text-sm font-bold text-gray-400 uppercase tracking-wider">核心部员</h5>
                                        
                                        <button id="dept-info-trigger" onclick="window.showDeptCustomInfo()" class="w-6 h-6 rounded-full border border-gray-200 text-gray-400 flex items-center justify-center transition-colors shadow-sm cursor-pointer z-10" title="查看部门细则">
                                            <i class="ph-bold ph-info text-sm"></i>
                                        </button>
                                    </div>

                                    <div id="modal-members-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                                        </div>

                                    <div id="dept-info-overlay" class="hidden absolute inset-0 bg-white z-20 p-6 flex flex-col animate-fade-in-down">
                                        
                                        <div class="flex justify-between items-center mb-4 flex-shrink-0 relative z-20">
                                            <h3 id="dept-info-overlay-title" class="text-dark">部门详情</h3>
                                            
                                            <button onclick="window.closeDeptCustomInfo()" class="w-6 h-6 rounded-full bg-gray-50 hover:bg-gray-100 flex items-center justify-center text-gray-500 transition-colors cursor-pointer" title="返回">
                                                <i class="ph-bold ph-arrow-left text-sm"></i>
                                            </button>
                                        </div>
                                        
                                        <div id="dept-info-overlay-content" class="flex-1 overflow-y-auto no-scrollbar relative z-20 pr-1">
                                            </div>

                                        <div id="dept-info-overlay-decoration" class="absolute -bottom-10 -right-10 w-32 h-32 rounded-full opacity-10 blur-2xl pointer-events-none z-10"></div>
                                    </div>

                                </div>
                            </div>
                        </section>

                        <!-- Section 2: Special Center/Feature -->
                        <section>
                            <!-- modal-feature-bg 的 border 颜色由 JS 动态设置 -->
                            <div id="modal-feature-bg" class="bg-gradient-to-br from-[#FFF5F5] to-white rounded-[32px] p-1 border border-accentRed/10 shadow-sm relative overflow-hidden">
                                <!-- Inner Content -->
                                <div class="bg-white/50 backdrop-blur-xl rounded-[28px] p-6 sm:p-8 relative z-10">
                                        
                                    <!-- Header -->
                                    <div class="flex flex-col sm:flex-row sm:items-center gap-5 mb-8 border-b pb-6" style="border-color: rgba(0,0,0,0.05)">
                                        <!-- modal-feature-icon-box 的背景色由 JS 动态设置 -->
                                        <div id="modal-feature-icon-box" class="w-16 h-16 rounded-2xl bg-gradient-to-br from-accentRed to-white text-white flex items-center justify-center text-3xl shadow-lg flex-shrink-0">
                                            <i id="modal-feature-icon" class="ph-fill ph-scales"></i>
                                        </div>
                                        <div>
                                            <h3 id="modal-feature-title" class="text-2xl font-bold text-dark">Feature Title</h3>
                                            <div id="modal-feature-tags" class="flex flex-wrap gap-2 mt-2">
                                                <!-- Dynamic Tags -->
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Description & Widget -->
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                                        <div>
                                            <h4 class="font-bold text-dark mb-2 text-sm uppercase tracking-wide">中心职能</h4>
                                            <p id="modal-feature-desc" class="text-sm text-gray-500 leading-relaxed">
                                                Description text...
                                            </p>
                                        </div>
                                        <!-- Simple Status Widget -->
                                        <div class="bg-white rounded-xl p-4 border border-gray-100 shadow-sm">
                                            <div class="flex justify-between items-center mb-3">
                                                <span id="modal-widget-label" class="text-xs font-bold text-gray-400">今日指数</span>
                                                <!-- modal-widget-status 的背景色由 JS 动态设置 -->
                                                <span id="modal-widget-status" class="text-xs font-bold text-white px-2 py-0.5 rounded-full bg-accentGreen">良好</span>
                                            </div>
                                            <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
                                                <!-- modal-widget-bar 的宽度和背景色由 JS 动态设置 -->
                                                <div id="modal-widget-bar" class="w-[75%] h-full rounded-full bg-dark"></div>
                                            </div>
                                            <p class="text-[10px] text-gray-400 mt-2 text-right">Real-time Data</p>
                                        </div>
                                    </div>

                                    <!-- Bottom Info (Schedule/List) -->
                                    <div>
                                        <h4 id="modal-list-title" class="font-bold text-dark mb-4 flex items-center gap-2">
                                            <i class="ph-fill ph-list-dashes"></i> 
                                            近期动态
                                        </h4>
                                            
                                        <div id="modal-feature-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                            <!-- Dynamic List Items -->
                                        </div>
                                    </div>

                                    <!-- Custom info -->
                                    <div id="dept-custom-info-modal" class="hidden fixed inset-0 z-[150] flex items-center justify-center bg-black/40 backdrop-blur-[2px] p-6 transition-opacity duration-300">
                                        <div class="absolute inset-0" onclick="window.closeDeptCustomInfo()"></div>
                                        
                                        <div class="bg-white w-full max-w-sm rounded-2xl shadow-2xl p-6 relative z-10 animate-fade-in-down overflow-hidden">
                                            <div id="dept-info-decoration" class="absolute -top-10 -right-10 w-24 h-24 bg-gray-100 rounded-full opacity-50 blur-xl"></div>

                                            <div class="flex justify-between items-start mb-4 relative">
                                                <h3 id="dept-info-modal-title" class="text-lg font-bold text-dark pr-4">部门详情</h3>
                                                <button onclick="window.closeDeptCustomInfo()" class="w-6 h-6 rounded-full bg-gray-50 hover:bg-gray-100 flex items-center justify-center text-gray-500 transition-colors">
                                                    <i class="ph-bold ph-x text-xs"></i>
                                                </button>
                                            </div>
                                            
                                            <div id="dept-info-modal-content" class="relative max-h-[60vh] overflow-y-auto pr-2 no-scrollbar">
                                                </div>

                                            <div id="dept-info-bar" class="w-full h-1 bg-gray-100 mt-6 rounded-full"></div>
                                        </div>
                                    </div>

                                </div>

                                <!-- Decorative background icon (动态颜色/图标) -->
                                <i id="modal-feature-bg-icon" class="ph-fill ph-heart-straight absolute -bottom-10 -right-10 text-[10rem] text-accentRed opacity-[0.03] rotate-12 pointer-events-none"></i>
                            </div>
                        </section>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ========================= -->
    <!-- END OF DEPARTMENT DETAIL MODAL -->
    <!-- ========================= -->

</body>
</html>
